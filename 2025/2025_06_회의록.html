<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="template-type" content="monthly-meeting">
  <meta name="editable-title" content="25ë…„ 06ì›” ì›”ê°„ ì—…ë¬´ íšŒì˜ ì•ˆê±´">
  <title>25ë…„ 06ì›” ì›”ê°„ ì—…ë¬´ íšŒì˜ ì•ˆê±´</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
body { font-family: "ë§‘ì€ ê³ ë”•", sans-serif; background-color: rgb(252, 252, 252); margin: 0px; padding: 0px; color: rgb(43, 43, 43); line-height: 1.6; transition: margin-top 0.3s ease-in-out; overflow-x: hidden; }
body.meeting-cursor { cursor: cell; }
#appContainer { background-color: rgb(252, 252, 252); position: relative; }
h1#page-title { font-size: 1.8em; color: rgb(42, 77, 105); margin: 0px; border-bottom: 2px solid rgb(204, 204, 204); padding: 15px 40px; background: rgb(255, 255, 255); z-index: 999; box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 4px; box-sizing: border-box; }
body:not(.true-fullscreen-active) h1#page-title { position: fixed; top: 0px; left: 0px; width: 100%; }
body.true-fullscreen-active #appContainer > h1#page-title { position: fixed; top: 0px; left: 0px; width: 100%; z-index: 1000; }
#monthlyNavigatorContainer { display: flex; flex-direction: column; align-items: center; padding: 10px 0px; background-color: rgb(240, 244, 248); border-bottom: 1px solid rgb(220, 228, 235); position: fixed; width: 100%; z-index: 998; box-sizing: border-box; top: 67px; transition: top 0.3s ease-in-out; }
body.true-fullscreen-active #monthlyNavigatorContainer { top: 67px; }
#yearNavigator { display: flex; align-items: center; margin-bottom: 8px; }
#yearNavigator button { background: none; border: 1px solid rgb(160, 180, 200); color: rgb(51, 78, 104); padding: 2px 10px; font-size: 1.1em; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
#yearNavigator button:hover { background-color: rgb(220, 228, 235); }
#currentYearSpan { margin: 0px 12px; font-size: 1.1em; font-weight: 600; color: rgb(42, 77, 105); min-width: 70px; text-align: center; }
#monthLinksContainer { display: flex; flex-wrap: wrap; justify-content: center; }
.month-link { display: inline-block; padding: 6px 12px; margin: 2px 4px; border-radius: 4px; font-size: 0.9em; font-weight: 500; text-decoration: none; color: rgb(255, 255, 255); transition: background-color 0.2s, transform 0.2s; }
.month-link.active { background-color: rgb(74, 144, 226); cursor: pointer; }
.month-link.active:hover { background-color: rgb(53, 122, 189); transform: translateY(-2px); }
.month-link.current { background-color: rgb(216, 67, 21); font-weight: bold; cursor: default; }
.month-link.current:hover { transform: none; }
.month-link.disabled { background-color: rgb(176, 190, 197); color: rgb(245, 245, 245); cursor: not-allowed; opacity: 0.7; }
.container { width: 100%; max-width: none; margin: 0px auto; background: rgb(255, 255, 255); padding: 20px 60px 60px; box-sizing: border-box; min-height: calc(-160px + 100vh); position: relative; }
.section-title, .section-subtitle, .box, .flow span, .item, .insert-area { position: relative; }
.item-controls { position: absolute; top: -10px; right: -10px; display: none; background-color: rgba(220, 220, 220, 0.95); border-radius: 5px; padding: 3px 5px; z-index: 100; box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 3px; gap: 4px; }
body.show-icons-all [data-editable-type]:hover > .item-controls { display: flex; }
body.show-icons-selected [data-editable-type].controls-active > .item-controls { display: flex; }
.item-control-btn { background: rgb(255, 255, 255); border: 1px solid rgb(170, 170, 170); color: rgb(51, 51, 51); cursor: pointer; font-size: 14px; padding: 2px 5px; border-radius: 4px; line-height: 1; }
.item-control-btn:hover { background-color: rgb(232, 232, 232); border-color: rgb(136, 136, 136); }
.section-title { font-weight: bold; font-size: 1.4em; color: rgb(0, 105, 92); margin-top: 20px; margin-bottom: 8px; padding-left: 0px; }
.section-subtitle { font-weight: 600; font-size: 1em; color: rgb(0, 137, 123); margin-top: 6px; margin-bottom: 4px; margin-left: 20px; padding-left: 10px; }
.box > .section-subtitle { margin-left: 0px; padding-left: 0px; color: rgb(51, 51, 51); font-weight: normal; display: flex; align-items: baseline; }
.box > .section-subtitle .bullet-char { margin-right: 8px; }
.box .item-bulleted-left { display: flex; align-items: baseline; padding-left: 0px; margin-left: 0px !important; }
.box .item-bulleted-left .bullet-char { margin-right: 8px; flex-shrink: 0; }
.box .item-bulleted-left .bullet-text { flex-grow: 1; }
.box > .item:not(.item-bulleted-left), .box > .insert-area:not(.templated-insert-area), .box > button.add-sub-insert-area-btn { margin-left: 24px; margin-top: 8px; font-size: 0.9em; padding: 4px 8px; background-color: rgb(224, 224, 224); border: 1px solid rgb(204, 204, 204); border-radius: 4px; cursor: pointer; position: relative; }
.box > button.add-sub-insert-area-btn:hover { background-color: rgb(208, 208, 208); }
.box > button.add-sub-insert-area-btn > span[data-editable-type="button-text-label"] { display: inline-block; min-width: 20px; position: relative; }
.flow { display: flex; flex-wrap: wrap; gap: 10px; margin: 0px 0px 10px 50px; position: relative; }
.flow span { background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px; font-size: 0.95em; }
.box { background-color: rgb(249, 249, 249); border-left: 4px solid rgb(176, 190, 197); padding: 12px 20px; margin: 10px 0px 10px 50px; border-radius: 6px; }
.item { font-size: 0.96em; margin-bottom: 8px; padding: 2px; }
.highlight { font-weight: bold; color: rgb(216, 67, 21); }
.insert-area { border: 1px dashed rgb(187, 187, 187); background-color: rgb(255, 255, 255); padding: 8px; min-height: 50px; margin: 6px 0px 12px; position: relative; }
.box > .insert-area { margin-left: 24px; }
.floating-menu-icon, .fullscreen-btn-class, #multiZoomTriggerBtn, #annotationDisplayToggleBtn, #annotationSettingsToggleBtn, #memoAnnotationToggleBtn, .exit-true-fullscreen-btn { position: fixed; right: 16px; background-color: rgba(150, 150, 150, 0.3); color: rgb(85, 85, 85); border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 50%; cursor: pointer; box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 3px; transition: background-color 0.2s; font-family: "Segoe UI Emoji", "Apple Color Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif; line-height: 1; z-index: 10001; }
.floating-menu-icon { bottom: 16px; font-size: 20px; padding: 8px 10px; }
.fullscreen-btn-class { bottom: 62px; font-size: 20px; padding: 8px 10px; }
#multiZoomTriggerBtn { bottom: 108px; font-size: 22px; background-color: rgba(0, 123, 255, 0.8); color: white; padding: 10px; }
#annotationDisplayToggleBtn { bottom: 154px; font-size: 20px; padding: 8px 10px; z-index: 10002; }
#annotationSettingsToggleBtn { bottom: 200px; font-size: 20px; padding: 8px 10px; z-index: 10002; }
#memoAnnotationToggleBtn { bottom: 246px; font-size: 20px; padding: 8px 10px; z-index: 10002; }
.floating-menu-icon:hover, .fullscreen-btn-class:hover, #multiZoomTriggerBtn:hover, #annotationDisplayToggleBtn:hover, #annotationSettingsToggleBtn:hover, #memoAnnotationToggleBtn:hover, .exit-true-fullscreen-btn:hover { background-color: rgba(120, 120, 120, 0.4); }
#annotationDisplayToggleBtn.active, #annotationSettingsToggleBtn.active, #memoAnnotationToggleBtn.active, .fullscreen-btn-class.fs-active { background-color: rgba(128, 0, 128, 0.6); color: white; opacity: 1; }
#annotationDisplayToggleBtn:not(.active), #annotationSettingsToggleBtn:not(.active), #memoAnnotationToggleBtn:not(.active) { opacity: 0.6; }
.exit-true-fullscreen-btn { top: 10px; right: 16px; font-size: 28px; padding: 0px 10px; background-color: rgba(255, 255, 255, 0.6); z-index: 10005; display: none; }
body.true-fullscreen-active .exit-true-fullscreen-btn { display: block; }
.exit-true-fullscreen-btn:hover { color: rgb(0, 0, 0); background-color: rgba(230, 230, 230, 0.8); }
#annotationSettingsPanel { position: fixed; right: 70px; bottom: 200px; background-color: rgba(245, 245, 245, 0.97); padding: 30px 10px 10px; border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.2) -2px 0px 5px; z-index: 10003; display: none; flex-direction: column; gap: 8px; width: 190px; }
#closeAnnotationSettingsBtn { position: absolute; top: 5px; right: 8px; font-size: 24px; color: rgb(119, 119, 119); background-color: transparent; border: none; cursor: pointer; padding: 2px 5px; line-height: 1; }
#closeAnnotationSettingsBtn:hover { color: rgb(51, 51, 51); }
.floating-panel { position: fixed; bottom: 16px; right: 16px; width: 300px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 8px; padding: 35px 15px 15px; display: none; z-index: 10004; font-size: 14px; color: rgb(51, 51, 51); box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 8px; max-height: calc(-80px + 100vh); overflow: auto; cursor: grab; resize: both; min-width: 250px; min-height: 200px; }
.floating-panel.dragging { cursor: grabbing; user-select: none; }
.floating-panel-close-btn { position: absolute; top: 8px; right: 10px; font-size: 20px; color: rgb(119, 119, 119); cursor: pointer; padding: 2px 5px; }
.floating-panel-close-btn:hover { color: rgb(51, 51, 51); }
.floating-panel hr { margin: 12px 0px; border-top: 1px solid rgb(221, 221, 221); border-bottom: none; }
.floating-panel label { display: block; margin-bottom: 8px; font-weight: bold; color: rgb(0, 105, 92); }
.floating-panel input, .floating-panel button, .floating-panel select { width: 100%; margin-bottom: 10px; font-size: 13px; padding: 8px; box-sizing: border-box; border-radius: 4px; border: 1px solid rgb(221, 221, 221); }
.floating-panel input[type="color"] { width: auto; height: 35px; padding: 2px; vertical-align: middle; margin-left: 0px; }
.floating-panel input[type="radio"], .floating-panel input[type="checkbox"] { width: auto; margin-right: 5px; vertical-align: middle; }
.floating-panel .checkbox-label { font-weight: normal; display: inline-block; margin-bottom: 5px; color: rgb(51, 51, 51); }
#editIconsOptionsContainer { display: flex; flex-direction: column; gap: 5px; }
#monthlyNavUrlHelpText { font-size: 11px; color: rgb(85, 85, 85); margin-top: -8px; margin-bottom: 10px; display: block; line-height: 1.4; }
#monthlyNavUrlBtnContainer { display: flex; gap: 10px; }
.floating-panel .color-input-container { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.floating-panel .color-input-container label { margin-bottom: 0px; flex-shrink: 0; }
.floating-panel .format-controls button { width: auto; min-width: 35px; padding: 6px 8px; margin-right: 5px; margin-bottom: 5px; }
.floating-panel .format-controls { display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
.floating-panel .format-controls select { flex-grow: 1; margin-right: 5px; }
.floating-panel .format-controls #backColorSelector { margin-left: 5px; }
.floating-panel .char-insert-container { display: flex; align-items: center; gap: 5px; margin-bottom: 10px; }
.floating-panel .char-insert-container input[type="text"] { flex-grow: 1; margin-bottom: 0px; }
.floating-panel .emoji-dropdown { position: relative; display: inline-block; margin-bottom: 0px; }
.floating-panel .emoji-dropdown-btn { width: auto; padding: 8px 10px; margin-left: 5px; margin-bottom: 0px; }
.floating-panel input:focus, .floating-panel select:focus { border-color: rgb(0, 137, 123); outline: none; box-shadow: rgba(0, 137, 123, 0.2) 0px 0px 0px 2px; }
.floating-panel button { background-color: rgb(0, 137, 123); color: white; border: none; cursor: pointer; transition: background-color 0.2s; }
.floating-panel button:hover { background-color: rgb(0, 105, 92); }
.floating-panel button.secondary { background-color: rgb(176, 190, 197); color: rgb(51, 51, 51); }
.floating-panel button.secondary:hover { background-color: rgb(144, 164, 174); }
#elementStyleControls { margin-top: 15px; }
#elementStyleControls h4 { font-size: 1.1em; color: rgb(0, 105, 92); margin-top: 0px; margin-bottom: 10px; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 5px; }
#elementStyleControls label { font-weight: normal; color: rgb(51, 51, 51); }
#elementStyleControls input[type="text"], #elementStyleControls input[type="number"], #elementStyleControls select { margin-bottom: 10px; }
.common-item-template { display: none; }
body.true-fullscreen-active { overflow: auto !important; }
#appContainer:-webkit-full-screen { background: rgb(252, 252, 252); width: 100%; height: 100%; overflow-y: auto; }
#appContainer:fullscreen { background: rgb(252, 252, 252); width: 100%; height: 100%; overflow-y: auto; }
#areaSelectionRectangle { position: fixed; border: 1px dashed rgb(0, 123, 255); background-color: rgba(0, 123, 255, 0.1); z-index: 4000; display: none; pointer-events: none; }
#selectionZoomOverlay { position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; background-color: rgba(240, 240, 240, 0.97); z-index: 3000; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; cursor: zoom-out; }
#selectionZoomContent { background-color: rgb(255, 255, 255); padding: 25px; border: 1px solid rgb(204, 204, 204); border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 15px; max-width: 90%; margin: 20px auto; }
#selectionZoomContent > * { box-sizing: border-box; }
.close-selection-zoom-btn { position: absolute; top: 10px; right: 10px; font-size: 24px; color: rgb(170, 170, 170); background-color: transparent; border: none; cursor: pointer; z-index: 3001; }
.close-selection-zoom-btn:hover { color: rgb(119, 119, 119); }
.custom-message-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: rgb(255, 193, 7); color: rgb(51, 51, 51); padding: 15px 25px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 10px; z-index: 10006; display: none; font-size: 1em; }
.custom-message-box.error { background-color: rgb(244, 67, 54); color: white; }
.custom-message-box.success { background-color: rgb(76, 175, 80); color: white; }
#content a { color: purple; cursor: pointer; text-decoration: underline; }
#content a:hover { text-decoration: none; }
.multi-zoom-selected { outline: rgb(0, 123, 255) dashed 2px; outline-offset: 2px; box-shadow: rgba(0, 123, 255, 0.5) 0px 0px 8px; }
[data-editable-type] { cursor: default; }
[data-editable-type][contenteditable="true"], .insert-area[contenteditable="true"], span[data-editable-type="button-text-label"] { cursor: text; }
body.ctrl-pressed [data-editable-type]:hover { cursor: zoom-in; }
body.ctrl-pressed span[data-editable-type="button-text-label"]:hover { cursor: text; }
.emoji-dropdown { position: relative; display: inline-block; }
.emoji-dropdown-btn { width: auto !important; padding: 8px 10px !important; margin-left: 0px !important; margin-bottom: 10px !important; }
.emoji-dropdown-content { display: none; position: absolute; background-color: rgb(249, 249, 249); min-width: 200px; box-shadow: rgba(0, 0, 0, 0.2) 0px 8px 16px 0px; z-index: 10002; border-radius: 5px; padding: 10px; bottom: 100%; right: 0px; max-height: 200px; overflow-y: auto; flex-wrap: wrap; gap: 5px; justify-content: space-around; }
.emoji-dropdown-content button.emoji-btn { color: black; padding: 6px 8px; text-decoration: none; display: inline-block; font-size: 18px; border: none; background: none; cursor: pointer; width: auto; margin: 2px; }
.emoji-dropdown-content button.emoji-btn:hover { background-color: rgb(241, 241, 241); }
.emoji-dropdown:hover .emoji-dropdown-content, .emoji-dropdown .emoji-dropdown-content.show { display: flex; }
#annotationSettingsPanel > div { display: flex; align-items: center; gap: 5px; }
#annotationSettingsPanel label { font-size: 12px; margin-bottom: 0px; color: rgb(51, 51, 51); flex-shrink: 0; }
#annotationSettingsPanel button, #annotationSettingsPanel input[type="color"], #annotationSettingsPanel input[type="range"] { padding: 5px 8px; border: 1px solid rgb(204, 204, 204); border-radius: 4px; background-color: white; cursor: pointer; font-size: 12px; height: 28px; line-height: 1; box-sizing: border-box; margin-bottom: 0px; display: inline-flex; align-items: center; justify-content: center; text-align: center; }
#annotationSettingsPanel button { flex-grow: 0; flex-basis: auto; min-width: fit-content; padding: 5px 10px; }
#annotationSettingsPanel input[type="color"] { width: 30px; min-width: auto; padding: 1px; flex-grow: 0; }
#annotationSettingsPanel input[type="range"] { flex-grow: 1; padding: 0px; }
#annotationSettingsPanel .tool-active { background-color: rgb(128, 0, 128); color: white; border-color: rgb(96, 0, 96); }
#annoHighlighterOpacityContainer { display: none; align-items: center; gap: 5px; }
#annoHighlighterOpacityContainer label { font-size: 12px; margin-bottom: 0px; color: rgb(51, 51, 51); flex-shrink: 0; }
#annoHighlighterOpacityContainer input[type="range"] { flex-grow: 1; padding: 0px; height: 20px; }
#annotationCanvas { position: absolute; top: 0px; left: 0px; display: none; pointer-events: none; z-index: 10000; }
.text-annotation-memo { position: absolute; background-color: rgb(255, 255, 224); border: 1px solid rgb(204, 204, 204); padding: 8px; min-width: 150px; min-height: 70px; cursor: move; z-index: 10; box-shadow: rgba(0, 0, 0, 0.1) 2px 2px 5px; resize: both; overflow: auto; font-size: 14px; line-height: 1.4; box-sizing: border-box; }
.text-annotation-memo:focus-within { border-color: rgb(0, 123, 255); box-shadow: rgba(0, 123, 255, 0.5) 0px 0px 5px; }
.text-annotation-memo .memo-delete-btn { position: absolute; top: 2px; right: 4px; cursor: pointer; font-size: 14px; color: rgb(170, 170, 170); padding: 0px 2px; line-height: 1; }
.text-annotation-memo .memo-delete-btn:hover { color: rgb(51, 51, 51); }
@media print {
  @page { size: a4 landscape; margin: 5mm !important; }
  body, html { margin: 0px !important; padding: 0px !important; width: 100% !important; height: auto !important; overflow: visible !important; print-color-adjust: exact !important; }
  #monthlyNavigatorContainer, .floating-menu-icon, .fullscreen-btn-class, #multiZoomTriggerBtn, .floating-panel, #customMessageBox, #selectionZoomOverlay, .exit-true-fullscreen-btn, .item-controls, .add-sub-insert-area-btn, #annotationDisplayToggleBtn, #annotationSettingsToggleBtn, #annotationSettingsPanel, #memoAnnotationToggleBtn, .text-annotation-memo .memo-delete-btn { display: none !important; }
  #annotationCanvas { }
  .text-annotation-memo { break-inside: avoid; border: 1px solid rgb(221, 221, 221) !important; background-color: rgb(255, 255, 255) !important; box-shadow: none !important; }
  h1#page-title { position: relative !important; border-bottom: 1px solid rgb(204, 204, 204) !important; padding: 5mm 0px !important; margin: 0px 0px 5mm !important; width: 100% !important; box-sizing: border-box !important; }
  #appContainer, .container { margin: 0px !important; padding: 0px !important; width: 100% !important; border: none !important; box-shadow: none !important; }
  .container { padding-top: 0px !important; }
  .box { break-inside: avoid; border-left: 4px solid rgb(176, 190, 197) !important; margin-left: 0px !important; padding-left: 10px !important; }
  .section { break-inside: avoid; padding: 0px 5px !important; }
  .flow { margin-left: 5px !important; }
  .flow span, .highlight { print-color-adjust: exact !important; }
  a { color: purple !important; text-decoration: underline !important; }
  .no-print { display: none !important; }
  .multi-zoom-selected { outline: none !important; box-shadow: none !important; }
  body.ctrl-pressed [data-editable-type]:hover { cursor: default !important; }
}
  </style>
  <script>
        window.__SAVED_APP_STATE__ = {"wasFullscreenActive":false,"isDrawingFeatureActive":false,"isAnnotationPanelOpen":false,"isMemoModeActive":false,"drawingSettings":{"tool":"pen","penColor":"#800080","penLineWidth":"5","highlighterColor":"#FFFFE0","highlighterLineWidth":"20","highlighterOpacity":"0.3"},"panelUISettings":{"tool":"pen","penColor":"#800080","penLineWidth":"5","highlighterColor":"#FFFFE0","highlighterLineWidth":"20","highlighterOpacity":"0.3"},"keepDrawingsVisibleOnDeactivate":true,"drawnStrokes":[],"monthlyNavigatorConfig":{"enabled":true,"baseURL":"https://jonggunelee.github.io/wyggkr/","filenameStructureTemplate":"{YYYY}/{YYYY}_{MM}_íšŒì˜ë¡.html"},"pageTitle_innerHTML":"25ë…„ 06ì›” ì›”ê°„ ì—…ë¬´ íšŒì˜ ì•ˆê±´ (ê¸°ìˆ™ì‚¬ ë° ì‚¬íƒ)<div class=\"item-controls\"><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button></div>","contentArea_innerHTML":"\n      \n      <div class=\"section\">\n        <div class=\"section-title\" data-editable-type=\"section-title\"><font color=\"#050505\"><font size=\"5\">â†’</font> <font size=\"5\"><a href=\"https://jonggunelee.github.io/wyggkr/01%20%EC%9B%94%EB%B3%84%20%EB%88%84%EC%A0%81%20%EC%A7%91%ED%96%89%EB%B9%84_(%EA%B8%B0%EC%88%99%EC%82%AC%20%EB%B0%8F%20%EC%82%AC%ED%83%9D)_2025-06-00.html\" target=\"_blank\" rel=\"noopener noreferrer\">ì ˆê° ë° ì§‘í–‰ í˜„í™©</a> (ëˆ„ì )</font></font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n        <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><font size=\"4\">â–¶ ì ˆê°ì•¡ ì‚°ì¶œ ê¸°ì¤€</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"section-subtitle\" data-editable-type=\"section-subtitle\">&nbsp; &nbsp;&nbsp;<font size=\"3\"><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">í•­ëª© ë°œêµ´ â¡ï¸<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">ê²€í† (í˜„ì‹¤ì„±) â¡ï¸<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">ë°˜ì˜(í˜‘ì˜) â¡ï¸<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">ê°œì„  ë° í™•ì¥(ì§€ì†ì„±<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span></font><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px; font-size: 0.95em;\"><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"item item-bulleted-left\" data-editable-type=\"item\"> <span class=\"bullet-char\"><div class=\"item item-bulleted-left\" data-editable-type=\"item\"><span class=\"bullet-char\"><font size=\"3\">â–ª</font><strong style=\"\"><font size=\"3\">í•­ëª©(ì‹¤ë¹„ì •ì‚° â‘ ì˜ˆì‹œ)&nbsp;</font></strong><font size=\"3\">: <b>ê¸°ê³„ ê¸´ê¸‰ì„± (23ë…„ í•˜ë°˜ê¸°)</b> â¡ï¸ <b>ê±´ì¶•Â·ê¸°ê³„ ê·œëª¨ íŒŒì•… ë° í•©ì˜('24ë…„)</b> â¡ï¸ <b>ì§€ì†ì  ë³´ì™„('25ë…„~)</b></font><font size=\"5\" color=\"#f70808\">&nbsp;</font><b style=\"\"><font style=\"\" size=\"5\" color=\"#f70808\"><u style=\"\">âˆ´</u></font><font size=\"3\">&nbsp;ë™ì¼ ì¡°ê±´ 1:1 ì ˆê°ì•¡ ì‚°ì¶œ ë¶ˆê°€</font></b><font size=\"3\">&nbsp;</font></span><span class=\"bullet-text\"><font size=\"3\"><br></font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item item-bulleted-left\" data-editable-type=\"item\"><span class=\"bullet-char\"><font size=\"3\">â–ª</font><strong style=\"font-size: medium;\">ë¹„ìš©(ì‚°ì¶œê¸°ì¤€ â‘ </strong><strong style=\"\"><font size=\"2\">ì˜ˆì‹œ</font></strong><strong style=\"font-size: medium;\">)&nbsp;</strong><span style=\"font-size: medium;\">: </span><font size=\"3\"><b>ê³µì‚¬ ì ìš©ì‹œ ì‚°ì¶œë¹„(ë³´ìˆ˜ì )</b> </font><font style=\"\" size=\"2\" color=\"#fb0945\">â–</font><font size=\"3\"> <b>ì‹¤ íˆ¬ì…ë¹„</b>&nbsp;&nbsp;</font><span style=\"background-color: rgb(224, 247, 250); font-size: x-large; font-weight: 700;\"><font color=\"#757575\">=</font></span><span style=\"font-size: medium;\">&nbsp;</span><b style=\"font-size: medium;\"><font color=\"#ee4f4f\">ì°¨ì•¡(ì ˆê°ì•¡)</font></b><span style=\"font-size: medium;\">&nbsp;<br></span><span style=\"font-size: medium;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; â€» <b style=\"background-color: rgb(246, 250, 0);\">ê¸°ì‹¤ì </b> ë˜ëŠ” <b style=\"background-color: rgb(246, 248, 62);\">ìµœì†Œ ì¸ê±´ë¹„ ê¸°ì¤€</b> ì ìš© (ìì¬ë¹„ ë¯¸ë°˜ì˜, ì„ íƒ ì ìš©)</span></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n        <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><font size=\"4\">â–¶ 5ì›”ë§ ì§‘í–‰ë¹„ í˜„í™©</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"section-subtitle\" data-editable-type=\"section-subtitle\">&nbsp; &nbsp;&nbsp;<span class=\"highlight\" data-editable-type=\"flow-span\" style=\"font-size: large; position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">ì´&nbsp;<font style=\"\">4.</font><sup style=\"\"><u>4</u></sup>ì²œë§Œì› (16ê±´)<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span class=\"highlight\" data-editable-type=\"flow-span\" style=\"position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\"><font color=\"#f01414\" style=\"\" size=\"5\">=</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><font size=\"3\"><span data-editable-type=\"flow-span\" class=\"\" style=\"position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\"><font color=\"#676565\" style=\"\"><b>ìˆ˜ì¥ê³µì‚¬&nbsp;2.<sup style=\"\"><u>6</u>&nbsp;</sup>ì²œë§Œì› (6ê±´)</b></font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">â•<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\"><font color=\"#6c6a6a\"><b>ê±´ì¶•(ì‹¤ë¹„ì •ì‚°)&nbsp;4.<sup><u>8</u>&nbsp;</sup>ë°±ë§Œì› (1ê±´)</b></font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><span data-editable-type=\"flow-span\" class=\"\" style=\"color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\">&nbsp;<span style=\"position: relative; border-radius: 20px; padding: 6px 12px;\">â•</span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span></font><span data-editable-type=\"flow-span\" class=\"\" style=\"position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;\"><font color=\"#626060\" style=\"\" size=\"3\"><b>ì„¸ëŒ€ë‚´ ë³´ì¼ëŸ¬ å¤–&nbsp;1.<sup style=\"\"><u>3</u>&nbsp;</sup>ì²œë§Œì› (9ê±´)</b></font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n      <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n\n      <div class=\"section\">\n        <div class=\"section-title\" data-editable-type=\"section-title\"><font color=\"#000000\">â†’ ì£¼ìš” í˜„í™©</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\"><b>â–ª</b></span><span class=\"bullet-text\"><font size=\"4\" color=\"#000000\"><b>ì—…ë¬´ì§€ì›íŒ€</b></font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"item\" data-editable-type=\"item\"><font size=\"3\"><b>1. <a href=\"https://photos.app.goo.gl/X2jAqn11BmjXYmRHA\" target=\"_blank\" rel=\"noopener noreferrer\">ìœ ëª¨ì°¨ ìš´ì˜ ê´€ë¦¬ ê²€í† </a> :&nbsp;</b>ì¥ì†Œ í™•ë³´(1ê°œì†Œ) + ìš°í¸í•¨ ìœ„ì¹˜ ì¡°ì • + ìì „ê±° ë³´ê´€ ë¶€ìŠ¤ ê°œì¡° + ì‹ ê·œ ë¶€ìŠ¤</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item\" data-editable-type=\"item\"><font size=\"3\"><b>2. <a href=\"https://photos.app.goo.gl/tgiZM2btk9aahiBR9\" target=\"_blank\" rel=\"noopener noreferrer\">102ë™ ì–´ë¦°ì´ì§‘ ë†€ì´í„° ì…êµ¬ì¸¡ í­ìš° ëŒ€ë¹„</a> : </b>ì„ì‹œ ë¬¼ë§‰ ë§‰ì´ ì„¤ì¹˜&nbsp; ( í”ŒëŸ¬ë“œë°± ë˜ëŠ” ëª¨ë˜ ì£¼ë¨¸ë‹ˆ )</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           \n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\"><b>â–ª</b></span><span class=\"bullet-text\"><font size=\"4\" color=\"#050505\"><b>ê´€ë¦¬ì†Œ</b></font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"item\" data-editable-type=\"item\"><b>1. ì‹ ê·œ ì£¼ì°¨ êµ¬ì—­ ê´€ë¦¬</b><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item\" data-editable-type=\"item\"><b><font size=\"3\">2. ìˆ˜ì¡° ì²­ì†Œì¼ :</font></b>&nbsp;<span class=\"highlight\" style=\"font-weight: normal;\"><font color=\"#000000\">6ì›” 11ì¼(ìˆ˜)</font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           \n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\"><font size=\"4\"><b>â–ª</b></font></span><span class=\"bullet-text\"><font size=\"4\"><b>ê³µí†µ</b></font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"insert-area\" contenteditable=\"true\" data-editable-type=\"insert-area\"><font size=\"3\"><b>1. <a href=\"https://photos.app.goo.gl/E9pWdm38YhpEMJJe9\" target=\"_blank\" rel=\"noopener noreferrer\">2ë™ ì „ë©´ë¶€ ì§€ë¶• ë°°ìˆ˜ë¡œ íƒ€ê³µ ê¸°ì™€ êµì²´ ë° ë³´ìˆ˜</a></b>&nbsp;: ë°°ìˆ˜ë¡œ ì²­ì†Œ X, ì‹œê°„ ë‹¨ì¶•</font><br><font size=\"2\">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font><b style=\"font-size: medium;\">ë¬¶ìŒ)</b> <font size=\"2\"><a href=\"https://photos.app.goo.gl/4x2b168pAyLmTw1h8\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"\">Aë™ì™¸ë²½ í›¼ì† ë„ì¥ ë³´ìˆ˜</a> â¡ï¸ <a href=\"https://photos.app.goo.gl/CtuPtv5VsyVZ6sn5A\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"\">5ë™ ì§€ë¶• ì†ŒìŒ ë¬´ë™ë ¥ íœ€ ì ê²€</a> ë˜ëŠ” ë‹¨ìˆœêµì²´(ë¬´ë™ë ¥ íœ€ í™•ë³´) â¡ï¸ <a href=\"https://photos.app.goo.gl/GUWhWXSGfxprwHD48\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"\">7ë™ ì§€ë¶• 5-6ë¼ì¸ í™˜ê¸°êµ¬</a> ë‚´ë¶€ ì ê²€ ë˜ëŠ” ë‹¨ìˆœ êµì²´(ë¬´ë™ë ¥ íœ€ í™•ë³´)</font><br><br><font size=\"3\" style=\"font-weight: bold;\">2. <a href=\"https://photos.app.goo.gl/zNKEwA7jun8xmhFs7\" target=\"_blank\" rel=\"noopener noreferrer\">Aë™ ì§€í•˜ 2ì¸µ ê³„ë‹¨ì°¸ í•˜ë¶€ ì§€ë°˜ìˆ˜ ìœ ë„ ì‘ì—…</a> :&nbsp;</font><font size=\"2\">ì»·íŒ… ë° 1ì°¨ ë°”ë‹¥ ë°©ìˆ˜<b style=\"\">(â—‹)</b> â¡ï¸ ì˜¹ë²½íƒ€ê³µ+ìœ ë„ë°°ê´€<b style=\"\">(â—‹)</b> â¡ï¸ ì˜ˆì •:&nbsp;2ì°¨ ë°©ìˆ˜+íŠ¸ë Œì¹˜ë®ê°œ+EPSì‹¤ë‚´ ì°¨ìˆ˜íŒ+ë‹´ìˆ˜ì‹œí—˜</font><br><br><font size=\"3\" style=\"\"><b>3. <a href=\"https://photos.app.goo.gl/EEiit4crgVkBMxqt9\" target=\"_blank\" rel=\"noopener noreferrer\">101ë™ 304í˜¸ ì„¸ëŒ€ í˜„ê´€ë¬¸ ì²˜ì§ </a>: </b>ê¸ˆì† ì „ë¬´ ì‹œê³µì‚¬ ì ê²€ ê²°ê³¼ : ìˆ˜ë¦¬ ë¶ˆê°€ ì˜ê²¬ (1ì°¨--&gt;2ì°¨) â¡ï¸ ë™ì¼ ìƒ‰ìƒ,íŒ¨í„´ í™•ì¸ì¤‘<br></font><br><font size=\"3\" style=\"\"><b>4. <a href=\"https://photos.app.goo.gl/sHnMDR2FwYUAgTqXA\" target=\"_blank\" rel=\"noopener noreferrer\">3ë™ ì§€í•˜ê¸°ê³„ì‹¤ ë‚œë°© ë°°ê´€ ëˆ„ìˆ˜</a> : </b>ì„ì‹œ ê´€ë¦¬ì†Œ ì¡°ì¹˜í›„ ë¶€ë¶„ êµì²´ ëŒ€ê¸°ì¤‘<br><br></font><b style=\"font-size: medium;\">5. <a href=\"https://photos.app.goo.gl/79ZDT25qMUQr2qJ66\" target=\"_blank\" rel=\"noopener noreferrer\">ì—°ê°„ ê³„íš(7ì›”~8ì›”) ì§‘ì¤‘</a> :&nbsp;</b><span style=\"font-size: medium;\">ì´ì›” ë˜ëŠ” í˜‘ì˜í›„ ì‘ì—… ì¼ì • ìˆ˜ë¦½ í•„ìš”<br><br></span><b style=\"font-size: medium;\">6. <a href=\"https://photos.app.goo.gl/awYERQSkPWeVqr7m6\" target=\"_blank\" rel=\"noopener noreferrer\">ABë™ ì˜¤ìš°ìˆ˜ ê´€ë¡œ íì‡„ ê´€ë¦¬</a>(ë°€í) :&nbsp;</b><font size=\"2\">ê°€ì§€ê´€ ì—°ê²° ë¶€ë¶„ ì‹¤ë¦¬ì½˜ ë³´ìˆ˜ ì†¡ê¸° ë§ˆìŠ¤í¬ ë¶€ì°© ì•ˆì „ ê°•í™”ë¡œ 5ì›”ë§ ê³„íšì—ì„œ ë³´ìˆ˜ ë³´ë¥˜ì¤‘ ( ì„ëŒ€ í™•ì¸ì¤‘ / êµ¬ì… )</font><font size=\"3\" style=\"\"></font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n             <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div>\n             \n          \n      \n\n      <div class=\"section\">\n        <div class=\"section-title\" data-editable-type=\"section-title\"><font color=\"#000000\">â†’ í˜„ì¥ ì ê²€</font><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\"><font size=\"4\"><b>â–ª</b></font></span><span class=\"bullet-text\"><font size=\"4\"><b>ì ê²€ êµ¬ì—­ A (ì˜ˆì‹œ)</b></font></span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"item\" data-editable-type=\"item\"><font size=\"3\"><b>1. 3ë™ ì§€í•˜ ê¸°ê³„ì‹¤ :</b></font> ë‚œë°© ë°°ê´€ ëˆ„ìˆ˜ ë¶€ìœ„<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item\" data-editable-type=\"item\"><font size=\"3\"><b>2. 101ë™ 403í˜¸ :</b></font> í˜„ê´€ë¬¸ ì²˜ì§ ì„¸ëŒ€<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           \n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\">â–ª</span><span class=\"bullet-text\">ì ê²€ í•­ëª© B (ì˜ˆì‹œ)</span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"insert-area\" contenteditable=\"true\" data-editable-type=\"insert-area\">\n            ì ê²€ ë‚´ìš© ë° ê²°ê³¼ ì…ë ¥...\n          <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n            \n           <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div>\n        <div class=\"box\" data-editable-type=\"box\">\n          <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\"><span class=\"bullet-char\">â–ª</span><span class=\"bullet-text\">ì¶”ê°€ ì¡°ì¹˜ í•„ìš” ì‚¬í•­ (ì˜ˆì‹œ)</span><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n          <div class=\"insert-area\" contenteditable=\"true\" data-editable-type=\"insert-area\">\n            ì¡°ì¹˜ ë‚´ìš© ê¸°ìˆ ...\n          <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           <button class=\"add-sub-insert-area-btn\" contenteditable=\"false\">\n                <span contenteditable=\"true\" data-editable-type=\"button-text-label\">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class=\"item-controls\"></div></span></button><div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n           \n           <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div>\n      \n    \n    <div id=\"annotationSettingsPanel\" style=\"display: none;\">\n        <span id=\"closeAnnotationSettingsBtn\" title=\"ì„¤ì • ì ìš© ë° ë‹«ê¸°\">Ã—</span>\n        <div>\n            <button id=\"annoToolPen\" data-tool=\"pen\" title=\"íœ\">íœ</button>\n            <button id=\"annoToolHighlighter\" data-tool=\"highlighter\" title=\"í˜•ê´‘íœ\">í˜•ê´‘íœ</button>\n            <button id=\"annoToolCircle\" data-tool=\"circle\" title=\"ì›\">â—‹</button>\n            <button id=\"annoToolEllipse\" data-tool=\"ellipse\" title=\"íƒ€ì›\">â—Œ</button>\n            <button id=\"annoToolOrthoLine\" data-tool=\"orthoLine\" title=\"ì§ê°ì„ \">ğŸ“</button>\n        </div>\n        <div>\n            <label for=\"annoColorPicker\">ìƒ‰:</label>\n            <input type=\"color\" id=\"annoColorPicker\" title=\"ìƒ‰ìƒ ì„ íƒ\">\n        </div>\n        <div>\n            <label for=\"annoLineWidth\">êµµê¸°:</label>\n            <input type=\"range\" id=\"annoLineWidth\" min=\"1\" max=\"20\" title=\"ì„  êµµê¸°\">\n        </div>\n        <div id=\"annoHighlighterOpacityContainer\" style=\"display: none;\">\n            <label for=\"annoHighlighterOpacity\">íˆ¬ëª…ë„:</label>\n            <input type=\"range\" id=\"annoHighlighterOpacity\" min=\"0.1\" max=\"1\" step=\"0.1\" value=\"0.3\" title=\"í˜•ê´‘íœ íˆ¬ëª…ë„\">\n        </div>\n        <div>\n            <button id=\"annoToolEraser\" data-tool=\"eraser\" title=\"ì§€ìš°ê°œ\">ì§€ìš°ê°œ</button>\n            <button id=\"annoClearCanvas\" title=\"ëª¨ë‘ ì§€ìš°ê¸°\">ì „ì²´ì‚­ì œ</button>\n        </div>\n        <div>\n            <input type=\"checkbox\" id=\"annoKeepDrawingsVisible\" checked=\"\">\n            <label for=\"annoKeepDrawingsVisible\" style=\"font-size:11px; white-space: nowrap;\">ê·¸ë¦¼ ìœ ì§€(ë¹„í™œì„±ì‹œ)</label>\n        </div>\n    </div>\n <div id=\"customMessageBox\" class=\"custom-message-box success\" style=\"display: none;\">ì‹¤í–‰ ì·¨ì†Œë¨</div>\n\n<div class=\"floating-panel\" id=\"menuPanel\" style=\"display: none;\">\n  <span class=\"floating-panel-close-btn\" id=\"closeMenuPanelBtn\" title=\"ë©”ë‰´ ë‹«ê¸°\">âœ•</span>\n  <label>âš™ï¸ ì„¤ì •</label>\n  <div id=\"editIconsOptionsContainer\">\n      <label class=\"checkbox-label\" for=\"editIconsModeOff\">\n        <input type=\"radio\" id=\"editIconsModeOff\" name=\"editIconsMode\" value=\"off\">\n        ì•„ì´ì½˜ ìˆ¨ê¹€\n      </label>\n      <label class=\"checkbox-label\" for=\"editIconsModeAll\">\n        <input type=\"radio\" id=\"editIconsModeAll\" name=\"editIconsMode\" value=\"all\">\n        ì „ì²´ ì•„ì´ì½˜ í‘œì‹œ\n      </label>\n      <label class=\"checkbox-label\" for=\"editIconsModeSelected\">\n        <input type=\"radio\" id=\"editIconsModeSelected\" name=\"editIconsMode\" value=\"selected\">\n        ì„ íƒ ì•„ì´ì½˜ë§Œ í‘œì‹œ\n      </label>\n  </div>\n  <hr>\n  <label>ğŸ”— ë§í¬ í¸ì§‘</label>\n  <input type=\"text\" id=\"linkURL\" placeholder=\"ë§í¬ URL (ì„ íƒëœ í…ìŠ¤íŠ¸ì— ì ìš©)\">\n  <button id=\"applyLinkBtn\">ì„ íƒ ì˜ì—­ì— ë§í¬ ì‚½ì…</button>\n  <button id=\"removeLinkBtn\" class=\"secondary\">ì„ íƒ ì˜ì—­ ë§í¬ ì œê±°</button>\n\n  <!-- === ê°œì„  ì‚¬í•­: ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì • ë©”ë‰´ === -->\n  <div id=\"monthlyNavUrlSettings\">\n      <hr>\n      <label>ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì •</label>\n      <input type=\"text\" id=\"monthlyNavUrlTemplate\" placeholder=\"íšŒì˜ë¡ íŒŒì¼ ê²½ë¡œ í…œí”Œë¦¿\">\n      <span id=\"monthlyNavUrlHelpText\">\n          {YYYY}: 4ìë¦¬ ì—°ë„, {YY}: 2ìë¦¬ ì—°ë„<br>\n          {MM}: 2ìë¦¬ ì›”, {M}: 1ìë¦¬ ì›”\n      </span>\n      <div id=\"monthlyNavUrlBtnContainer\">\n        <button id=\"applyMonthlyNavUrlBtn\">URL ì ìš©</button>\n        <button id=\"removeMonthlyNavUrlBtn\" class=\"secondary\">ë„¤ë¹„ê²Œì´ì…˜ ì œê±°</button>\n      </div>\n  </div>\n  <!-- ======================================= -->\n\n  <hr>\n  <label>âœï¸ í…ìŠ¤íŠ¸ ì„œì‹</label>\n  <div class=\"format-controls\">\n    <button id=\"applyBoldBtn\" title=\"êµµê²Œ\"><b>B</b></button>\n    <button id=\"applyItalicBtn\" title=\"ê¸°ìš¸ì„ê¼´\"><i>I</i></button>\n    <button id=\"applyUnderlineBtn\" title=\"ë°‘ì¤„\"><u>U</u></button>\n    <button id=\"applyStrikethroughBtn\" title=\"ì·¨ì†Œì„ \" style=\"text-decoration: line-through;\">S</button>\n    <button id=\"applySuperscriptBtn\" title=\"ìœ„ ì²¨ì\">A<sup>+</sup></button>\n    <button id=\"applySubscriptBtn\" title=\"ì•„ë˜ ì²¨ì\">A<sub>-</sub></button>\n  </div>\n  <div class=\"format-controls\">\n    <select id=\"fontSizeSelector\" title=\"ê¸€ê¼´ í¬ê¸°\">\n      <option value=\"1\">ì•„ì£¼ ì‘ê²Œ</option> <option value=\"2\">ì‘ê²Œ</option> <option value=\"3\" selected=\"\">ë³´í†µ</option>\n      <option value=\"4\">ì¡°ê¸ˆ í¬ê²Œ</option> <option value=\"5\">í¬ê²Œ</option> <option value=\"6\">ì•„ì£¼ í¬ê²Œ</option> <option value=\"7\">ìµœëŒ€ë¡œ í¬ê²Œ</option>\n    </select>\n    <input type=\"color\" id=\"fontColorSelector\" title=\"ê¸€ê¼´ ìƒ‰ìƒ\" value=\"#000000\">\n    <input type=\"color\" id=\"backColorSelector\" title=\"í…ìŠ¤íŠ¸ ë°°ê²½ìƒ‰\" value=\"#ffffff\">\n  </div>\n  <hr>\n  <label>ğŸ’¡ ì•„ì´ì½˜/íŠ¹ìˆ˜ë¬¸ì ì‚½ì…</label>\n  <div class=\"char-insert-container\">\n    <input type=\"text\" id=\"charInput\" placeholder=\"ë¬¸ì ì…ë ¥ (ì˜ˆ: â­, âœ”, â–º)\">\n    <div class=\"emoji-dropdown\">\n        <button type=\"button\" class=\"emoji-dropdown-btn\" id=\"emojiDropdownBtn\">â–¼</button>\n        <div class=\"emoji-dropdown-content\" id=\"emojiPalette\">\n            <button type=\"button\" class=\"emoji-btn\">ğŸ˜€</button> <button type=\"button\" class=\"emoji-btn\">ğŸ˜‚</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ˜Š</button> <button type=\"button\" class=\"emoji-btn\">ğŸ˜</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ¤”</button> <button type=\"button\" class=\"emoji-btn\">ğŸ‘</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ‘</button> <button type=\"button\" class=\"emoji-btn\">â­</button>\n            <button type=\"button\" class=\"emoji-btn\">â¤ï¸</button> <button type=\"button\" class=\"emoji-btn\">âœ”</button>\n            <button type=\"button\" class=\"emoji-btn\">âŒ</button> <button type=\"button\" class=\"emoji-btn\">âœ¨</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ‰</button> <button type=\"button\" class=\"emoji-btn\">ğŸ‘€</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ‘‰</button> <button type=\"button\" class=\"emoji-btn\">ğŸ’¡</button>\n            <button type=\"button\" class=\"emoji-btn\">â“</button> <button type=\"button\" class=\"emoji-btn\">â—</button>\n            <button type=\"button\" class=\"emoji-btn\">â¡ï¸</button> <button type=\"button\" class=\"emoji-btn\">â¬…ï¸</button>\n            <button type=\"button\" class=\"emoji-btn\">â¬†ï¸</button> <button type=\"button\" class=\"emoji-btn\">â¬‡ï¸</button>\n            <button type=\"button\" class=\"emoji-btn\">â•</button> <button type=\"button\" class=\"emoji-btn\">â–</button>\n            <button type=\"button\" class=\"emoji-btn\">ğŸ“</button> <button type=\"button\" class=\"emoji-btn\">ğŸ“„</button>\n        </div>\n    </div>\n  </div>\n   <button id=\"insertCharFromInputBtn\" title=\"ì„ íƒ ìœ„ì¹˜ì— ì‚½ì…\" style=\"width:100%; margin-top: 5px;\">ì…ë ¥ ë¬¸ì ì‚½ì…</button>\n  <hr>\n  <label>âœ’ï¸ ì£¼ì„ ë„êµ¬</label>\n  <div>\n      <input type=\"checkbox\" id=\"menuAnnoKeepDrawingsVisible\">\n      <label for=\"menuAnnoKeepDrawingsVisible\" class=\"checkbox-label\">ê·¸ë¦¼ ìœ ì§€(ë¹„í™œì„±ì‹œ)</label>\n  </div>\n  <button id=\"menuAnnoDrawingToggle\" style=\"width:100%; margin-top:5px;\">ì£¼ì„ ì¼œê¸°/ë„ê¸°</button>\n  <button id=\"menuAnnoSettingsPanelToggle\" style=\"width:100%; margin-top:5px;\">ì£¼ì„ ì„¤ì • ì—´ê¸°/ë‹«ê¸°</button>\n  <button id=\"menuMemoAnnotationBtn\" style=\"width:100%; margin-top:5px;\">ë©”ëª¨ ì¶”ê°€ (ì „ì²´í™”ë©´)</button>\n  <hr>\n  <label>ğŸ“„ ë¬¸ì„œ ì €ì¥</label>\n  <button id=\"saveHtmlBtn\">ğŸ’¾ HTMLë¡œ ì €ì¥</button>\n  <button id=\"printPdfBtn\">ğŸ“„ PDFë¡œ ì¸ì‡„</button>\n  <hr>\n  <div id=\"elementStyleControls\" style=\"display:none;\">\n      <h4>ì„ íƒ ìš”ì†Œ ìŠ¤íƒ€ì¼</h4>\n      <div class=\"color-input-container\">\n        <label for=\"elementBgColor\">ë°°ê²½ìƒ‰:</label>\n        <input type=\"color\" id=\"elementBgColor\">\n      </div>\n      <div class=\"color-input-container\">\n        <label for=\"elementTextColor\">ê¸€ììƒ‰:</label>\n        <input type=\"color\" id=\"elementTextColor\">\n      </div>\n      <div>\n        <label for=\"elementBorderRadius\">í…Œë‘ë¦¬ êµ´ê³¡ (px):</label>\n        <input type=\"number\" id=\"elementBorderRadius\" min=\"0\" step=\"1\" placeholder=\"ì˜ˆ: 5\">\n      </div>\n      <div>\n        <label for=\"elementShapeSelector\">ëª¨ì–‘:</label>\n        <select id=\"elementShapeSelector\">\n          <option value=\"default\">ê¸°ë³¸ ëª¨ì–‘</option>\n          <option value=\"rectangle\">ì§ì‚¬ê°í˜•</option>\n          <option value=\"rounded-rectangle\">ë‘¥ê·¼ ì§ì‚¬ê°í˜•</option>\n          <option value=\"oval\">íƒ€ì›í˜•/ì›í˜•</option>\n        </select>\n      </div>\n    </div>\n</div>\n\n<div id=\"areaSelectionRectangle\" style=\"display: none;\"></div>\n\n<div id=\"selectionZoomOverlay\">\n    <button class=\"close-selection-zoom-btn\" id=\"closeSelectionZoomBtn\" title=\"ë‹«ê¸° (ë˜ëŠ” ë°”ê¹¥ í´ë¦­)\">âœ•</button>\n    <div id=\"selectionZoomContent\"></div>\n</div>\n\n<div class=\"common-item-template\">\n  <div class=\"item\" data-editable-type=\"item\" contenteditable=\"true\">ìƒˆë¡œìš´ ê¸°ë³¸ í•­ëª©...<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n  <div class=\"default-shape-item\" data-editable-type=\"item\" contenteditable=\"true\">ìƒˆë¡œìš´ í•­ëª© ë‚´ìš©...<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n  <div class=\"insert-area templated-insert-area\" contenteditable=\"true\" data-editable-type=\"insert-area\">### ì…ë ¥ ##...<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n  <div class=\"box\" data-editable-type=\"box\" style=\"margin-left: 0; background-color: #e9e9e9;\">ìƒˆ ë°•ìŠ¤\n      <div class=\"section-subtitle\" data-editable-type=\"section-subtitle\" style=\"margin-left:0;\">ìƒˆ í•˜ìœ„ ì œëª©<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n  <div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></div>\n  <span data-editable-type=\"flow-span\" style=\"background-color: #cceeff;\">ìƒˆ íë¦„ ë‹¨ê³„<div class=\"item-controls\"><button class=\"item-control-btn item-control-clone-btn\" title=\"í•­ëª© ë³µì œ\">â•</button><button class=\"item-control-btn item-control-style-btn\" title=\"ìŠ¤íƒ€ì¼ ë³€ê²½\">ğŸ¨</button><button class=\"item-control-btn item-control-delete-btn\" title=\"ì‚­ì œ\">ğŸ—‘ï¸</button></div></span>\n</div>\n\n<script id=\"mainAppScript\">\n  // --- ì›”ë³„ ë„¤ë¹„ê²Œì´í„° ì„¤ì • (ê°œì„ ë¨) ---\n  let monthlyNavigatorConfig = {\n    enabled: true, // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ì—¬ë¶€\n    baseURL: 'https://jonggunelee.github.io/wyggkr/', // ê¸°ë³¸ ì›¹ì‚¬ì´íŠ¸ URL\n    // íŒŒì¼ ì´ë¦„ ìƒì„± ê·œì¹™ í…œí”Œë¦¿. ì‚¬ìš©ìê°€ ë©”ë‰´ì—ì„œ ë³€ê²½ ê°€ëŠ¥.\n    filenameStructureTemplate: '{YYYY}/{YYYY}_{MM}_íšŒì˜ë¡.html'\n  };\n\n\n  // --- Global Variables & Constants ---\n  const appContainer = document.getElementById('appContainer');\n  const contentArea = document.getElementById('content');\n  const pageTitle = document.getElementById(\"page-title\");\n  const menuPanel = document.getElementById(\"menuPanel\");\n  const floatingMenuToggleBtn = document.getElementById(\"floatingMenuToggleBtn\");\n  const closeMenuPanelBtn = document.getElementById(\"closeMenuPanelBtn\");\n  const trueFullscreenBtn = document.getElementById('trueFullscreenBtn');\n  const exitTrueFullscreenBtnActual = document.getElementById('exitTrueFullscreenBtnActual');\n  const multiZoomTriggerBtn = document.getElementById('multiZoomTriggerBtn');\n\n  const selectionZoomOverlay = document.getElementById('selectionZoomOverlay');\n  const selectionZoomContent = document.getElementById('selectionZoomContent');\n\n  // Annotation variables\n  const annotationDisplayToggleBtn = document.getElementById('annotationDisplayToggleBtn');\n  const annotationSettingsToggleBtn = document.getElementById('annotationSettingsToggleBtn');\n  const annotationSettingsPanel = document.getElementById('annotationSettingsPanel');\n  const closeAnnotationSettingsBtn = document.getElementById('closeAnnotationSettingsBtn');\n  const annotationCanvas = document.getElementById('annotationCanvas');\n  const annoToolPenBtn = document.getElementById('annoToolPen');\n  const annoToolHighlighterBtn = document.getElementById('annoToolHighlighter');\n  const annoToolCircleBtn = document.getElementById('annoToolCircle');\n  const annoToolEllipseBtn = document.getElementById('annoToolEllipse');\n  const annoToolOrthoLineBtn = document.getElementById('annoToolOrthoLine');\n  const annoColorPicker = document.getElementById('annoColorPicker');\n  const annoLineWidthSlider = document.getElementById('annoLineWidth');\n  const annoToolEraserBtn = document.getElementById('annoToolEraser');\n  const annoClearCanvasBtn = document.getElementById('annoClearCanvas');\n  const annoHighlighterOpacityContainer = document.getElementById('annoHighlighterOpacityContainer');\n  const annoHighlighterOpacitySlider = document.getElementById('annoHighlighterOpacity');\n  const annoKeepDrawingsVisibleCheckbox = document.getElementById('annoKeepDrawingsVisible');\n\n  // Menu Panel Annotation Controls\n  const menuAnnoKeepDrawingsVisible = document.getElementById('menuAnnoKeepDrawingsVisible');\n  const menuAnnoDrawingToggle = document.getElementById('menuAnnoDrawingToggle');\n  const menuAnnoSettingsPanelToggle = document.getElementById('menuAnnoSettingsPanelToggle');\n  const menuMemoAnnotationBtn = document.getElementById('menuMemoAnnotationBtn');\n\n\n  // Memo annotation variables\n  const memoAnnotationToggleBtn = document.getElementById('memoAnnotationToggleBtn');\n  let isMemoModeActive = false;\n\n\n  let annotationCtx = annotationCanvas.getContext('2d');\n  let isDrawingFeatureActive = false;\n  let isAnnotationPanelOpen = false;\n\n  let isDrawingAnnotation = false;\n  let lastAnnotationX, lastAnnotationY;\n  let straightLineStartX, straightLineStartY;\n  let shapeStartX, shapeStartY;\n  let isShiftKeyDown = false;\n  let previewImageData = null;\n\n  let drawingSettings = {\n    tool: 'pen',\n    penColor: '#800080',\n    penLineWidth: '5',\n    highlighterColor: '#FFFFE0',\n    highlighterLineWidth: '20',\n    highlighterOpacity: '1.0',\n  };\n  let panelUISettings = { ...drawingSettings };\n  let keepDrawingsVisibleOnDeactivate = true;\n  let drawnStrokes = [];\n\n\n  let isDraggingPanel = false, panelOffsetX, panelOffsetY;\n  let currentlySelectedElementForStyling = null;\n  let currentlyActiveItemControlsElement = null;\n  let elementsForMultiZoom = [];\n\n  // --- ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ ë³€ìˆ˜ ---\n  let displayedYearInNav; // ë„¤ë¹„ê²Œì´ì…˜ì— í˜„ì¬ í‘œì‹œëœ ì—°ë„\n  let documentYear, documentMonth; // ì´ ë¬¸ì„œì˜ ì›ë³¸ ì—°ë„ì™€ ì›”\n\n\n  // --- Helper Functions ---\n  function showMessage(message, type = 'warning', duration = 3000) {\n    const messageBox = document.getElementById('customMessageBox');\n    if (!messageBox) return;\n    messageBox.textContent = message;\n    messageBox.className = 'custom-message-box';\n    if (type === 'error') messageBox.classList.add('error');\n    else if (type === 'success') messageBox.classList.add('success');\n    messageBox.style.display = 'block';\n    setTimeout(() => { messageBox.style.display = 'none'; }, duration);\n  }\n\n  function adjustContainerPadding() {\n      const titleEl = pageTitle;\n      const navigatorEl = document.getElementById('monthlyNavigatorContainer');\n      const contentEl = contentArea;\n\n      if (titleEl && contentEl) {\n          const titleHeight = titleEl.offsetHeight;\n          const navigatorHeight = navigatorEl && getComputedStyle(navigatorEl).display !== 'none' ? navigatorEl.offsetHeight : 0;\n          const totalFixedHeaderHeight = titleHeight + navigatorHeight;\n\n          if (document.body.classList.contains('content-fullscreen-active')) {\n              contentEl.style.paddingTop = '20px';\n          } else if (totalFixedHeaderHeight > 0) {\n              contentEl.style.paddingTop = `${totalFixedHeaderHeight + 20}px`;\n          } else {\n              contentEl.style.paddingTop = '20px';\n          }\n\n          if (navigatorEl && getComputedStyle(navigatorEl).display !== 'none') {\n             navigatorEl.style.top = `${titleHeight}px`;\n          }\n      }\n  }\n\n\n  // --- Date and Filename Formatting ---\n  function getFormattedDateForFilename() {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = (now.getMonth() + 1).toString().padStart(2, '0');\n    const day = now.getDate().toString().padStart(2, '0');\n    return {\n        yearYY: year.toString().slice(-2),\n        monthMM: month,\n        yearYYYY: year,\n        dayDD: day,\n    };\n  }\n  \n  // --- ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ (ê°œì„ ë¨) ---\n\n  // ë„¤ë¹„ê²Œì´ì…˜ UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜\n  function renderMonthlyNavigator() {\n    const navContainer = document.getElementById('monthlyNavigatorContainer');\n    if (!monthlyNavigatorConfig.enabled || !displayedYearInNav) {\n        if(navContainer) navContainer.style.display = 'none';\n        adjustContainerPadding();\n        return;\n    }\n\n    navContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”\n\n    // 1. ì—°ë„ ë„¤ë¹„ê²Œì´í„° ìƒì„±\n    const yearNav = document.createElement('div');\n    yearNav.id = 'yearNavigator';\n\n    const prevYearBtn = document.createElement('button');\n    prevYearBtn.id = 'prevYearBtn';\n    prevYearBtn.textContent = '<';\n    prevYearBtn.title = 'ì´ì „ ì—°ë„';\n    prevYearBtn.onclick = () => {\n        displayedYearInNav--;\n        renderMonthlyNavigator();\n    };\n\n    const currentYearSpan = document.createElement('span');\n    currentYearSpan.id = 'currentYearSpan';\n    currentYearSpan.textContent = `${displayedYearInNav}ë…„`;\n\n    const nextYearBtn = document.createElement('button');\n    nextYearBtn.id = 'nextYearBtn';\n    nextYearBtn.textContent = '>';\n    nextYearBtn.title = 'ë‹¤ìŒ ì—°ë„';\n    nextYearBtn.onclick = () => {\n        displayedYearInNav++;\n        renderMonthlyNavigator();\n    };\n\n    yearNav.appendChild(prevYearBtn);\n    yearNav.appendChild(currentYearSpan);\n    yearNav.appendChild(nextYearBtn);\n    navContainer.appendChild(yearNav);\n\n    // 2. ì›” ë§í¬ ì»¨í…Œì´ë„ˆ ìƒì„±\n    const monthLinksContainer = document.createElement('div');\n    monthLinksContainer.id = 'monthLinksContainer';\n\n    // 3. ì›”ë³„ ë§í¬ ìƒì„±\n    for (let i = 1; i <= 12; i++) {\n        const monthLink = document.createElement('span');\n        monthLink.className = 'month-link';\n        monthLink.textContent = `${i}ì›”`;\n\n        // 'current' í´ë˜ìŠ¤: í˜„ì¬ ë¬¸ì„œì˜ ì—°ë„ ë° ì›”ê³¼ ì¼ì¹˜í•  ë•Œ\n        if (displayedYearInNav === documentYear && i === documentMonth) {\n            monthLink.classList.add('current');\n            monthLink.title = 'í˜„ì¬ íšŒì˜ë¡';\n        } else {\n            // baseURLê³¼ templateì„ í•©ì³ì„œ ìµœì¢… URL ìƒì„±\n            const pathTemplate = monthlyNavigatorConfig.filenameStructureTemplate\n                .replace(/{YYYY}/g, displayedYearInNav)\n                .replace(/{YY}/g, String(displayedYearInNav).slice(-2))\n                .replace(/{MM}/g, String(i).padStart(2, '0'))\n                .replace(/{M}/g, i);\n            \n            let url = pathTemplate;\n            // baseURLì´ ìˆê³ , pathTemplateì´ ì „ì²´ URLì´ ì•„ë‹ ê²½ìš°ì—ë§Œ baseURLì„ ì•ì— ë¶™ì„\n            if (monthlyNavigatorConfig.baseURL && !pathTemplate.startsWith('http')) {\n                 url = monthlyNavigatorConfig.baseURL + pathTemplate;\n            }\n\n\n            // 'active' vs 'disabled'ëŠ” ë¯¸ë˜ ì‹œì ì¸ì§€ ì—¬ë¶€ë¡œ íŒë‹¨ (í˜„ì¬ ì‹œê°„ ê¸°ì¤€)\n            const now = new Date();\n            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n            const linkDate = new Date(displayedYearInNav, i - 1, 1);\n            \n            if(linkDate < thisMonth) {\n                 monthLink.classList.add('active');\n                 monthLink.onclick = () => window.open(url, '_blank');\n                 monthLink.title = `${i}ì›” íšŒì˜ë¡ ë³´ê¸°`;\n            } else {\n                 monthLink.classList.add('disabled');\n                 monthLink.title = 'ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡';\n            }\n        }\n        monthLinksContainer.appendChild(monthLink);\n    }\n    navContainer.appendChild(monthLinksContainer);\n\n    navContainer.style.display = 'flex'; // ìƒì„± í›„ ë³´ì´ê²Œ ì²˜ë¦¬\n    requestAnimationFrame(adjustContainerPadding);\n  }\n\n  // ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ ì´ˆê¸°í™” ë° ì„¤ì •\n  function initializeMonthlyNavigator() {\n    const navContainer = document.getElementById('monthlyNavigatorContainer');\n    if (!navContainer) {\n        console.error(\"ë„¤ë¹„ê²Œì´ì…˜ ì»¨í…Œì´ë„ˆ(#monthlyNavigatorContainer)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n        return;\n    }\n\n    // ë©”ë‰´ íŒ¨ë„ì˜ URL ì„¤ì • UI ì´ˆê¸°í™”\n    const urlTemplateInput = document.getElementById('monthlyNavUrlTemplate');\n    const applyUrlBtn = document.getElementById('applyMonthlyNavUrlBtn');\n    const removeUrlBtn = document.getElementById('removeMonthlyNavUrlBtn');\n\n    urlTemplateInput.value = monthlyNavigatorConfig.filenameStructureTemplate;\n\n    applyUrlBtn.addEventListener('click', () => {\n        const newTemplate = urlTemplateInput.value.trim();\n        if (newTemplate) {\n            monthlyNavigatorConfig.enabled = true;\n            // ì‚¬ìš©ìê°€ ì „ì²´ URLì„ ì…ë ¥í–ˆëŠ”ì§€, ì•„ë‹ˆë©´ ê²½ë¡œë§Œ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸\n            if (newTemplate.startsWith('http://') || newTemplate.startsWith('https://')) {\n                // ì „ì²´ URL ì…ë ¥ ì‹œ, baseURLì„ ë¹„ìš°ê³  templateì— ì „ì²´ë¥¼ ì €ì¥\n                monthlyNavigatorConfig.baseURL = '';\n                monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;\n                 showMessage('ì „ì²´ URL í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');\n            } else {\n                // ê²½ë¡œë§Œ ì…ë ¥ ì‹œ, ê¸°ë³¸ baseURLì„ ìœ ì§€í•˜ê³  templateë§Œ ì—…ë°ì´íŠ¸\n                 monthlyNavigatorConfig.baseURL = 'https://jonggunelee.github.io/wyggkr/'; // ê¸°ë³¸ê°’ ë³µì›/ì„¤ì •\n                 monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;\n                 showMessage('URL ê²½ë¡œ í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');\n            }\n            renderMonthlyNavigator();\n        } else {\n            showMessage('URL í…œí”Œë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');\n        }\n    });\n\n    removeUrlBtn.addEventListener('click', () => {\n        monthlyNavigatorConfig.enabled = false;\n        showMessage('ì›”ë³„ ë„¤ë¹„ê²Œì´ì…˜ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');\n        renderMonthlyNavigator();\n    }\n    );\n    // í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„/ì›” ì •ë³´ ì¶”ì¶œ\n    const titleText = pageTitle.textContent || '';\n    const match = titleText.match(/(\\d{2,4})ë…„\\s*(\\d{1,2})ì›”/);\n\n    if (!match) {\n        console.warn(\"í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„ì™€ ì›”ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ë„¤ë¹„ê²Œì´ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n        monthlyNavigatorConfig.enabled = false;\n        documentYear = null;\n        documentMonth = null;\n        displayedYearInNav = new Date().getFullYear();\n    } else {\n        let year = parseInt(match[1], 10);\n        if (year < 100) {\n            year += 2000; \n        }\n        documentYear = year;\n        documentMonth = parseInt(match[2], 10);\n        displayedYearInNav = documentYear; // ì´ˆê¸° í‘œì‹œ ì—°ë„ëŠ” ë¬¸ì„œì˜ ì—°ë„ë¡œ ì„¤ì •\n    }\n\n    renderMonthlyNavigator(); // ì´ˆê¸° ë Œë”ë§\n  }\n\n\n  // --- Fullscreen Functionality ---\n  function toggleTrueFullscreen() {\n    try {\n        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {\n            let requestPromise;\n            if (appContainer.requestFullscreen) {\n                requestPromise = appContainer.requestFullscreen();\n            } else if (appContainer.webkitRequestFullscreen) {\n                requestPromise = appContainer.webkitRequestFullscreen();\n            } else if (appContainer.mozRequestFullScreen) {\n                requestPromise = appContainer.mozRequestFullScreen();\n            } else if (appContainer.msRequestFullscreen) {\n                requestPromise = appContainer.msRequestFullscreen();\n            }\n\n            if (requestPromise) {\n                requestPromise.catch(err => {\n                    console.error(`Fullscreen request error: ${err.message} (${err.name})`);\n                    showMessage(\"ì „ì²´ í™”ë©´ ëª¨ë“œë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.\", \"error\");\n                });\n            }\n        } else {\n            let exitPromise;\n            if (document.exitFullscreen) {\n                exitPromise = document.exitFullscreen();\n            } else if (document.webkitExitFullscreen) {\n                exitPromise = document.webkitExitFullscreen();\n            } else if (document.mozCancelFullScreen) {\n                exitPromise = document.mozCancelFullScreen();\n            } else if (document.msExitFullscreen) {\n                exitPromise = document.msExitFullscreen();\n            }\n            \n            if (exitPromise) {\n                exitPromise.catch(err => {\n                    console.error(`Exit fullscreen error: ${err.message} (${err.name})`);\n                });\n            }\n        }\n    } catch (e) {\n        console.error(\"A synchronous error occurred when trying to toggle fullscreen:\", e);\n        showMessage(\"ì „ì²´ í™”ë©´ ê¸°ëŠ¥ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\", \"error\");\n    }\n}\n\nfunction exitTrueFullscreen() {\n    try {\n        let exitPromise;\n        if (document.exitFullscreen) {\n            exitPromise = document.exitFullscreen();\n        } else if (document.webkitExitFullscreen) {\n            exitPromise = document.webkitExitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n            exitPromise = document.mozCancelFullScreen();\n        } else if (document.msExitFullscreen) {\n            exitPromise = document.msExitFullscreen();\n        }\n        \n        if (exitPromise) {\n            exitPromise.catch(err => {\n                console.error(`Exit fullscreen error: ${err.message} (${err.name})`);\n            });\n        }\n    } catch (e) {\n        console.error(\"A synchronous error occurred when trying to exit fullscreen:\", e);\n    }\n}\n\n  function fullscreenChangeHandler() {\n    const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);\n    document.body.classList.toggle('true-fullscreen-active', isFs);\n\n    if (floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = isFs ? 'none' : 'block';\n    if (trueFullscreenBtn) {\n        trueFullscreenBtn.style.display = isFs ? 'none' : 'block';\n        trueFullscreenBtn.innerHTML = isFs ? 'ë‚˜ê°€ê¸°' : 'â›¶';\n        trueFullscreenBtn.title = isFs ? \"ì „ì²´ í™”ë©´ ë‚˜ê°€ê¸°\" : \"ì „ì²´ í™”ë©´ ë³´ê¸°\";\n    }\n    if (multiZoomTriggerBtn) {\n        multiZoomTriggerBtn.style.display = (isFs && elementsForMultiZoom.length > 0 && !document.body.classList.contains('selection-zoom-active')) ? 'block' : 'none';\n    }\n    if (exitTrueFullscreenBtnActual) exitTrueFullscreenBtnActual.style.display = isFs ? 'block' : 'none';\n\n\n    if (isFs) {\n        annotationDisplayToggleBtn.style.display = 'block';\n        annotationSettingsToggleBtn.style.display = 'block';\n        memoAnnotationToggleBtn.style.display = 'block';\n\n        if (isDrawingFeatureActive) {\n            annotationDisplayToggleBtn.classList.add('active');\n            annotationCanvas.style.display = 'block';\n            annotationCanvas.style.pointerEvents = 'auto';\n            annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';\n            annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);\n            if (isAnnotationPanelOpen) loadPanelUIWithSettings(panelUISettings);\n        } else {\n            annotationDisplayToggleBtn.classList.remove('active');\n            annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate ? 'block' : 'none';\n            annotationCanvas.style.pointerEvents = 'none';\n            annotationSettingsPanel.style.display = 'none';\n            annotationSettingsToggleBtn.classList.remove('active');\n            isAnnotationPanelOpen = false;\n        }\n    } else {\n        annotationDisplayToggleBtn.style.display = 'none';\n        annotationSettingsToggleBtn.style.display = 'none';\n        memoAnnotationToggleBtn.style.display = 'none';\n        annotationSettingsPanel.style.display = 'none';\n        isAnnotationPanelOpen = false;\n\n        if (annotationCanvas) {\n            annotationCanvas.style.pointerEvents = 'none';\n            annotationCanvas.style.display = (isDrawingFeatureActive && keepDrawingsVisibleOnDeactivate) ? 'block' : 'none';\n        }\n    }\n\n    if (document.body.classList.contains('selection-zoom-active')) {\n        if(floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = 'none';\n        if(trueFullscreenBtn) trueFullscreenBtn.style.display = 'none';\n        if(multiZoomTriggerBtn) multiZoomTriggerBtn.style.display = 'none';\n        if(annotationDisplayToggleBtn) annotationDisplayToggleBtn.style.display = 'none';\n        if(annotationSettingsToggleBtn) annotationSettingsToggleBtn.style.display = 'none';\n        if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.style.display = 'none';\n        if(annotationSettingsPanel) annotationSettingsPanel.style.display = 'none';\n    }\n\n    adjustContainerPadding();\n    updateAnnotationDisplayToggleBtnStyle();\n    setupAnnotationCanvas();\n  }\n\n  // --- Floating Panel (Menu) Functionality ---\n  function togglePanel() {\n    const isPanelCurrentlyOpen = menuPanel.style.display === \"block\";\n    menuPanel.style.display = isPanelCurrentlyOpen ? \"none\" : \"block\";\n\n    if (isPanelCurrentlyOpen) {\n        floatingMenuToggleBtn.innerHTML = 'â˜°';\n        floatingMenuToggleBtn.title = \"ë©”ë‰´ ì—´ê¸°\";\n        hideElementStyleControls();\n    } else {\n        floatingMenuToggleBtn.innerHTML = 'âœ•';\n        floatingMenuToggleBtn.title = \"ë©”ë‰´ ë‹«ê¸°\";\n        if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;\n        if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);\n        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen && isDrawingFeatureActive);\n        if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive && document.body.classList.contains('true-fullscreen-active'));\n    }\n  }\n\n  function handleCloseMenuPanel() {\n    menuPanel.style.display = \"none\";\n    floatingMenuToggleBtn.innerHTML = 'â˜°';\n    floatingMenuToggleBtn.title = \"ë©”ë‰´ ì—´ê¸°\";\n    hideElementStyleControls();\n  }\n  \n  function handlePanelDragStart(e) {\n      if (e.target.closest('button, input, select, .floating-panel-close-btn, .checkbox-label, .emoji-dropdown-content, .emoji-btn')) return;\n      isDraggingPanel = true;\n      menuPanel.classList.add('dragging');\n      panelOffsetX = e.clientX - menuPanel.getBoundingClientRect().left;\n      panelOffsetY = e.clientY - menuPanel.getBoundingClientRect().top;\n      if (!menuPanel.style.left || !menuPanel.style.top) {\n        const rect = menuPanel.getBoundingClientRect();\n        menuPanel.style.left = `${rect.left}px`; menuPanel.style.top = `${rect.top}px`;\n        menuPanel.style.right = 'auto'; menuPanel.style.bottom = 'auto';\n      }\n  }\n\n  function handlePanelDragMove(e) {\n    if (!isDraggingPanel) return;\n    e.preventDefault();\n    let newX = e.clientX - panelOffsetX;\n    let newY = e.clientY - panelOffsetY;\n    const panelRect = menuPanel.getBoundingClientRect();\n    newX = Math.max(0, Math.min(newX, window.innerWidth - panelRect.width));\n    newY = Math.max(0, Math.min(newY, window.innerHeight - panelRect.height));\n    menuPanel.style.left = `${newX}px`; menuPanel.style.top = `${newY}px`;\n  }\n\n  function handlePanelDragEnd() {\n    if (isDraggingPanel) {\n      isDraggingPanel = false;\n      menuPanel.classList.remove('dragging');\n    }\n  }\n\n  // --- Zoom Functionality (Single and Multi-Element) ---\n  function triggerZoomOnElement(zoomTarget) {\n    if (!zoomTarget || !appContainer.contains(zoomTarget) || selectionZoomOverlay.style.display === 'block') {\n        return;\n    }\n    const activeEl = document.activeElement;\n    if (activeEl && activeEl !== zoomTarget && appContainer.contains(activeEl) &&\n        ['INPUT', 'TEXTAREA', 'SELECT'].includes(activeEl.tagName)) {\n        return;\n    }\n    if (window.getSelection().toString().length > 0 && activeEl === zoomTarget && zoomTarget.isContentEditable) {\n        return;\n    }\n\n    const clone = zoomTarget.cloneNode(true);\n    clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());\n    clone.classList.remove('controls-active', 'multi-zoom-selected');\n    Object.assign(clone.style, { transform: 'none', cursor: 'auto' });\n\n    const originalStyle = getComputedStyle(zoomTarget);\n    for (let i = 0; i < originalStyle.length; i++) {\n        const propName = originalStyle[i];\n        const styleBlacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'margin', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];\n        if (!styleBlacklist.includes(propName)) {\n            try {\n                clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName));\n            } catch(e) { /* Silently ignore */ }\n        }\n    }\n    Object.assign(clone.style, {\n        display: originalStyle.display, margin: '0 auto', marginBottom: '0',\n        width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,\n        boxSizing: 'border-box', outline: 'none', boxShadow: 'none',\n        backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,\n        background: originalStyle.background,\n        whiteSpace: (zoomTarget.tagName === 'SPAN' && zoomTarget.parentElement && getComputedStyle(zoomTarget.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace\n    });\n\n    selectionZoomContent.innerHTML = '';\n    selectionZoomContent.appendChild(clone);\n    selectionZoomOverlay.style.display = 'block';\n    document.body.classList.add('selection-zoom-active');\n    document.body.style.overflow = 'hidden';\n    fullscreenChangeHandler();\n  }\n\n  function displayMultiZoom(elementsToZoom) {\n    if (!elementsToZoom || elementsToZoom.length === 0 || selectionZoomOverlay.style.display === 'block') return;\n    selectionZoomContent.innerHTML = '';\n\n    let isOriginalLayoutFlex = false;\n    let originalParentFlexProperties = { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px' };\n\n    if (elementsToZoom.length > 0 && elementsToZoom[0].parentElement) {\n        const parentStyle = getComputedStyle(elementsToZoom[0].parentElement);\n        if (parentStyle.display.includes('flex')) {\n            isOriginalLayoutFlex = true;\n            Object.assign(originalParentFlexProperties, {\n                display: parentStyle.display, flexDirection: parentStyle.flexDirection, flexWrap: parentStyle.flexWrap,\n                justifyContent: parentStyle.justifyContent, alignItems: parentStyle.alignItems,\n                gap: parentStyle.gap === 'normal' ? '10px' : parentStyle.gap\n            });\n        }\n    }\n    Object.assign(selectionZoomContent.style, originalParentFlexProperties);\n\n    elementsToZoom.forEach(originalEl => {\n        const clone = originalEl.cloneNode(true);\n        clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());\n        clone.classList.remove('controls-active', 'multi-zoom-selected');\n        Object.assign(clone.style, { transform: 'none', cursor: 'auto' });\n\n        const originalStyle = getComputedStyle(originalEl);\n        const blacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];\n        if (isOriginalLayoutFlex) blacklist.push('margin', 'margin-top', 'margin-right', 'margin-bottom', 'margin-left');\n\n        for (let i = 0; i < originalStyle.length; i++) {\n            const propName = originalStyle[i];\n            if (!blacklist.includes(propName) && propName !== 'white-space') {\n                try { clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName)); } catch(e) {}\n            }\n        }\n        Object.assign(clone.style, {\n            display: originalStyle.display, width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,\n            boxSizing: 'border-box', outline: 'none', boxShadow: 'none',\n            backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,\n            background: originalStyle.background,\n            whiteSpace: (originalEl.tagName === 'SPAN' && originalEl.parentElement && getComputedStyle(originalEl.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace\n        });\n        if (isOriginalLayoutFlex) clone.style.margin = '';\n        else Object.assign(clone.style, { marginTop: '0', marginLeft: 'auto', marginRight: 'auto', marginBottom: '15px' });\n\n        selectionZoomContent.appendChild(clone);\n    });\n    if (!isOriginalLayoutFlex && selectionZoomContent.lastChild) selectionZoomContent.lastChild.style.marginBottom = '0';\n\n    selectionZoomOverlay.style.display = 'block';\n    document.body.classList.add('selection-zoom-active');\n    document.body.style.overflow = 'hidden';\n    fullscreenChangeHandler();\n  }\n\n  function handleMultiZoomTrigger() {\n    if (elementsForMultiZoom.length > 0) {\n        elementsForMultiZoom.length === 1 ? triggerZoomOnElement(elementsForMultiZoom[0]) : displayMultiZoom([...elementsForMultiZoom]);\n    }\n  }\n\n  function closeSelectionZoom() {\n    selectionZoomOverlay.style.display = 'none';\n    selectionZoomContent.innerHTML = '';\n    document.body.classList.remove('selection-zoom-active');\n    document.body.style.overflow = '';\n    fullscreenChangeHandler();\n  }\n  \n  function handleSelectionZoomOverlayClick(event) {\n    if (event.target === selectionZoomOverlay || event.target.closest('.close-selection-zoom-btn')) closeSelectionZoom();\n  }\n\n  // --- Element Controls and Editing ---\n  function activateControls(elementToActivate, focusAndSelect = false) {\n      if (currentlyActiveItemControlsElement && currentlyActiveItemControlsElement !== elementToActivate) {\n          currentlyActiveItemControlsElement.classList.remove('controls-active');\n          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();\n      }\n      if (elementToActivate) {\n          elementToActivate.classList.add('controls-active');\n          currentlyActiveItemControlsElement = elementToActivate;\n          if (focusAndSelect && elementToActivate.dataset.editableType !== 'page-title') {\n              setTimeout(() => {\n                  elementToActivate.focus();\n                  if (typeof elementToActivate.select === 'function') {\n                      elementToActivate.select();\n                  } else if (elementToActivate.isContentEditable) {\n                      const selection = window.getSelection(), range = document.createRange();\n                      if (elementToActivate.firstChild) range.selectNodeContents(elementToActivate);\n                      else { range.setStart(elementToActivate, 0); range.collapse(true); }\n                      try { selection.removeAllRanges(); selection.addRange(range); } catch(e) { console.warn(\"Could not set selection:\", e); }\n                  }\n              }, 0);\n          }\n      } else if (currentlyActiveItemControlsElement) {\n          currentlyActiveItemControlsElement.classList.remove('controls-active');\n          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();\n          currentlyActiveItemControlsElement = null;\n      }\n  }\n\n  function generateItemControls(element) {\n    if (element.querySelector(':scope > .item-controls')) return;\n    const controlsDiv = document.createElement('div');\n    controlsDiv.className = 'item-controls';\n\n    // Event listeners for these buttons will be handled by event delegation\n    if (element.dataset.editableType !== 'button-text-label' && element.dataset.editableType !== 'page-title') {\n        const addBtn = document.createElement('button');\n        addBtn.className = 'item-control-btn item-control-clone-btn';\n        addBtn.innerHTML = 'â•'; addBtn.title = 'í•­ëª© ë³µì œ';\n        controlsDiv.appendChild(addBtn);\n    }\n\n    const styleBtn = document.createElement('button');\n    styleBtn.className = 'item-control-btn item-control-style-btn';\n    styleBtn.innerHTML = 'ğŸ¨'; styleBtn.title = 'ìŠ¤íƒ€ì¼ ë³€ê²½';\n    controlsDiv.appendChild(styleBtn);\n\n    if (element.dataset.editableType !== 'page-title') {\n        const delBtn = document.createElement('button');\n        delBtn.className = 'item-control-btn item-control-delete-btn';\n        delBtn.innerHTML = 'ğŸ—‘ï¸'; delBtn.title = 'ì‚­ì œ';\n        controlsDiv.appendChild(delBtn);\n    }\n\n    if (controlsDiv.children.length > 0 && !element.querySelector(':scope > .item-controls')) {\n        element.appendChild(controlsDiv);\n    }\n  }\n\n  function cloneAndInsertElement(sourceElement) {\n    let newItem = sourceElement.cloneNode(true);\n    newItem.removeAttribute('id');\n    newItem.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());\n    newItem.classList.remove('controls-active', 'multi-zoom-selected');\n\n    const computedStyle = getComputedStyle(sourceElement);\n    for (let i = 0; i < computedStyle.length; i++) {\n        const propName = computedStyle[i];\n        const styleBlacklist = ['position','top','right','left','bottom','z-index','display','visibility','opacity','transform','margin','margin-top','margin-right','margin-bottom','margin-left','outline','outline-color','outline-style','outline-width','outline-offset','box-shadow', 'transition', 'cursor'];\n        if (!styleBlacklist.includes(propName)) {\n            try { newItem.style.setProperty(computedStyle[i], computedStyle.getPropertyValue(computedStyle[i]), computedStyle.getPropertyPriority(computedStyle[i])); } catch (e) {}\n        }\n    }\n    if (computedStyle.display.includes('block') || computedStyle.display.includes('flex') || computedStyle.display.includes('grid')) newItem.style.display = computedStyle.display;\n    else if (sourceElement.tagName === 'SPAN' && (computedStyle.display === 'inline' || !computedStyle.display) ) newItem.style.display = 'inline-block';\n    else newItem.style.display = computedStyle.display || 'block';\n\n    if (computedStyle.width !== 'auto' && computedStyle.width !== '0px') newItem.style.width = computedStyle.width;\n    if (computedStyle.height !== 'auto' && computedStyle.height !== '0px') newItem.style.height = computedStyle.height;\n\n\n    sourceElement.parentNode.insertBefore(newItem, sourceElement.nextSibling);\n    generateItemControls(newItem);\n    newItem.querySelectorAll('[data-editable-type]').forEach(desc => generateItemControls(desc));\n    activateControls(newItem, true);\n    showMessage('í•­ëª©ì´ ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');\n  }\n\n  // --- Multi-Zoom Selection Logic ---\n  function toggleMultiZoomSelection(element) {\n    const index = elementsForMultiZoom.indexOf(element);\n    if (index > -1) { elementsForMultiZoom.splice(index, 1); element.classList.remove('multi-zoom-selected'); }\n    else { elementsForMultiZoom.push(element); element.classList.add('multi-zoom-selected'); }\n    updateMultiZoomTriggerVisibility();\n  }\n\n  function updateMultiZoomTriggerVisibility() {\n    if (multiZoomTriggerBtn) {\n        const isSelectionZoomActive = document.body.classList.contains('selection-zoom-active');\n        const shouldBeVisible = elementsForMultiZoom.length >= 1 && !isSelectionZoomActive && document.body.classList.contains('true-fullscreen-active');\n        multiZoomTriggerBtn.style.display = shouldBeVisible ? 'block' : 'none';\n    }\n  }\n  function clearMultiZoomSelectionVisuals() {\n    elementsForMultiZoom.forEach(e => e.classList.remove('multi-zoom-selected'));\n    updateMultiZoomTriggerVisibility();\n  }\n\n  // --- Event Handling for Element Interaction and Controls ---\n  function handleAppContainerClick(event) {\n    const target = event.target;\n\n    // --- Event Delegation for Item Controls ---\n    const controlButton = target.closest('.item-control-btn');\n    if (controlButton) {\n        event.stopPropagation();\n        const element = controlButton.closest('[data-editable-type]');\n        if (!element) return;\n\n        if (controlButton.classList.contains('item-control-clone-btn')) {\n            cloneAndInsertElement(element);\n        } else if (controlButton.classList.contains('item-control-style-btn')) {\n            activateElementStyling(element);\n        } else if (controlButton.classList.contains('item-control-delete-btn')) {\n            const itemText = (element.textContent.substring(0,20) || \"ì´ í•­ëª©\").trim();\n            if (element.dataset.editableType === 'button-text-label' && element.parentElement?.classList.contains('add-sub-insert-area-btn')) {\n                element.parentElement.remove();\n            } else {\n                element.remove();\n            }\n            showMessage(`'${itemText}...' í•­ëª© ì‚­ì œë¨.`, 'success');\n            if (currentlySelectedElementForStyling === element) { hideElementStyleControls(); currentlySelectedElementForStyling = null; }\n            if (currentlyActiveItemControlsElement === element) activateControls(null);\n            const indexInMultiZoom = elementsForMultiZoom.indexOf(element);\n            if (indexInMultiZoom > -1) { elementsForMultiZoom.splice(indexInMultiZoom, 1); updateMultiZoomTriggerVisibility(); }\n        }\n        return;\n    }\n    \n    // --- Event Delegation for \"Add Insert Area\" button ---\n    const addInsertAreaButton = target.closest('.add-sub-insert-area-btn');\n    if (addInsertAreaButton && !target.closest('[data-editable-type=\"button-text-label\"]')) {\n        event.stopPropagation();\n        const boxElement = addInsertAreaButton.closest('.box');\n        if (boxElement) {\n             addInsertAreaToBox(boxElement);\n        }\n        return;\n    }\n\n    // --- Main Click Logic for Selection ---\n    const clickedItem = target.closest('[data-editable-type]');\n    if (!clickedItem) {\n        activateControls(null);\n        if (elementsForMultiZoom.length > 0 && !target.closest('#multiZoomTriggerBtn')) {\n            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];\n        } return;\n    }\n    \n    if (clickedItem.dataset.editableType === 'button-text-label' && target === clickedItem) {\n        activateControls(clickedItem, true); event.stopPropagation(); return;\n    }\n    const interactiveChild = target.closest('a, button:not(.add-sub-insert-area-btn), input, select, textarea');\n    if (interactiveChild && clickedItem.contains(interactiveChild) && interactiveChild !== clickedItem) {\n        if (interactiveChild.tagName === 'A' && interactiveChild.href && !(event.ctrlKey || event.metaKey)) {\n             event.preventDefault(); window.open(interactiveChild.href, '_blank', 'noopener,noreferrer');\n        } return;\n    }\n    event.stopPropagation();\n\n    if (event.ctrlKey || event.metaKey) {\n        event.preventDefault();\n        if (!(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) &&\n            !(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length === 0 && elementsForMultiZoom.includes(clickedItem) && elementsForMultiZoom.length > 1) ) {\n            toggleMultiZoomSelection(clickedItem);\n        }\n        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem) activateControls(clickedItem);\n        else if (elementsForMultiZoom.length !== 1 && currentlyActiveItemControlsElement === clickedItem) activateControls(null);\n        else if (elementsForMultiZoom.length > 1 && currentlyActiveItemControlsElement) activateControls(null);\n\n    } else {\n        if (elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) {\n            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];\n        }\n        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem && clickedItem.dataset.editableType === 'page-title') {\n            toggleMultiZoomSelection(clickedItem);\n        }\n        activateControls(clickedItem);\n    }\n  }\n\n  function handleDocumentClick(event) {\n    const isClickInsideAppOrGlobalControls = appContainer.contains(event.target) ||\n                                       (menuPanel && menuPanel.contains(event.target)) ||\n                                       (selectionZoomOverlay && selectionZoomOverlay.contains(event.target)) ||\n                                       (multiZoomTriggerBtn && multiZoomTriggerBtn.contains(event.target)) ||\n                                       (floatingMenuToggleBtn && floatingMenuToggleBtn.contains(event.target)) ||\n                                       (trueFullscreenBtn && trueFullscreenBtn.contains(event.target)) ||\n                                       (annotationSettingsPanel && annotationSettingsPanel.contains(event.target));\n\n    if (!isClickInsideAppOrGlobalControls) {\n        if (currentlyActiveItemControlsElement) activateControls(null);\n        if (elementsForMultiZoom.length > 0) { clearMultiZoomSelectionVisuals(); elementsForMultiZoom = []; }\n    }\n  }\n\n\n  function handleKeyDown(event) {\n    if (event.key === 'Shift') {\n        isShiftKeyDown = true;\n    }\n    if (event.ctrlKey || event.metaKey) {\n        document.body.classList.add('ctrl-pressed');\n        if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {\n            event.preventDefault(); try { document.execCommand('undo', false, null); showMessage('ì‹¤í–‰ ì·¨ì†Œë¨', 'success', 1500); }\n            catch (e) { showMessage('ì‹¤í–‰ ì·¨ì†Œ ì‹¤íŒ¨.', 'error'); console.error(\"Undo failed:\", e); }\n        } else if ((event.key === 'y' || event.key === 'Y') && !event.shiftKey) {\n            event.preventDefault(); try { document.execCommand('redo', false, null); showMessage('ë‹¤ì‹œ ì‹¤í–‰ë¨', 'success', 1500); }\n            catch (e) { showMessage('ë‹¤ì‹œ ì‹¤í–‰ ì‹¤íŒ¨.', 'error'); console.error(\"Redo failed:\", e); }\n        }\n    }\n  }\n  function handleKeyUp(event) {\n    if (event.key === 'Shift') {\n        isShiftKeyDown = false;\n    }\n    if (!event.ctrlKey && !event.metaKey) document.body.classList.remove('ctrl-pressed');\n  }\n\n  // --- Dynamic Content Addition ---\n  function addInsertAreaToBox(boxElement) {\n    if (!boxElement || !boxElement.classList.contains('box')) return;\n    const template = document.querySelector('.common-item-template .insert-area.templated-insert-area');\n    if (!template) { console.error(\"Insert area template not found!\"); showMessage('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }\n    let newInsertArea = template.cloneNode(true);\n    newInsertArea.textContent = \"### ì…ë ¥ ##...\";\n    newInsertArea.classList.remove('templated-insert-area');\n    \n    // Find last button and insert before it\n    const lastButton = boxElement.querySelector('.add-sub-insert-area-btn:last-of-type');\n    if (lastButton) {\n        boxElement.insertBefore(newInsertArea, lastButton);\n    } else {\n        boxElement.appendChild(newInsertArea);\n    }\n\n    generateItemControls(newInsertArea);\n    activateControls(newInsertArea, true);\n    showMessage('í•˜ìœ„ ì…ë ¥ì°½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');\n  }\n\n  // --- Element Styling Controls ---\n  function activateElementStyling(element) {\n    currentlySelectedElementForStyling = element;\n    const styleControls = document.getElementById('elementStyleControls');\n    if (!menuPanel || !styleControls) return;\n\n    document.getElementById('elementBgColor').value = rgbToHex(getComputedStyle(element).backgroundColor);\n    document.getElementById('elementTextColor').value = rgbToHex(getComputedStyle(element).color);\n    const borderRadiusInput = document.getElementById('elementBorderRadius');\n    const shapeSelector = document.getElementById('elementShapeSelector');\n    const currentBorderRadiusStyle = getComputedStyle(element).borderRadius;\n\n    borderRadiusInput.value = parseInt(currentBorderRadiusStyle) || 0;\n\n    if (currentBorderRadiusStyle === '50%') shapeSelector.value = 'oval';\n    else if (currentBorderRadiusStyle.split(' ').every(r => parseFloat(r) === 0 || r === '0px')) shapeSelector.value = 'rectangle';\n    else if (parseFloat(currentBorderRadiusStyle) > 0) shapeSelector.value = 'rounded-rectangle';\n    else shapeSelector.value = 'default';\n\n    styleControls.style.display = 'block';\n    if (menuPanel.style.display !== 'block') togglePanel();\n    styleControls.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    showMessage(`'${(element.dataset.editableType || element.tagName).toLowerCase()}' ìŠ¤íƒ€ì¼ í¸ì§‘ ì¤‘`, 'success', 2000);\n  }\n  function hideElementStyleControls() {\n      const styleControls = document.getElementById('elementStyleControls');\n      if (styleControls) styleControls.style.display = 'none';\n  }\n  function applySelectedElementStyle(property, value) {\n    if (currentlySelectedElementForStyling) {\n      currentlySelectedElementForStyling.style[property] = value;\n      if (currentlySelectedElementForStyling === pageTitle) requestAnimationFrame(adjustContainerPadding);\n    }\n  }\n  function applySelectedElementShape(shapeValue) {\n    if (!currentlySelectedElementForStyling) return;\n    const element = currentlySelectedElementForStyling;\n    const borderRadiusInput = document.getElementById('elementBorderRadius');\n    let radiusToApply = borderRadiusInput ? parseInt(borderRadiusInput.value) : 5;\n    if (isNaN(radiusToApply) || radiusToApply < 0) radiusToApply = 5;\n\n    switch (shapeValue) {\n        case 'rectangle': element.style.borderRadius = '0px'; if (borderRadiusInput) borderRadiusInput.value = 0; break;\n        case 'rounded-rectangle':\n            const currentRadius = parseInt(element.style.borderRadius);\n            radiusToApply = (currentRadius === 0 || element.style.borderRadius === '50%') ? 4 : (currentRadius || 4);\n            element.style.borderRadius = `${radiusToApply}px`; if (borderRadiusInput) borderRadiusInput.value = radiusToApply; break;\n        case 'oval': element.style.borderRadius = '50%'; break;\n        case 'default': element.style.borderRadius = '';\n            if (borderRadiusInput) borderRadiusInput.value = parseInt(getComputedStyle(element).borderRadius) || 0; break;\n    }\n    if (element === pageTitle) requestAnimationFrame(adjustContainerPadding);\n  }\n  function rgbToHex(rgb) {\n    if (!rgb || typeof rgb !== 'string' || rgb.indexOf('rgb') === -1) return '#000000';\n    if (rgb === 'rgba(0, 0, 0, 0)' || rgb === 'transparent') return '#ffffff';\n    let parts = rgb.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)$/);\n    if (!parts) return '#000000';\n    delete parts[0];\n    for (let i = 1; i <= 3; ++i) { parts[i] = parseInt(parts[i]).toString(16); if (parts[i].length == 1) parts[i] = '0' + parts[i]; }\n    return `#${parts[1]}${parts[2]}${parts[3]}`;\n  }\n\n  // --- Text Formatting and Link/Character Insertion ---\n  function applyLink() {\n    const linkURLInput = document.getElementById(\"linkURL\"); const linkURL = linkURLInput.value.trim();\n    if (!linkURL) { showMessage(\"ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”.\", \"error\"); return; }\n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0 || selection.isCollapsed) { showMessage(\"í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.\", \"error\"); return; }\n\n    let prefixedURL = linkURL;\n    if (!linkURL.startsWith('http://')&&!linkURL.startsWith('https://')&&!linkURL.startsWith('mailto:')&&!linkURL.startsWith('#')&&!linkURL.includes('://')) {\n        prefixedURL = 'http://' + linkURL;\n    }\n    try { if (!prefixedURL.includes(':') && !prefixedURL.startsWith('#') && !prefixedURL.startsWith('/')) new URL(prefixedURL); }\n    catch (_) { showMessage(\"ìœ íš¨í•œ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\", \"error\"); return; }\n\n    document.execCommand('createLink', false, prefixedURL);\n    let createdLink = selection.anchorNode?.nodeType === Node.TEXT_NODE ? selection.anchorNode.parentElement : selection.anchorNode;\n    if (createdLink && createdLink.tagName !== 'A') createdLink = createdLink.closest('a');\n    if(createdLink?.tagName === 'A'){ createdLink.target = '_blank'; createdLink.rel = 'noopener noreferrer'; }\n\n    showMessage(\"ë§í¬ê°€ ì‚½ì…ë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\"); linkURLInput.value = '';\n  }\n  function removeLink() { document.execCommand('unlink', false, null); showMessage(\"ë§í¬ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\");}\n  function applyBold() { document.execCommand('bold', false, null); }\n  function applyItalic() { document.execCommand('italic', false, null); }\n  function applyUnderline() { document.execCommand('underline', false, null); }\n  function applyStrikethrough() { document.execCommand('strikeThrough', false, null); }\n  function applySuperscript() { document.execCommand('superscript', false, null); }\n  function applySubscript() { document.execCommand('subscript', false, null); }\n  function changeFontSize(size) { if (size) document.execCommand('fontSize', false, size); }\n  function changeFontColor(color) { if (color) document.execCommand('foreColor', false, color); }\n  function changeBackColor(color) { if (color) document.execCommand('backColor', false, color); }\n  function insertCharacterFromInput() { const charToInsert=document.getElementById('charInput').value; if(!charToInsert){showMessage(\"ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.\",\"warning\");return;} insertCharacter(charToInsert); }\n  function insertCharacter(char) { if (!char) {showMessage(\"ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.\",\"warning\");return;} document.execCommand('insertText', false, char); }\n  function toggleEmojiPalette(event) { event.stopPropagation(); document.getElementById('emojiPalette').classList.toggle('show'); }\n  \n  function handleGlobalEmojiPaletteClick(event) {\n    const palette = document.getElementById('emojiPalette'); const emojiDropdown = document.querySelector('.emoji-dropdown');\n    if (palette && emojiDropdown && !emojiDropdown.contains(event.target) && palette.classList.contains('show')) palette.classList.remove('show');\n  }\n\n  function handleEmojiPaletteButtonClick(event) {\n    const button = event.target.closest('.emoji-btn');\n    if(button) {\n        insertCharacter(button.textContent);\n    }\n  }\n\n\n  // --- Save and Print Functionality ---\n    /**\n     * @param {string} extension - The desired file extension (e.g., 'html' or 'pdf').\n     * @returns {string} The generated filename.\n     */\n    function getSaveFileName(extension) {\n        // 1. ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ ì¶”ì¶œ ì‹œë„\n        const titleText = pageTitle.textContent || '';\n        const match = titleText.match(/(\\d{2,4})ë…„\\s*(\\d{1,2})ì›”/);\n\n        if (match) {\n            let year = parseInt(match[1], 10);\n            if (year < 100) year += 2000; // YY -> 20YY ë³€í™˜\n            let month = parseInt(match[2], 10);\n\n            // 2. URL í…œí”Œë¦¿ì—ì„œ íŒŒì¼ëª… ë¶€ë¶„ë§Œ ì¶”ì¶œ\n            const template = monthlyNavigatorConfig.filenameStructureTemplate;\n            const filenameTemplate = template.split('/').pop();\n\n            // 3. í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ íŒŒì¼ëª… ìƒì„±\n            const filename = filenameTemplate\n                .replace(/{YYYY}/g, year)\n                .replace(/{YY}/g, String(year).slice(-2))\n                .replace(/{MM}/g, String(month).padStart(2, '0'))\n                .replace(/{M}/g, month);\n\n            // 4. ìš”ì²­ëœ í™•ì¥ìì™€ íŒŒì¼ëª…ì˜ í™•ì¥ìê°€ ë‹¤ë¥¸ ê²½ìš°, ìš”ì²­ëœ í™•ì¥ìë¡œ êµì²´\n            // ì˜ˆ: í…œí”Œë¦¿ì´ 'file.txt' ì´ê³  extensionì´ 'html'ì´ë©´ 'file.html'ë¡œ ë³€ê²½\n            if (filename.includes('.') && !filename.toLowerCase().endsWith(`.${extension.toLowerCase()}`)) {\n                 const baseName = filename.substring(0, filename.lastIndexOf('.'));\n                 return `${baseName}.${extension}`;\n            }\n            // í…œí”Œë¦¿ì— í™•ì¥ìê°€ ì—†ëŠ” ê²½ìš°, í™•ì¥ì ì¶”ê°€\n            if (!filename.includes('.')) {\n                return `${filename}.${extension}`;\n            }\n            \n            return filename; // í…œí”Œë¦¿ì˜ í™•ì¥ìì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜\n        }\n\n        // 5. í´ë°±: ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ì˜ ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±\n        console.warn(\"ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ íŒŒì¼ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤.\");\n        const dateInfo = getFormattedDateForFilename();\n        const defaultFilename = `${dateInfo.yearYYYY}_${dateInfo.monthMM}ì›”_íšŒì˜ì•ˆê±´.${extension}`;\n        return defaultFilename;\n    }\n\n\n function saveHTML() {\n    if (menuPanel.style.display === \"block\") togglePanel();\n    if (isAnnotationPanelOpen) {\n        drawingSettings = { ...panelUISettings };\n        applySettingsToContext(drawingSettings);\n        isAnnotationPanelOpen = false;\n        annotationSettingsPanel.style.display = 'none';\n        annotationSettingsToggleBtn.classList.remove('active');\n        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');\n    }\n    if(document.getElementById('customMessageBox').style.display === 'block') document.getElementById('customMessageBox').style.display = 'none';\n    if (selectionZoomOverlay.style.display === 'block') closeSelectionZoom();\n    if(currentlyActiveItemControlsElement) activateControls(null);\n    clearMultiZoomSelectionVisuals();\n\n    const clonedAppContainer = appContainer.cloneNode(true);\n\n    clonedAppContainer.querySelectorAll('.controls-active').forEach(el=>el.classList.remove('controls-active'));\n    clonedAppContainer.querySelectorAll('.multi-zoom-selected').forEach(el=>el.classList.remove('multi-zoom-selected'));\n    clonedAppContainer.querySelectorAll('.item-controls').forEach(el=>el.remove());\n\n    const originalPageTitle = document.getElementById('page-title'), clonedPageTitle = clonedAppContainer.querySelector('#page-title');\n    if(originalPageTitle && clonedPageTitle) clonedPageTitle.innerHTML = originalPageTitle.innerHTML;\n\n    const originalContentArea = document.getElementById('content');\n    const clonedContentArea = clonedAppContainer.querySelector('#content');\n    if(originalContentArea && clonedContentArea) {\n        const tempDivForContent = document.createElement('div');\n        tempDivForContent.innerHTML = originalContentArea.innerHTML;\n        const canvasInContent = tempDivForContent.querySelector('#annotationCanvas');\n        if (canvasInContent) canvasInContent.innerHTML = '';\n        clonedContentArea.innerHTML = tempDivForContent.innerHTML;\n    }\n\n    let clonedExternalElementsHTML = \"\";\n    const elementsStructurallyOutsideIDs = ['customMessageBox','menuPanel','areaSelectionRectangle','selectionZoomOverlay'];\n     elementsStructurallyOutsideIDs.forEach(id => {\n        const originalElement = document.getElementById(id);\n        if (originalElement) {\n            const clonedElement = originalElement.cloneNode(true);\n            clonedElement.style.display='none';\n            if (id==='menuPanel' && originalElement.style.left && originalElement.style.top) {\n                Object.assign(clonedElement.style, {\n                    left:originalElement.style.left, top:originalElement.style.top,\n                    right:'auto', bottom:'auto',\n                    width: originalElement.style.width, height: originalElement.style.height\n                });\n            }\n            clonedExternalElementsHTML += clonedElement.outerHTML + \"\\n\";\n        }\n    });\n\n    const appSaveState = {\n        wasFullscreenActive: document.body.classList.contains('true-fullscreen-active'),\n        isDrawingFeatureActive: isDrawingFeatureActive,\n        isAnnotationPanelOpen: false,\n        isMemoModeActive: isMemoModeActive,\n        drawingSettings: drawingSettings,\n        panelUISettings: panelUISettings,\n        keepDrawingsVisibleOnDeactivate: keepDrawingsVisibleOnDeactivate,\n        drawnStrokes: drawnStrokes,\n        monthlyNavigatorConfig: monthlyNavigatorConfig, // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì €ì¥\n        pageTitle_innerHTML: pageTitle.innerHTML,\n        contentArea_innerHTML: (() => {\n            const tempDiv = document.createElement('div');\n            tempDiv.innerHTML = contentArea.innerHTML;\n            tempDiv.querySelector('#annotationCanvas')?.remove();\n            return tempDiv.innerHTML;\n        })(),\n        menuPanel_style_display: 'none',\n        menuPanel_style_left: menuPanel.style.left,\n        menuPanel_style_top: menuPanel.style.top,\n        menuPanel_style_width: menuPanel.style.width,\n        menuPanel_style_height: menuPanel.style.height,\n        editIconsMode: document.querySelector('input[name=\"editIconsMode\"]:checked')?.value || 'off'\n    };\n    \n    // ìƒíƒœë¥¼ data ì†ì„±ì— ì‚½ì…í•˜ëŠ” ëŒ€ì‹ , ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.\n    const scriptToRestoreState = `<script>\n        window.__SAVED_APP_STATE__ = ${JSON.stringify(appSaveState)};\n    <\\/script>`;\n\n\n    const commonTemplate = document.querySelector('.common-item-template');\n    let clonedCommonTemplateHTML = commonTemplate ? commonTemplate.cloneNode(true).outerHTML + \"\\n\" : \"\";\n\n    let htmlOutput = `<!DOCTYPE html>\\n<html lang=\"ko\">\\n<head>\\n  ${Array.from(document.querySelectorAll('head > meta')).map(m=>m.outerHTML).join('\\n  ')}\\n  <title>${document.title}</title>\\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js\"><\\/script>\\n  <style>\\n${Array.from(document.styleSheets).map(s=>Array.from(s.cssRules||[]).map(r=>r.cssText).join('\\n')).join('\\n')}\\n  </style>\\n  ${scriptToRestoreState}\\n</head>\\n<body>\\n${clonedAppContainer.outerHTML}\\n${clonedExternalElementsHTML}${clonedCommonTemplateHTML}`;\n    const mainScriptElement = document.getElementById('mainAppScript');\n    if (mainScriptElement) htmlOutput += `<script id=\"mainAppScript\" defer>\\n${mainScriptElement.innerHTML}\\n<\\/script>\\n`;\n    else showMessage(\"ì €ì¥ ì˜¤ë¥˜: í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸ ëˆ„ë½.\", \"error\");\n    htmlOutput += \"</body>\\n</html>\";\n\n    const blob = new Blob([htmlOutput],{type:\"text/html;charset=utf-8\"});\n    const a=document.createElement(\"a\");\n    a.href=URL.createObjectURL(blob);\n    a.download = getSaveFileName('html'); // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©\n    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href);\n    showMessage(\"HTML íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\");\n  }\n\n  function printPDF() {\n    if(currentlyActiveItemControlsElement) activateControls(null);\n    hideElementStyleControls();\n    clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];\n\n    const elementsToHide = [\n        floatingMenuToggleBtn, trueFullscreenBtn, multiZoomTriggerBtn, menuPanel,\n        selectionZoomOverlay, exitTrueFullscreenBtnActual, document.getElementById('customMessageBox'),\n        annotationDisplayToggleBtn, annotationSettingsToggleBtn, annotationSettingsPanel, memoAnnotationToggleBtn,\n        document.getElementById('monthlyNavigatorContainer') // ë„¤ë¹„ê²Œì´í„°ë„ ìˆ¨ê¹€\n    ];\n    const originalDisplays = elementsToHide.map(el => el ? el.style.display : null);\n    elementsToHide.forEach(el => { if(el) el.style.display = 'none'; });\n    document.querySelectorAll('.item-controls').forEach(ctrl => ctrl.style.display = 'none');\n\n\n    let tempImgForPrint = null;\n    if (annotationCanvas.width > 0 && annotationCanvas.height > 0 && (isDrawingFeatureActive || (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0))) {\n        try {\n            const dataUrl = annotationCanvas.toDataURL('image/png');\n            if (dataUrl !== 'data:,') {\n                tempImgForPrint = document.createElement('img');\n                tempImgForPrint.src = dataUrl;\n                Object.assign(tempImgForPrint.style, {\n                    position: 'absolute', top: annotationCanvas.offsetTop + 'px', left: annotationCanvas.offsetLeft + 'px',\n                    width: annotationCanvas.width + 'px', height: annotationCanvas.height + 'px',\n                    zIndex: '4', pointerEvents: 'none', display: 'block'\n                });\n                contentArea.appendChild(tempImgForPrint);\n            }\n        } catch (e) { console.error(\"Error generating annotation image for PDF:\", e); }\n    }\n    const originalCanvasDisplay = annotationCanvas.style.display;\n    if(annotationCanvas) annotationCanvas.style.display = 'none';\n\n    const originalBodyPaddingTop = document.body.style.paddingTop;\n    const originalPageTitlePosition = pageTitle.style.position;\n    const originalContainerPaddingTop = contentArea.style.paddingTop;\n\n\n    document.body.style.paddingTop = '0px';\n    contentArea.style.paddingTop = '0px'; // ì¸ì‡„ ì‹œì—ëŠ” íŒ¨ë”© ì œê±°\n    if (getComputedStyle(pageTitle).position === 'fixed' || getComputedStyle(pageTitle).position === 'sticky') {\n        pageTitle.style.position = 'relative';\n    }\n    window.scrollTo(0, 0);\n\n    const pdfOptions = {\n        margin: [5, 5, 5, 5],\n        filename: getSaveFileName('pdf'), // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©\n        image: { type: 'jpeg', quality: 0.98 },\n        html2canvas: {\n            scale: 2,\n            useCORS: true,\n            logging: false,\n            removeContainer: true,\n            scrollY: 0,\n            windowWidth: document.documentElement.scrollWidth,\n            windowHeight: document.documentElement.scrollHeight,\n        },\n        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },\n        enableLinks: true\n    };\n\n    showMessage(\"PDF ìƒì„± ì¤€ë¹„ ì¤‘...\", \"success\", 2000);\n\n    setTimeout(() => {\n        html2pdf().from(appContainer).set(pdfOptions).save()\n        .then(() => {\n            showMessage(\"PDF ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\");\n        }).catch(err => {\n            console.error(\"PDF ìƒì„± ì˜¤ë¥˜:\", err);\n            showMessage(\"PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\", \"error\");\n        }).finally(() => {\n            if (tempImgForPrint && contentArea.contains(tempImgForPrint)) contentArea.removeChild(tempImgForPrint);\n            if(annotationCanvas) annotationCanvas.style.display = originalCanvasDisplay;\n\n            elementsToHide.forEach((el, i) => { if(el) el.style.display = originalDisplays[i] || ''; });\n            const checkedMode = document.querySelector('input[name=\"editIconsMode\"]:checked');\n            if(checkedMode) toggleEditIconsVisibility(checkedMode.value);\n\n\n            pageTitle.style.position = originalPageTitlePosition;\n            // íŒ¨ë”© ì›ìƒë³µêµ¬\n            adjustContainerPadding();\n            fullscreenChangeHandler();\n        });\n    }, 300);\n  }\n\n  // body í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ì´ì½˜ í‘œì‹œ/ìˆ¨ê¹€ì„ ì „ì—­ì ìœ¼ë¡œ ì œì–´\n  function toggleEditIconsVisibility(mode) {\n      if(!mode) return;\n      localStorage.setItem('editIconsMode', mode);\n      \n      document.body.classList.remove('show-icons-all', 'show-icons-selected');\n\n      if (mode === 'all') {\n          document.body.classList.add('show-icons-all');\n      } else if (mode === 'selected') {\n          document.body.classList.add('show-icons-selected');\n      }\n      // 'off' mode needs no class, as the default is to hide the controls.\n  }\n\n\n  // --- Annotation Functionality (Largely unchanged) ---\n  function updateAnnotationDisplayToggleBtnStyle() {\n    if(!annotationDisplayToggleBtn) return;\n    if (isDrawingFeatureActive) {\n        annotationDisplayToggleBtn.classList.add('active');\n        annotationDisplayToggleBtn.title = \"ì£¼ì„ ë„ê¸°\";\n    } else {\n        annotationDisplayToggleBtn.classList.remove('active');\n        annotationDisplayToggleBtn.title = \"ì£¼ì„ ì¼œê¸°\";\n    }\n  }\n\n  function loadPanelUIWithSettings(settings) {\n    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {\n        if(btn) btn.classList.remove('tool-active');\n    });\n    const activeBtn = document.querySelector(`#annotationSettingsPanel button[data-tool=\"${settings.tool}\"]`);\n    if (activeBtn) activeBtn.classList.add('tool-active');\n\n\n    if (settings.tool === 'highlighter') {\n        annoColorPicker.value = settings.highlighterColor;\n        annoLineWidthSlider.value = settings.highlighterLineWidth;\n        annoHighlighterOpacitySlider.value = settings.highlighterOpacity;\n        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'flex';\n    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {\n        annoColorPicker.value = settings.penColor;\n        annoLineWidthSlider.value = settings.penLineWidth;\n        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';\n    } else {\n        annoLineWidthSlider.value = settings.penLineWidth;\n        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';\n    }\n  }\n\n  function applySettingsToContext(settings) {\n    if (!annotationCtx) return;\n    annotationCtx.globalCompositeOperation = 'source-over';\n\n    if (settings.tool === 'highlighter') {\n        annotationCtx.strokeStyle = settings.highlighterColor;\n        annotationCtx.lineWidth = settings.highlighterLineWidth;\n        annotationCtx.globalAlpha = 1.0 - parseFloat(settings.highlighterOpacity);\n    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {\n        annotationCtx.strokeStyle = settings.penColor;\n        annotationCtx.lineWidth = settings.penLineWidth;\n        annotationCtx.globalAlpha = 1.0;\n    } else if (settings.tool === 'eraser') {\n        annotationCtx.lineWidth = settings.penLineWidth;\n        annotationCtx.globalAlpha = 1.0;\n    }\n  }\n\n  function setAnnotationDefaults() {\n    drawingSettings = {\n        tool: 'pen',\n        penColor: '#800080', penLineWidth: '5',\n        highlighterColor: '#FFFFE0', highlighterLineWidth: '20', highlighterOpacity: '0.3',\n    };\n    panelUISettings = { ...drawingSettings };\n    if(annoKeepDrawingsVisibleCheckbox) keepDrawingsVisibleOnDeactivate = annoKeepDrawingsVisibleCheckbox.checked;\n    if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;\n    if(annoHighlighterOpacitySlider) annoHighlighterOpacitySlider.value = drawingSettings.highlighterOpacity;\n  }\n\n  function redrawAllStrokes() {\n    if (!annotationCtx || !annotationCanvas) return;\n    annotationCtx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);\n    drawnStrokes.forEach(stroke => {\n        annotationCtx.beginPath();\n        annotationCtx.lineWidth = stroke.lineWidth;\n        annotationCtx.strokeStyle = stroke.color;\n        annotationCtx.globalAlpha = stroke.opacity;\n        annotationCtx.globalCompositeOperation = 'source-over';\n\n        if (stroke.type === 'path' || stroke.type === 'line') {\n            annotationCtx.moveTo(stroke.points[0].x, stroke.points[0].y);\n            for (let i = 1; i < stroke.points.length; i++) {\n                annotationCtx.lineTo(stroke.points[i].x, stroke.points[i].y);\n            }\n            annotationCtx.stroke();\n        } else if (stroke.type === 'circle') {\n            annotationCtx.arc(stroke.x, stroke.y, stroke.radius, 0, Math.PI * 2);\n            annotationCtx.stroke();\n        } else if (stroke.type === 'ellipse') {\n            annotationCtx.ellipse(stroke.x, stroke.y, stroke.radiusX, stroke.radiusY, 0, 0, Math.PI * 2);\n            annotationCtx.stroke();\n        }\n    });\n    applySettingsToContext(drawingSettings);\n  }\n\n\n  function setupAnnotationCanvas() {\n    if (!contentArea || !annotationCanvas) return;\n\n    const isFs = document.body.classList.contains('true-fullscreen-active');\n    const newWidth = contentArea.scrollWidth;\n    const newHeight = contentArea.scrollHeight;\n\n    if (annotationCanvas.width !== newWidth || annotationCanvas.height !== newHeight) {\n        annotationCanvas.width = newWidth;\n        annotationCanvas.height = newHeight;\n    }\n\n    annotationCtx = annotationCanvas.getContext('2d');\n    annotationCtx.lineCap = 'round';\n    annotationCtx.lineJoin = 'round';\n\n    redrawAllStrokes();\n\n    annotationCanvas.style.top = `0px`;\n    annotationCanvas.style.left = `0px`;\n\n\n    if (isFs) {\n        annotationCanvas.style.display = isDrawingFeatureActive ? 'block' : (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none');\n        annotationCanvas.style.pointerEvents = isDrawingFeatureActive ? 'auto' : 'none';\n        annotationCanvas.style.cursor = (isDrawingFeatureActive && drawingSettings.tool === 'eraser') ? 'crosshair' :\n                                       (isDrawingFeatureActive) ? 'crosshair' : 'default';\n    } else {\n        annotationCanvas.style.display = (isDrawingFeatureActive || keepDrawingsVisibleOnDeactivate) && drawnStrokes.length > 0 ? 'block' : 'none';\n        annotationCanvas.style.pointerEvents = 'none';\n        annotationCanvas.style.cursor = 'default';\n    }\n    applySettingsToContext(drawingSettings);\n  }\n\n\n  function getAnnotationMousePos(event) {\n    const rect = annotationCanvas.getBoundingClientRect();\n    const scaleX = annotationCanvas.width / rect.width;\n    const scaleY = annotationCanvas.height / rect.height;\n    let clientX = event.clientX;\n    let clientY = event.clientY;\n    if (event.touches && event.touches.length > 0) {\n        clientX = event.touches[0].clientX;\n        clientY = event.touches[0].clientY;\n    }\n    return {\n        x: (clientX - rect.left) * scaleX,\n        y: (clientY - rect.top) * scaleY\n    };\n  }\n\n  let currentStroke = null;\n\n  function startAnnotationDrawing(e) {\n    if (!isDrawingFeatureActive || (e.button !== undefined && e.button !== 0) ) {\n        return;\n    }\n    if(isDrawingFeatureActive) e.preventDefault();\n\n\n    if (isMemoModeActive) return;\n\n    const pos = getAnnotationMousePos(e);\n\n    if (drawingSettings.tool === 'eraser') {\n        eraseStrokeAtPoint(pos);\n        isDrawingAnnotation = false;\n        return;\n    }\n\n    applySettingsToContext(drawingSettings);\n    isDrawingAnnotation = true;\n    shapeStartX = pos.x;\n    shapeStartY = pos.y;\n    lastAnnotationX = pos.x;\n    lastAnnotationY = pos.y;\n\n\n    if (drawingSettings.tool === 'orthoLine' || drawingSettings.tool === 'circle' || drawingSettings.tool === 'ellipse' || (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter'))) {\n        if (annotationCanvas.width > 0 && annotationCanvas.height > 0) {\n            previewImageData = annotationCtx.getImageData(0, 0, annotationCanvas.width, annotationCanvas.height);\n        } else { previewImageData = null;}\n        currentStroke = null;\n    } else if (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter') {\n        annotationCtx.beginPath();\n        annotationCtx.moveTo(pos.x, pos.y);\n        currentStroke = {\n            type: 'path',\n            tool: drawingSettings.tool,\n            color: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor,\n            lineWidth: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth,\n            opacity: drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0,\n            points: [pos]\n        };\n    }\n  }\n\n  function drawAnnotation(e) {\n    if (!isDrawingAnnotation || !isDrawingFeatureActive ) return;\n    if (isMemoModeActive || drawingSettings.tool === 'eraser') return;\n    if(isDrawingFeatureActive) e.preventDefault();\n    const pos = getAnnotationMousePos(e);\n\n    if (previewImageData) annotationCtx.putImageData(previewImageData, 0, 0);\n    applySettingsToContext(drawingSettings);\n    annotationCtx.beginPath();\n\n    if ((isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) || drawingSettings.tool === 'orthoLine') {\n        let endX = pos.x;\n        let endY = pos.y;\n        if (drawingSettings.tool === 'orthoLine') {\n            if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }\n            else { endX = shapeStartX; }\n        }\n        annotationCtx.moveTo(shapeStartX, shapeStartY);\n        annotationCtx.lineTo(endX, endY);\n    } else if (drawingSettings.tool === 'circle') {\n        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));\n        annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);\n    } else if (drawingSettings.tool === 'ellipse') {\n        const radiusX = Math.abs(pos.x - shapeStartX) / 2;\n        const radiusY = Math.abs(pos.y - shapeStartY) / 2;\n        const centerX = shapeStartX + (pos.x - shapeStartX) / 2;\n        const centerY = shapeStartY + (pos.y - shapeStartY) / 2;\n        annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);\n    } else {\n        if (!currentStroke) return;\n        annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);\n        for(let i = 1; i < currentStroke.points.length; i++) {\n            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);\n        }\n        annotationCtx.lineTo(pos.x, pos.y);\n    }\n    annotationCtx.stroke();\n\n    if (!isShiftKeyDown && drawingSettings.tool !== 'circle' && drawingSettings.tool !== 'ellipse' && drawingSettings.tool !== 'orthoLine' && currentStroke) {\n        currentStroke.points.push(pos);\n    }\n\n    lastAnnotationX = pos.x;\n    lastAnnotationY = pos.y;\n  }\n\n  function stopAnnotationDrawing(e) {\n    if (!isDrawingAnnotation) {\n        return;\n    }\n    if (isMemoModeActive || drawingSettings.tool === 'eraser') {\n        isDrawingAnnotation = false;\n        currentStroke = null;\n        previewImageData = null;\n        return;\n    }\n    if(isDrawingFeatureActive) e.preventDefault();\n\n    const pos = getAnnotationMousePos(e);\n    if (previewImageData) {\n        annotationCtx.putImageData(previewImageData, 0, 0);\n        previewImageData = null;\n    }\n    applySettingsToContext(drawingSettings);\n    annotationCtx.beginPath();\n\n    let newStroke = null;\n    let endX = pos.x;\n    let endY = pos.y;\n\n    if (drawingSettings.tool === 'orthoLine') {\n        if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }\n        else { endX = shapeStartX; }\n         annotationCtx.moveTo(shapeStartX, shapeStartY);\n         annotationCtx.lineTo(endX, endY);\n         newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: endX, y: endY}] };\n    } else if (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) {\n        annotationCtx.moveTo(shapeStartX, shapeStartY);\n        annotationCtx.lineTo(pos.x, pos.y);\n        newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: pos.x, y: pos.y}] };\n    } else if (drawingSettings.tool === 'circle') {\n        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));\n        if (radius > 0.1) {\n            annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);\n            newStroke = { type: 'circle', tool: drawingSettings.tool, x: shapeStartX, y: shapeStartY, radius: radius };\n        }\n    } else if (drawingSettings.tool === 'ellipse') {\n        const radiusX = Math.abs(pos.x - shapeStartX) / 2;\n        const radiusY = Math.abs(pos.y - shapeStartY) / 2;\n        if (radiusX > 0.1 && radiusY > 0.1) {\n            const centerX = shapeStartX + (pos.x - shapeStartX) / 2;\n            const centerY = shapeStartY + (pos.y - shapeStartY) / 2;\n            annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);\n            newStroke = { type: 'ellipse', tool: drawingSettings.tool, x: centerX, y: centerY, radiusX: radiusX, radiusY: radiusY };\n        }\n    } else if (currentStroke && currentStroke.points.length > 0) {\n         currentStroke.points.push(pos);\n         annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);\n         for(let i=1; i < currentStroke.points.length; i++) {\n            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);\n         }\n         newStroke = { ...currentStroke };\n    }\n\n    if (newStroke) {\n        newStroke.color = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor;\n        newStroke.lineWidth = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth;\n        newStroke.opacity = drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0;\n        drawnStrokes.push(newStroke);\n        annotationCtx.stroke();\n    }\n\n    isDrawingAnnotation = false;\n    currentStroke = null;\n  }\n\n  function distToSegmentSquared(p, v, w) {\n    const l2 = (v.x - w.x)**2 + (v.y - w.y)**2;\n    if (l2 === 0) return (p.x - v.x)**2 + (p.y - v.y)**2;\n    let t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\n    t = Math.max(0, Math.min(1, t));\n    const closestX = v.x + t * (w.x - v.x);\n    const closestY = v.y + t * (w.y - v.y);\n    return (p.x - closestX)**2 + (p.y - closestY)**2;\n  }\n\n\n  function eraseStrokeAtPoint(clickPos) {\n    if(drawingSettings.tool !== 'eraser') return;\n    let erased = false;\n    const clickTolerance = 10;\n\n    for (let i = drawnStrokes.length - 1; i >= 0; i--) {\n        const stroke = drawnStrokes[i];\n        const strokeWidth = parseFloat(stroke.lineWidth || drawingSettings.penLineWidth);\n        const tolerance = (strokeWidth / 2) + clickTolerance;\n        let hit = false;\n\n        if (stroke.type === 'path' || stroke.type === 'line') {\n            for (let j = 0; j < stroke.points.length - 1; j++) {\n                if (distToSegmentSquared(clickPos, stroke.points[j], stroke.points[j+1]) < tolerance**2) {\n                    hit = true; break;\n                }\n            }\n            if (!hit && stroke.points.length === 1) {\n                 if (distToSegmentSquared(clickPos, stroke.points[0], stroke.points[0]) < tolerance**2) hit = true;\n            }\n        } else if (stroke.type === 'circle') {\n            const dist = Math.sqrt(Math.pow(clickPos.x - stroke.x, 2) + Math.pow(clickPos.y - stroke.y, 2));\n            if (Math.abs(dist - stroke.radius) < tolerance ) hit = true;\n        } else if (stroke.type === 'ellipse') {\n            const dx = clickPos.x - stroke.x;\n            const dy = clickPos.y - stroke.y;\n            const normalizedX = dx / (stroke.radiusX + tolerance);\n            const normalizedY = dy / (stroke.radiusY + tolerance);\n            if ((normalizedX * normalizedX) + (normalizedY * normalizedY) <= 1) {\n                hit = true;\n            }\n        }\n\n        if (hit) {\n            drawnStrokes.splice(i, 1);\n            erased = true;\n            break;\n        }\n    }\n    if (erased) {\n        redrawAllStrokes();\n        showMessage(\"ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\", 1000);\n    }\n  }\n\n\n  // --- Annotation Feature Toggles and Panel Controls ---\n  function toggleDrawingFeature() {\n      if (isMemoModeActive) {\n          isMemoModeActive = false;\n          memoAnnotationToggleBtn.classList.remove('active');\n          if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.remove('active');\n          contentArea.style.cursor = 'auto';\n          showMessage(\"ë©”ëª¨ ëª¨ë“œ ë¹„í™œì„±í™”ë¨.\", \"success\", 1500);\n      }\n\n      isDrawingFeatureActive = !isDrawingFeatureActive;\n      updateAnnotationDisplayToggleBtnStyle();\n      if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);\n\n      if (isDrawingFeatureActive) {\n          annotationCanvas.style.display = 'block';\n          if (document.body.classList.contains('true-fullscreen-active')) {\n              annotationCanvas.style.pointerEvents = 'auto';\n          } else {\n              annotationCanvas.style.pointerEvents = 'none';\n          }\n          applySettingsToContext(drawingSettings);\n          showMessage(\"ì£¼ì„ ê·¸ë¦¬ê¸° í™œì„±í™”ë¨.\", \"success\", 1500);\n      } else {\n          annotationCanvas.style.pointerEvents = 'none';\n          annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';\n          if (isAnnotationPanelOpen) {\n              isAnnotationPanelOpen = false;\n              annotationSettingsPanel.style.display = 'none';\n              annotationSettingsToggleBtn.classList.remove('active');\n              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');\n          }\n          showMessage(\"ì£¼ì„ ê·¸ë¦¬ê¸° ë¹„í™œì„±í™”ë¨.\", \"success\", 1500);\n      }\n      setupAnnotationCanvas();\n  }\n\n  function toggleAnnotationSettingsPanel() {\n      if (!isDrawingFeatureActive && document.body.classList.contains('true-fullscreen-active')) {\n          showMessage(\"ì£¼ì„ ê·¸ë¦¬ê¸°ë¥¼ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ğŸ‘ï¸ ì•„ì´ì½˜).\", \"warning\");\n          return;\n      }\n      if (!isDrawingFeatureActive && !document.body.classList.contains('true-fullscreen-active')) {\n          showMessage(\"ì£¼ì„ ê¸°ëŠ¥ì„ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ë©”ë‰´ ì—´ê¸° > ì£¼ì„ ì¼œê¸°/ë„ê¸°).\", \"warning\");\n          return;\n      }\n\n\n      isAnnotationPanelOpen = !isAnnotationPanelOpen;\n      annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';\n      annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);\n      if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen);\n\n      if (isAnnotationPanelOpen) {\n          panelUISettings = { ...drawingSettings };\n          loadPanelUIWithSettings(panelUISettings);\n      } else {\n          drawingSettings = { ...panelUISettings };\n          applySettingsToContext(drawingSettings);\n      }\n      setupAnnotationCanvas();\n  }\n  \n  function handleAnnotationToolClick(e) {\n    const newTool = e.target.closest('button').dataset.tool;\n\n    if (newTool === 'eraser') {\n        panelUISettings.tool = (panelUISettings.tool === 'eraser') ? 'pen' : 'eraser';\n    } else {\n        panelUISettings.tool = newTool;\n    }\n\n    if (panelUISettings.tool === 'highlighter') {\n        panelUISettings.highlighterColor = panelUISettings.highlighterColor || drawingSettings.highlighterColor;\n        panelUISettings.highlighterLineWidth = panelUISettings.highlighterLineWidth || drawingSettings.highlighterLineWidth;\n        panelUISettings.highlighterOpacity = panelUISettings.highlighterOpacity || drawingSettings.highlighterOpacity;\n    } else if (['pen', 'circle', 'ellipse', 'orthoLine'].includes(panelUISettings.tool)) {\n         panelUISettings.penColor = panelUISettings.penColor || drawingSettings.penColor;\n         panelUISettings.penLineWidth = panelUISettings.penLineWidth || drawingSettings.penLineWidth;\n    }\n\n    loadPanelUIWithSettings(panelUISettings);\n    applySettingsToContext(panelUISettings);\n    setupAnnotationCanvas();\n  }\n  \n  function handleCloseAnnotationSettings() {\n    drawingSettings = { ...panelUISettings };\n    applySettingsToContext(drawingSettings);\n    isAnnotationPanelOpen = false;\n    annotationSettingsPanel.style.display = 'none';\n    annotationSettingsToggleBtn.classList.remove('active');\n    if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');\n    setupAnnotationCanvas();\n    showMessage(\"ì£¼ì„ ì„¤ì • ì ìš©ë¨.\", \"success\", 1500);\n  }\n\n  function handleMenuKeepDrawingsToggle(isChecked) {\n    keepDrawingsVisibleOnDeactivate = isChecked;\n    if(annoKeepDrawingsVisibleCheckbox) annoKeepDrawingsVisibleCheckbox.checked = keepDrawingsVisibleOnDeactivate;\n    if (!isDrawingFeatureActive && annotationCanvas) {\n        annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';\n    }\n  }\n\n  function handleClearCanvasClick() {\n    if (!isDrawingFeatureActive) {\n         showMessage(\"ì£¼ì„ ê·¸ë¦¬ê¸° ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\", \"warning\"); return;\n    }\n    drawnStrokes = [];\n    redrawAllStrokes();\n    showMessage(\"ëª¨ë“  ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\", \"success\", 1500);\n  }\n\n\n  // --- Memo Annotation Functionality ---\n  function handleMemoToggleClick() {\n    const isFs = document.body.classList.contains('true-fullscreen-active');\n    if (!isFs) {\n        showMessage(\"ë©”ëª¨ ì¶”ê°€ëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\", \"warning\");\n        return;\n    }\n    toggleMemoMode();\n  }\n  \n  function handleMenuMemoToggleClick() {\n    handleMemoToggleClick();\n    if(menuPanel.style.display === \"block\") togglePanel();\n  }\n\n  function toggleMemoMode() {\n      isMemoModeActive = !isMemoModeActive;\n      memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);\n      if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive);\n      contentArea.style.cursor = isMemoModeActive ? 'copy' : 'auto';\n\n      if (isMemoModeActive) {\n          if (isDrawingFeatureActive) {\n              isDrawingFeatureActive = false;\n              isAnnotationPanelOpen = false;\n              annotationSettingsPanel.style.display = 'none';\n              annotationSettingsToggleBtn.classList.remove('active');\n              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');\n              annotationCanvas.style.pointerEvents = 'none';\n              annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';\n              updateAnnotationDisplayToggleBtnStyle();\n              if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.remove('active');\n          }\n          showMessage(\"ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ í™œì„±í™”. ë‚´ìš©ì„ í´ë¦­í•˜ì—¬ ë©”ëª¨ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.\", \"success\", 2500);\n      } else {\n          showMessage(\"ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™”.\", \"success\", 1500);\n      }\n  }\n\n\n  contentArea.addEventListener('click', function(event) {\n    if (isMemoModeActive && document.body.classList.contains('true-fullscreen-active')) {\n        if (event.target.closest('[data-editable-type], .text-annotation-memo, button, a, input, select, textarea, .item-controls')) {\n            return;\n        }\n        if (event.detail === 0 && event.clientX === 0 && event.clientY === 0) {\n            return;\n        }\n\n        const rect = contentArea.getBoundingClientRect();\n        const x = event.clientX - rect.left + contentArea.scrollLeft;\n        const y = event.clientY - rect.top + contentArea.scrollTop;\n\n        createMemoAnnotation(x, y);\n    }\n  });\n\n  function createMemoAnnotation(x, y) {\n    const memoDiv = document.createElement('div');\n    memoDiv.className = 'text-annotation-memo';\n    memoDiv.setAttribute('contenteditable', 'true');\n    memoDiv.style.left = Math.max(0, x - 10) + 'px';\n    memoDiv.style.top = Math.max(0, y - 10) + 'px';\n    memoDiv.textContent = 'ë©”ëª¨ ì…ë ¥...';\n\n    const deleteBtn = document.createElement('span');\n    deleteBtn.innerHTML = '&times;';\n    deleteBtn.className = 'memo-delete-btn';\n    deleteBtn.title = 'ë©”ëª¨ ì‚­ì œ';\n    // Event listener for this will be handled by event delegation\n    memoDiv.appendChild(deleteBtn);\n\n    contentArea.appendChild(memoDiv);\n    makeMemoDraggable(memoDiv);\n    setTimeout(() => {\n        memoDiv.focus();\n        const selection = window.getSelection();\n        const range = document.createRange();\n        if (memoDiv.firstChild && memoDiv.firstChild.nodeType === Node.TEXT_NODE) {\n            range.selectNodeContents(memoDiv.firstChild);\n            selection.removeAllRanges();\n            selection.addRange(range);\n        }\n    }, 0);\n  }\n  \n  contentArea.addEventListener('click', function(event) {\n      // Memo delete button delegation\n      const deleteBtn = event.target.closest('.memo-delete-btn');\n      if (deleteBtn) {\n          event.stopPropagation();\n          const memoDiv = deleteBtn.closest('.text-annotation-memo');\n          if (memoDiv) {\n              memoDiv.remove();\n          }\n      }\n  });\n\n  function makeMemoDraggable(memoElement) {\n    let currentX, currentY, initialMouseX, initialMouseY, isDraggingMemo = false;\n\n    memoElement.addEventListener('mousedown', (e) => {\n        if (e.target.closest('.memo-delete-btn') || document.activeElement === memoElement) {\n            const style = window.getComputedStyle(memoElement);\n            const borderWidth = parseFloat(style.borderLeftWidth);\n            const paddingLeft = parseFloat(style.paddingLeft);\n            const paddingRight = parseFloat(style.paddingRight);\n            const edgeThreshold = 10;\n\n            if (e.offsetX < paddingLeft + borderWidth + edgeThreshold ||\n                e.offsetX > memoElement.clientWidth - paddingRight - borderWidth - edgeThreshold ||\n                e.offsetY < parseFloat(style.paddingTop) + parseFloat(style.borderTopWidth) + edgeThreshold ||\n                e.offsetY > memoElement.clientHeight - parseFloat(style.paddingBottom) - parseFloat(style.borderBottomWidth) - edgeThreshold\n            ) {\n            } else if (memoElement.contains(document.activeElement) && document.activeElement.isContentEditable) {\n                return;\n            }\n        }\n\n\n        isDraggingMemo = true;\n        memoElement.style.cursor = 'grabbing';\n        currentX = memoElement.offsetLeft;\n        currentY = memoElement.offsetTop;\n        initialMouseX = e.clientX;\n        initialMouseY = e.clientY;\n\n        document.addEventListener('mousemove', onMemoDrag);\n        document.addEventListener('mouseup', onMemoDragEnd);\n        e.stopPropagation();\n    });\n\n    function onMemoDrag(e) {\n        if (!isDraggingMemo) return;\n        e.preventDefault();\n\n        let deltaX = e.clientX - initialMouseX;\n        let deltaY = e.clientY - initialMouseY;\n\n        let newLeft = currentX + deltaX;\n        let newTop = currentY + deltaY;\n\n        newLeft = Math.max(0, Math.min(newLeft, contentArea.scrollWidth - memoElement.offsetWidth));\n        newTop = Math.max(0, Math.min(newTop, contentArea.scrollHeight - memoElement.offsetHeight));\n\n\n        memoElement.style.left = newLeft + 'px';\n        memoElement.style.top = newTop + 'px';\n    }\n\n    function onMemoDragEnd() {\n        if (!isDraggingMemo) return;\n        isDraggingMemo = false;\n        memoElement.style.cursor = 'move';\n        document.removeEventListener('mousemove', onMemoDrag);\n        document.removeEventListener('mouseup', onMemoDragEnd);\n    }\n}\n\n\n  // --- Annotation Canvas Event Listeners ---\n  function initializeAnnotationCanvasListeners() {\n    annotationCanvas.addEventListener('mousedown', startAnnotationDrawing);\n    annotationCanvas.addEventListener('mousemove', drawAnnotation);\n    annotationCanvas.addEventListener('mouseup', stopAnnotationDrawing);\n    annotationCanvas.addEventListener('mouseout', (e) => {\n      if (isDrawingAnnotation) {\n          stopAnnotationDrawing(e);\n      }\n    });\n    annotationCanvas.addEventListener('touchstart', (e) => { if(e.touches.length===1){e.preventDefault(); startAnnotationDrawing(e.touches[0]);}}, {passive:false});\n    annotationCanvas.addEventListener('touchmove', (e) => { if(e.touches.length===1){e.preventDefault(); drawAnnotation(e.touches[0]);}}, {passive:false});\n    annotationCanvas.addEventListener('touchend', (e) => { if(e.changedTouches.length===1){e.preventDefault(); stopAnnotationDrawing(e.changedTouches[0]);}});\n    annotationCanvas.addEventListener('touchcancel', () => {\n        if (isDrawingAnnotation) {\n            if (previewImageData) { annotationCtx.putImageData(previewImageData, 0, 0); previewImageData = null; }\n            isDrawingAnnotation = false; currentStroke = null;\n        }\n    });\n  }\n  \n  \n  // --- CENTRAL EVENT LISTENER INITIALIZATION ---\n  function initializeEventListeners() {\n    // Global and Fullscreen\n    exitTrueFullscreenBtnActual.addEventListener('click', exitTrueFullscreen);\n    trueFullscreenBtn.addEventListener('click', toggleTrueFullscreen);\n    \n    // Main Menu Panel\n    floatingMenuToggleBtn.addEventListener('click', togglePanel);\n    closeMenuPanelBtn.addEventListener('click', handleCloseMenuPanel);\n    \n    // Zoom\n    multiZoomTriggerBtn.addEventListener('click', handleMultiZoomTrigger);\n    selectionZoomOverlay.addEventListener('click', handleSelectionZoomOverlayClick);\n    \n    // Main Content Interaction\n    appContainer.addEventListener('click', handleAppContainerClick);\n    document.addEventListener('click', handleDocumentClick);\n    \n    // Keyboard\n    document.addEventListener('keydown', handleKeyDown);\n    document.addEventListener('keyup', handleKeyUp);\n    window.addEventListener('blur', () => {\n        document.body.classList.remove('ctrl-pressed');\n        isShiftKeyDown = false;\n    });\n    \n    // --- Menu Panel Buttons ---\n    // Icons Visibility\n    document.querySelectorAll('input[name=\"editIconsMode\"]').forEach(radio => {\n        radio.addEventListener('change', (e) => toggleEditIconsVisibility(e.target.value));\n    });\n    \n    // Link Editing\n    document.getElementById('applyLinkBtn').addEventListener('click', applyLink);\n    document.getElementById('removeLinkBtn').addEventListener('click', removeLink);\n    \n    // Text Formatting\n    document.getElementById('applyBoldBtn').addEventListener('click', applyBold);\n    document.getElementById('applyItalicBtn').addEventListener('click', applyItalic);\n    document.getElementById('applyUnderlineBtn').addEventListener('click', applyUnderline);\n    document.getElementById('applyStrikethroughBtn').addEventListener('click', applyStrikethrough);\n    document.getElementById('applySuperscriptBtn').addEventListener('click', applySuperscript);\n    document.getElementById('applySubscriptBtn').addEventListener('click', applySubscript);\n    document.getElementById('fontSizeSelector').addEventListener('change', (e) => changeFontSize(e.target.value));\n    document.getElementById('fontColorSelector').addEventListener('input', (e) => changeFontColor(e.target.value));\n    document.getElementById('backColorSelector').addEventListener('input', (e) => changeBackColor(e.target.value));\n\n    // Character / Emoji Insertion\n    document.getElementById('emojiDropdownBtn').addEventListener('click', toggleEmojiPalette);\n    document.getElementById('emojiPalette').addEventListener('click', handleEmojiPaletteButtonClick);\n    document.getElementById('insertCharFromInputBtn').addEventListener('click', insertCharacterFromInput);\n\n    // Save/Print\n    document.getElementById('saveHtmlBtn').addEventListener('click', saveHTML);\n    document.getElementById('printPdfBtn').addEventListener('click', printPDF);\n    \n    // Element Styling\n    document.getElementById('elementBgColor').addEventListener('input', (e) => applySelectedElementStyle('backgroundColor', e.target.value));\n    document.getElementById('elementTextColor').addEventListener('input', (e) => applySelectedElementStyle('color', e.target.value));\n    document.getElementById('elementBorderRadius').addEventListener('input', (e) => applySelectedElementStyle('borderRadius', e.target.value + 'px'));\n    document.getElementById('elementShapeSelector').addEventListener('change', (e) => applySelectedElementShape(e.target.value));\n    \n    // --- Annotation ---\n    // Floating Buttons\n    annotationDisplayToggleBtn.addEventListener('click', toggleDrawingFeature);\n    annotationSettingsToggleBtn.addEventListener('click', toggleAnnotationSettingsPanel);\n    memoAnnotationToggleBtn.addEventListener('click', handleMemoToggleClick);\n    \n    // Annotation Panel\n    closeAnnotationSettingsBtn.addEventListener('click', handleCloseAnnotationSettings);\n    annoColorPicker.addEventListener('input', (e) => {\n      if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterColor = e.target.value; }\n      else { panelUISettings.penColor = e.target.value; }\n      applySettingsToContext(panelUISettings);\n    });\n    annoLineWidthSlider.addEventListener('input', (e) => {\n        const newWidth = e.target.value;\n        if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterLineWidth = newWidth; }\n        else if (['pen', 'circle', 'ellipse', 'orthoLine', 'eraser'].includes(panelUISettings.tool)) { panelUISettings.penLineWidth = newWidth; }\n        applySettingsToContext(panelUISettings);\n    });\n    annoHighlighterOpacitySlider.addEventListener('input', (e) => {\n        panelUISettings.highlighterOpacity = e.target.value;\n        applySettingsToContext(panelUISettings);\n    });\n    annoKeepDrawingsVisibleCheckbox.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));\n    annoClearCanvasBtn.addEventListener('click', handleClearCanvasClick);\n    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {\n        if (btn) btn.addEventListener('click', handleAnnotationToolClick);\n    });\n    \n    // Menu Panel Annotation Controls\n    menuAnnoKeepDrawingsVisible.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));\n    menuAnnoDrawingToggle.addEventListener('click', toggleDrawingFeature);\n    menuAnnoSettingsPanelToggle.addEventListener('click', toggleAnnotationSettingsPanel);\n    menuMemoAnnotationBtn.addEventListener('click', handleMenuMemoToggleClick);\n\n    // Canvas Listeners\n    initializeAnnotationCanvasListeners();\n  }\n\n\n  // --- Application Initialization on DOMContentLoaded ---\n  window.addEventListener('DOMContentLoaded', () => {\n    document.body.classList.add('meeting-cursor');\n    window.addEventListener('beforeunload', () => {\n        document.body.classList.remove('meeting-cursor');\n    });\n\n    if (pageTitle) {\n        let titleText = pageTitle.innerHTML;\n        // ì €ì¥ëœ ìƒíƒœê°€ ì—†ì„ ë•Œë§Œ YY, MMì„ í˜„ì¬ ë‚ ì§œë¡œ êµì²´ (ìˆ˜ì •ë¨: ì›ë³¸ íŒŒì¼ì˜ ì œëª©ì„ ìš°ì„ í•˜ë„ë¡)\n        if (typeof window.__SAVED_APP_STATE__ === 'undefined' && titleText.includes('YYë…„')) {\n             const dateInfo = getFormattedDateForFilename();\n             titleText = titleText.replace(/YYë…„/g, `${dateInfo.yearYY}ë…„`).replace(/MMì›”/g, `${dateInfo.monthMM}ì›”`);\n             pageTitle.innerHTML = titleText;\n        }\n        document.title = titleText.includes('(') ? titleText.substring(0, titleText.indexOf('(')).trim() : titleText;\n        const editableTitleMeta = document.querySelector('meta[name=\"editable-title\"]');\n        if (editableTitleMeta) {\n            editableTitleMeta.content = document.title;\n        }\n    }\n\n\n    let parsedState = null;\n    if (typeof window.__SAVED_APP_STATE__ !== 'undefined') {\n        parsedState = window.__SAVED_APP_STATE__;\n    }\n    \n    if (parsedState) {\n        try {\n            if (parsedState.wasFullscreenActive) {\n                showMessage(\"ì´ ë¬¸ì„œëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. â›¶ ì•„ì´ì½˜ì„ í´ë¦­í•´ ë³µì›í•˜ì„¸ìš”.\", 'success', 5000);\n            }\n            // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ë³µì›\n            if (parsedState.monthlyNavigatorConfig) {\n                monthlyNavigatorConfig = parsedState.monthlyNavigatorConfig;\n            }\n\n            isDrawingFeatureActive = parsedState.isDrawingFeatureActive || false;\n            drawingSettings = parsedState.drawingSettings || drawingSettings;\n            panelUISettings = parsedState.panelUISettings || { ...drawingSettings };\n            keepDrawingsVisibleOnDeactivate = parsedState.keepDrawingsVisibleOnDeactivate !== undefined ? parsedState.keepDrawingsVisibleOnDeactivate : true;\n            drawnStrokes = parsedState.drawnStrokes || [];\n            isAnnotationPanelOpen = parsedState.isAnnotationPanelOpen || false;\n            isMemoModeActive = parsedState.isMemoModeActive || false;\n\n            if (pageTitle && parsedState.pageTitle_innerHTML) {\n                if(pageTitle.innerHTML !== parsedState.pageTitle_innerHTML) {\n                    pageTitle.innerHTML = parsedState.pageTitle_innerHTML;\n                }\n            }\n            if (contentArea && parsedState.contentArea_innerHTML) {\n                const canvasElement = contentArea.querySelector('#annotationCanvas');\n                const currentMemos = Array.from(contentArea.querySelectorAll('.text-annotation-memo'));\n                contentArea.innerHTML = parsedState.contentArea_innerHTML;\n\n                if (canvasElement && !contentArea.querySelector('#annotationCanvas')) {\n                    contentArea.insertBefore(canvasElement, contentArea.firstChild);\n                }\n                 currentMemos.forEach(memo => {\n                    if (!contentArea.contains(memo)) contentArea.appendChild(memo);\n                    makeMemoDraggable(memo);\n                 });\n            }\n\n            if (menuPanel) {\n                menuPanel.style.display = parsedState.menuPanel_style_display || 'none';\n                if (menuPanel.style.display !== 'none') {\n                    menuPanel.style.left = parsedState.menuPanel_style_left || '';\n                    menuPanel.style.top = parsedState.menuPanel_style_top || '';\n                    menuPanel.style.width = parsedState.menuPanel_style_width || '';\n                    menuPanel.style.height = parsedState.menuPanel_style_height || '';\n                    if (floatingMenuToggleBtn) {\n                         floatingMenuToggleBtn.innerHTML = 'âœ•';\n                         floatingMenuToggleBtn.title = 'ë©”ë‰´ ë‹«ê¸°';\n                    }\n                } else {\n                     if (floatingMenuToggleBtn) {\n                        floatingMenuToggleBtn.innerHTML = 'â˜°';\n                        floatingMenuToggleBtn.title = 'ë©”ë‰´ ì—´ê¸°';\n                     }\n                }\n            }\n            // Restore edit icons mode\n            const savedEditMode = parsedState.editIconsMode || 'off';\n            const radioToCheck = document.querySelector(`input[name=\"editIconsMode\"][value=\"${savedEditMode}\"]`);\n            if (radioToCheck) {\n                radioToCheck.checked = true;\n                toggleEditIconsVisibility(savedEditMode);\n            }\n\n        } catch (e) {\n            console.error(\"Error applying saved app state:\", e);\n            setAnnotationDefaults();\n        }\n    } else {\n        setAnnotationDefaults();\n        const radioOff = document.getElementById('editIconsModeOff');\n        if(radioOff) radioOff.checked = true;\n        toggleEditIconsVisibility('off');\n    }\n\n    // Connect all event listeners\n    initializeEventListeners();\n    \n    // ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´í„° ê¸°ëŠ¥ ì‹¤í–‰\n    initializeMonthlyNavigator();\n\n    elementsForMultiZoom = [];\n    updateMultiZoomTriggerVisibility();\n    adjustContainerPadding();\n\n    if (pageTitle) { \n        generateItemControls(pageTitle); \n        pageTitle.addEventListener('input', () => { \n            requestAnimationFrame(adjustContainerPadding); \n            // ì œëª©ì´ ë³€ê²½ë˜ë©´ ë„¤ë¹„ê²Œì´ì…˜ë„ ë‹¤ì‹œ ì´ˆê¸°í™”\n            initializeMonthlyNavigator();\n        }); \n    }\n    contentArea.querySelectorAll('[data-editable-type]:not(.text-annotation-memo)').forEach(el => generateItemControls(el));\n    contentArea.querySelectorAll('.text-annotation-memo').forEach(makeMemoDraggable);\n\n    updateAnnotationDisplayToggleBtnStyle();\n    if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);\n\n    if (document.fonts) {\n        document.fonts.ready.then(() => {\n            requestAnimationFrame(adjustContainerPadding);\n            requestAnimationFrame(setupAnnotationCanvas);\n        });\n    } else {\n        adjustContainerPadding();\n        setupAnnotationCanvas();\n    }\n    fullscreenChangeHandler();\n\n  });\n  window.addEventListener('resize', () => {\n    adjustContainerPadding();\n    setupAnnotationCanvas();\n  });\n</script>\n\n","menuPanel_style_display":"none","menuPanel_style_left":"","menuPanel_style_top":"","menuPanel_style_width":"","menuPanel_style_height":"","editIconsMode":"off"};
    </script>
</head>
<body>
<div id="appContainer">
    <button class="exit-true-fullscreen-btn" id="exitTrueFullscreenBtnActual" title="ê¸°ë³¸ ë³´ê¸°ë¡œ ëŒì•„ê°€ê¸°" style="display: none;">âœ•</button>
    <button class="fullscreen-btn-class" id="trueFullscreenBtn" title="ì „ì²´ í™”ë©´ ë³´ê¸°" style="display: block;">â›¶</button>
    <button class="floating-menu-icon" id="floatingMenuToggleBtn" title="ë©”ë‰´ ì—´ê¸°" style="display: block;">â˜°</button>
    <button id="multiZoomTriggerBtn" title="ì„ íƒëœ í•­ëª© ëª¨ë‘ í™•ëŒ€" style="display: none;">ğŸ”</button>

    <button id="annotationDisplayToggleBtn" title="ì£¼ì„ ì¼œê¸°" style="display: none;">ğŸ‘ï¸</button>
    <button id="annotationSettingsToggleBtn" title="ì£¼ì„ ì„¤ì •" style="display: none;">âš™ï¸</button>
    <button id="memoAnnotationToggleBtn" title="í…ìŠ¤íŠ¸ ë©”ëª¨ ì¶”ê°€ (ì „ì²´ í™”ë©´ì—ì„œ ë‚´ìš© ì˜ì—­ í´ë¦­)" style="display: none;">ğŸ“</button>

    <h1 id="page-title" contenteditable="true" data-editable-type="page-title">25ë…„ 06ì›” ì›”ê°„ ì—…ë¬´ íšŒì˜ ì•ˆê±´ (ê¸°ìˆ™ì‚¬ ë° ì‚¬íƒ)<div class="item-controls"><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button></div></h1>

    <!-- ì›”ë³„ ë„¤ë¹„ê²Œì´ì…˜ ë°”ê°€ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="monthlyNavigatorContainer" style="display: flex; top: 78px;"><div id="yearNavigator"><button id="prevYearBtn" title="ì´ì „ ì—°ë„">&lt;</button><span id="currentYearSpan">2025ë…„</span><button id="nextYearBtn" title="ë‹¤ìŒ ì—°ë„">&gt;</button></div><div id="monthLinksContainer"><span class="month-link active" title="1ì›” íšŒì˜ë¡ ë³´ê¸°">1ì›”</span><span class="month-link active" title="2ì›” íšŒì˜ë¡ ë³´ê¸°">2ì›”</span><span class="month-link active" title="3ì›” íšŒì˜ë¡ ë³´ê¸°">3ì›”</span><span class="month-link active" title="4ì›” íšŒì˜ë¡ ë³´ê¸°">4ì›”</span><span class="month-link active" title="5ì›” íšŒì˜ë¡ ë³´ê¸°">5ì›”</span><span class="month-link current" title="í˜„ì¬ íšŒì˜ë¡">6ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">7ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">8ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">9ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">10ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">11ì›”</span><span class="month-link disabled" title="ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡">12ì›”</span></div></div>

    <div class="container" id="content" contenteditable="true" style="padding-top: 194px;">
      <canvas id="annotationCanvas" width="1510" height="2168" style="pointer-events: none; display: none; top: 0px; left: 0px; cursor: default;"></canvas>
      <div class="section">
        <div class="section-title" data-editable-type="section-title"><font color="#050505"><font size="5">â†’</font> <font size="5"><a href="https://jonggunelee.github.io/wyggkr/01%20%EC%9B%94%EB%B3%84%20%EB%88%84%EC%A0%81%20%EC%A7%91%ED%96%89%EB%B9%84_(%EA%B8%B0%EC%88%99%EC%82%AC%20%EB%B0%8F%20%EC%82%AC%ED%83%9D)_2025-06-00.html" target="_blank" rel="noopener noreferrer">ì ˆê° ë° ì§‘í–‰ í˜„í™©</a> (ëˆ„ì )</font></font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
        <div class="section-subtitle" data-editable-type="section-subtitle"><font size="4">â–¶ ì ˆê°ì•¡ ì‚°ì¶œ ê¸°ì¤€</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="section-subtitle" data-editable-type="section-subtitle">&nbsp; &nbsp;&nbsp;<font size="3"><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">í•­ëª© ë°œêµ´ â¡ï¸<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">ê²€í† (í˜„ì‹¤ì„±) â¡ï¸<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">ë°˜ì˜(í˜‘ì˜) â¡ï¸<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">ê°œì„  ë° í™•ì¥(ì§€ì†ì„±<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span></font><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px; font-size: 0.95em;"><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
        <div class="box" data-editable-type="box">
          <div class="item item-bulleted-left" data-editable-type="item"> <span class="bullet-char"><div class="item item-bulleted-left" data-editable-type="item"><span class="bullet-char"><font size="3">â–ª</font><strong style=""><font size="3">í•­ëª©(ì‹¤ë¹„ì •ì‚° â‘ ì˜ˆì‹œ)&nbsp;</font></strong><font size="3">: <b>ê¸°ê³„ ê¸´ê¸‰ì„± (23ë…„ í•˜ë°˜ê¸°)</b> â¡ï¸ <b>ê±´ì¶•Â·ê¸°ê³„ ê·œëª¨ íŒŒì•… ë° í•©ì˜('24ë…„)</b> â¡ï¸ <b>ì§€ì†ì  ë³´ì™„('25ë…„~)</b></font><font size="5" color="#f70808">&nbsp;</font><b style=""><font style="" size="5" color="#f70808"><u style="">âˆ´</u></font><font size="3">&nbsp;ë™ì¼ ì¡°ê±´ 1:1 ì ˆê°ì•¡ ì‚°ì¶œ ë¶ˆê°€</font></b><font size="3">&nbsp;</font></span><span class="bullet-text"><font size="3"><br></font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item item-bulleted-left" data-editable-type="item"><span class="bullet-char"><font size="3">â–ª</font><strong style="font-size: medium;">ë¹„ìš©(ì‚°ì¶œê¸°ì¤€ â‘ </strong><strong style=""><font size="2">ì˜ˆì‹œ</font></strong><strong style="font-size: medium;">)&nbsp;</strong><span style="font-size: medium;">: </span><font size="3"><b>ê³µì‚¬ ì ìš©ì‹œ ì‚°ì¶œë¹„(ë³´ìˆ˜ì )</b> </font><font style="" size="2" color="#fb0945">â–</font><font size="3"> <b>ì‹¤ íˆ¬ì…ë¹„</b>&nbsp;&nbsp;</font><span style="background-color: rgb(224, 247, 250); font-size: x-large; font-weight: 700;"><font color="#757575">=</font></span><span style="font-size: medium;">&nbsp;</span><b style="font-size: medium;"><font color="#ee4f4f">ì°¨ì•¡(ì ˆê°ì•¡)</font></b><span style="font-size: medium;">&nbsp;<br></span><span style="font-size: medium;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; â€» <b style="background-color: rgb(246, 250, 0);">ê¸°ì‹¤ì </b> ë˜ëŠ” <b style="background-color: rgb(246, 248, 62);">ìµœì†Œ ì¸ê±´ë¹„ ê¸°ì¤€</b> ì ìš© (ìì¬ë¹„ ë¯¸ë°˜ì˜, ì„ íƒ ì ìš©)</span></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
        <div class="section-subtitle" data-editable-type="section-subtitle"><font size="4">â–¶ 5ì›”ë§ ì§‘í–‰ë¹„ í˜„í™©</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="section-subtitle" data-editable-type="section-subtitle">&nbsp; &nbsp;&nbsp;<span class="highlight" data-editable-type="flow-span" style="font-size: large; position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">ì´&nbsp;<font style="">4.</font><sup style=""><u>4</u></sup>ì²œë§Œì› (16ê±´)<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span class="highlight" data-editable-type="flow-span" style="position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;"><font color="#f01414" style="" size="5">=</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><font size="3"><span data-editable-type="flow-span" class="" style="position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;"><font color="#676565" style=""><b>ìˆ˜ì¥ê³µì‚¬&nbsp;2.<sup style=""><u>6</u>&nbsp;</sup>ì²œë§Œì› (6ê±´)</b></font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">â•<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;"><font color="#6c6a6a"><b>ê±´ì¶•(ì‹¤ë¹„ì •ì‚°)&nbsp;4.<sup><u>8</u>&nbsp;</sup>ë°±ë§Œì› (1ê±´)</b></font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><span data-editable-type="flow-span" class="" style="color: rgb(43, 43, 43); position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;">&nbsp;<span style="position: relative; border-radius: 20px; padding: 6px 12px;">â•</span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span></font><span data-editable-type="flow-span" class="" style="position: relative; background-color: rgb(224, 247, 250); border-radius: 20px; padding: 6px 12px;"><font color="#626060" style="" size="3"><b>ì„¸ëŒ€ë‚´ ë³´ì¼ëŸ¬ å¤–&nbsp;1.<sup style=""><u>3</u>&nbsp;</sup>ì²œë§Œì› (9ê±´)</b></font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
      <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>

      <div class="section">
        <div class="section-title" data-editable-type="section-title"><font color="#000000">â†’ ì£¼ìš” í˜„í™©</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char"><b>â–ª</b></span><span class="bullet-text"><font size="4" color="#000000"><b>ì—…ë¬´ì§€ì›íŒ€</b></font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="item" data-editable-type="item"><font size="3"><b>1. <a href="https://photos.app.goo.gl/X2jAqn11BmjXYmRHA" target="_blank" rel="noopener noreferrer">ìœ ëª¨ì°¨ ìš´ì˜ ê´€ë¦¬ ê²€í† </a> :&nbsp;</b>ì¥ì†Œ í™•ë³´(1ê°œì†Œ) + ìš°í¸í•¨ ìœ„ì¹˜ ì¡°ì • + ìì „ê±° ë³´ê´€ ë¶€ìŠ¤ ê°œì¡° + ì‹ ê·œ ë¶€ìŠ¤</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item" data-editable-type="item"><font size="3"><b>2. <a href="https://photos.app.goo.gl/tgiZM2btk9aahiBR9" target="_blank" rel="noopener noreferrer">102ë™ ì–´ë¦°ì´ì§‘ ë†€ì´í„° ì…êµ¬ì¸¡ í­ìš° ëŒ€ë¹„</a> : </b>ì„ì‹œ ë¬¼ë§‰ ë§‰ì´ ì„¤ì¹˜&nbsp; ( í”ŒëŸ¬ë“œë°± ë˜ëŠ” ëª¨ë˜ ì£¼ë¨¸ë‹ˆ )</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char"><b>â–ª</b></span><span class="bullet-text"><font size="4" color="#050505"><b>ê´€ë¦¬ì†Œ</b></font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="item" data-editable-type="item"><b>1. ì‹ ê·œ ì£¼ì°¨ êµ¬ì—­ ê´€ë¦¬</b><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item" data-editable-type="item"><b><font size="3">2. ìˆ˜ì¡° ì²­ì†Œì¼ :</font></b>&nbsp;<span class="highlight" style="font-weight: normal;"><font color="#000000">6ì›” 11ì¼(ìˆ˜)</font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char"><font size="4"><b>â–ª</b></font></span><span class="bullet-text"><font size="4"><b>ê³µí†µ</b></font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="insert-area" contenteditable="true" data-editable-type="insert-area"><font size="3"><b>1. <a href="https://photos.app.goo.gl/E9pWdm38YhpEMJJe9" target="_blank" rel="noopener noreferrer">2ë™ ì „ë©´ë¶€ ì§€ë¶• ë°°ìˆ˜ë¡œ íƒ€ê³µ ê¸°ì™€ êµì²´ ë° ë³´ìˆ˜</a></b>&nbsp;: ë°°ìˆ˜ë¡œ ì²­ì†Œ X, ì‹œê°„ ë‹¨ì¶•</font><br><font size="2">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font><b style="font-size: medium;">ë¬¶ìŒ)</b> <font size="2"><a href="https://photos.app.goo.gl/4x2b168pAyLmTw1h8" target="_blank" rel="noopener noreferrer" style="">Aë™ì™¸ë²½ í›¼ì† ë„ì¥ ë³´ìˆ˜</a> â¡ï¸ <a href="https://photos.app.goo.gl/CtuPtv5VsyVZ6sn5A" target="_blank" rel="noopener noreferrer" style="">5ë™ ì§€ë¶• ì†ŒìŒ ë¬´ë™ë ¥ íœ€ ì ê²€</a> ë˜ëŠ” ë‹¨ìˆœêµì²´(ë¬´ë™ë ¥ íœ€ í™•ë³´) â¡ï¸ <a href="https://photos.app.goo.gl/GUWhWXSGfxprwHD48" target="_blank" rel="noopener noreferrer" style="">7ë™ ì§€ë¶• 5-6ë¼ì¸ í™˜ê¸°êµ¬</a> ë‚´ë¶€ ì ê²€ ë˜ëŠ” ë‹¨ìˆœ êµì²´(ë¬´ë™ë ¥ íœ€ í™•ë³´)</font><br><br><font size="3" style="font-weight: bold;">2. <a href="https://photos.app.goo.gl/zNKEwA7jun8xmhFs7" target="_blank" rel="noopener noreferrer">Aë™ ì§€í•˜ 2ì¸µ ê³„ë‹¨ì°¸ í•˜ë¶€ ì§€ë°˜ìˆ˜ ìœ ë„ ì‘ì—…</a> :&nbsp;</font><font size="2">ì»·íŒ… ë° 1ì°¨ ë°”ë‹¥ ë°©ìˆ˜<b style="">(â—‹)</b> â¡ï¸ ì˜¹ë²½íƒ€ê³µ+ìœ ë„ë°°ê´€<b style="">(â—‹)</b> â¡ï¸ ì˜ˆì •:&nbsp;2ì°¨ ë°©ìˆ˜+íŠ¸ë Œì¹˜ë®ê°œ+EPSì‹¤ë‚´ ì°¨ìˆ˜íŒ+ë‹´ìˆ˜ì‹œí—˜</font><br><br><font size="3" style=""><b>3. <a href="https://photos.app.goo.gl/EEiit4crgVkBMxqt9" target="_blank" rel="noopener noreferrer">101ë™ 304í˜¸ ì„¸ëŒ€ í˜„ê´€ë¬¸ ì²˜ì§ </a>: </b>ê¸ˆì† ì „ë¬´ ì‹œê³µì‚¬ ì ê²€ ê²°ê³¼ : ìˆ˜ë¦¬ ë¶ˆê°€ ì˜ê²¬ (1ì°¨--&gt;2ì°¨) â¡ï¸ ë™ì¼ ìƒ‰ìƒ,íŒ¨í„´ í™•ì¸ì¤‘<br></font><br><font size="3" style=""><b>4. <a href="https://photos.app.goo.gl/sHnMDR2FwYUAgTqXA" target="_blank" rel="noopener noreferrer">3ë™ ì§€í•˜ê¸°ê³„ì‹¤ ë‚œë°© ë°°ê´€ ëˆ„ìˆ˜</a> : </b>ì„ì‹œ ê´€ë¦¬ì†Œ ì¡°ì¹˜í›„ ë¶€ë¶„ êµì²´ ëŒ€ê¸°ì¤‘<br><br></font><b style="font-size: medium;">5. <a href="https://photos.app.goo.gl/79ZDT25qMUQr2qJ66" target="_blank" rel="noopener noreferrer">ì—°ê°„ ê³„íš(7ì›”~8ì›”) ì§‘ì¤‘</a> :&nbsp;</b><span style="font-size: medium;">ì´ì›” ë˜ëŠ” í˜‘ì˜í›„ ì‘ì—… ì¼ì • ìˆ˜ë¦½ í•„ìš”<br><br></span><b style="font-size: medium;">6. <a href="https://photos.app.goo.gl/awYERQSkPWeVqr7m6" target="_blank" rel="noopener noreferrer">ABë™ ì˜¤ìš°ìˆ˜ ê´€ë¡œ íì‡„ ê´€ë¦¬</a>(ë°€í) :&nbsp;</b><font size="2">ê°€ì§€ê´€ ì—°ê²° ë¶€ë¶„ ì‹¤ë¦¬ì½˜ ë³´ìˆ˜ ì†¡ê¸° ë§ˆìŠ¤í¬ ë¶€ì°© ì•ˆì „ ê°•í™”ë¡œ 5ì›”ë§ ê³„íšì—ì„œ ë³´ìˆ˜ ë³´ë¥˜ì¤‘ ( ì„ëŒ€ í™•ì¸ì¤‘ / êµ¬ì… )</font><font size="3" style=""></font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
             <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div>
             
          
      

      <div class="section">
        <div class="section-title" data-editable-type="section-title"><font color="#000000">â†’ í˜„ì¥ ì ê²€</font><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char"><font size="4"><b>â–ª</b></font></span><span class="bullet-text"><font size="4"><b>ì ê²€ êµ¬ì—­ A (ì˜ˆì‹œ)</b></font></span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="item" data-editable-type="item"><font size="3"><b>1. 3ë™ ì§€í•˜ ê¸°ê³„ì‹¤ :</b></font> ë‚œë°© ë°°ê´€ ëˆ„ìˆ˜ ë¶€ìœ„<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item" data-editable-type="item"><font size="3"><b>2. 101ë™ 403í˜¸ :</b></font> í˜„ê´€ë¬¸ ì²˜ì§ ì„¸ëŒ€<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char">â–ª</span><span class="bullet-text">ì ê²€ í•­ëª© B (ì˜ˆì‹œ)</span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="insert-area" contenteditable="true" data-editable-type="insert-area">
            ì ê²€ ë‚´ìš© ë° ê²°ê³¼ ì…ë ¥...
          <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
            
           <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div>
        <div class="box" data-editable-type="box">
          <div class="section-subtitle" data-editable-type="section-subtitle"><span class="bullet-char">â–ª</span><span class="bullet-text">ì¶”ê°€ ì¡°ì¹˜ í•„ìš” ì‚¬í•­ (ì˜ˆì‹œ)</span><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
          <div class="insert-area" contenteditable="true" data-editable-type="insert-area">
            ì¡°ì¹˜ ë‚´ìš© ê¸°ìˆ ...
          <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           <button class="add-sub-insert-area-btn" contenteditable="false">
                <span contenteditable="true" data-editable-type="button-text-label">+ í•˜ìœ„ ì…ë ¥ì°½ ì¶”ê°€<div class="item-controls"></div></span></button><div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
           
           <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div>
      
    
    <div id="annotationSettingsPanel" style="display: none;">
        <span id="closeAnnotationSettingsBtn" title="ì„¤ì • ì ìš© ë° ë‹«ê¸°">Ã—</span>
        <div>
            <button id="annoToolPen" data-tool="pen" title="íœ">íœ</button>
            <button id="annoToolHighlighter" data-tool="highlighter" title="í˜•ê´‘íœ">í˜•ê´‘íœ</button>
            <button id="annoToolCircle" data-tool="circle" title="ì›">â—‹</button>
            <button id="annoToolEllipse" data-tool="ellipse" title="íƒ€ì›">â—Œ</button>
            <button id="annoToolOrthoLine" data-tool="orthoLine" title="ì§ê°ì„ ">ğŸ“</button>
        </div>
        <div>
            <label for="annoColorPicker">ìƒ‰:</label>
            <input type="color" id="annoColorPicker" title="ìƒ‰ìƒ ì„ íƒ">
        </div>
        <div>
            <label for="annoLineWidth">êµµê¸°:</label>
            <input type="range" id="annoLineWidth" min="1" max="20" title="ì„  êµµê¸°">
        </div>
        <div id="annoHighlighterOpacityContainer" style="display: none;">
            <label for="annoHighlighterOpacity">íˆ¬ëª…ë„:</label>
            <input type="range" id="annoHighlighterOpacity" min="0.1" max="1" step="0.1" value="0.3" title="í˜•ê´‘íœ íˆ¬ëª…ë„">
        </div>
        <div>
            <button id="annoToolEraser" data-tool="eraser" title="ì§€ìš°ê°œ">ì§€ìš°ê°œ</button>
            <button id="annoClearCanvas" title="ëª¨ë‘ ì§€ìš°ê¸°">ì „ì²´ì‚­ì œ</button>
        </div>
        <div>
            <input type="checkbox" id="annoKeepDrawingsVisible" checked="">
            <label for="annoKeepDrawingsVisible" style="font-size:11px; white-space: nowrap;">ê·¸ë¦¼ ìœ ì§€(ë¹„í™œì„±ì‹œ)</label>
        </div>
    </div>
 <div id="customMessageBox" class="custom-message-box success" style="display: none;">ì‹¤í–‰ ì·¨ì†Œë¨</div>

<div class="floating-panel" id="menuPanel" style="display: none;">
  <span class="floating-panel-close-btn" id="closeMenuPanelBtn" title="ë©”ë‰´ ë‹«ê¸°">âœ•</span>
  <label>âš™ï¸ ì„¤ì •</label>
  <div id="editIconsOptionsContainer">
      <label class="checkbox-label" for="editIconsModeOff">
        <input type="radio" id="editIconsModeOff" name="editIconsMode" value="off">
        ì•„ì´ì½˜ ìˆ¨ê¹€
      </label>
      <label class="checkbox-label" for="editIconsModeAll">
        <input type="radio" id="editIconsModeAll" name="editIconsMode" value="all">
        ì „ì²´ ì•„ì´ì½˜ í‘œì‹œ
      </label>
      <label class="checkbox-label" for="editIconsModeSelected">
        <input type="radio" id="editIconsModeSelected" name="editIconsMode" value="selected">
        ì„ íƒ ì•„ì´ì½˜ë§Œ í‘œì‹œ
      </label>
  </div>
  <hr>
  <label>ğŸ”— ë§í¬ í¸ì§‘</label>
  <input type="text" id="linkURL" placeholder="ë§í¬ URL (ì„ íƒëœ í…ìŠ¤íŠ¸ì— ì ìš©)">
  <button id="applyLinkBtn">ì„ íƒ ì˜ì—­ì— ë§í¬ ì‚½ì…</button>
  <button id="removeLinkBtn" class="secondary">ì„ íƒ ì˜ì—­ ë§í¬ ì œê±°</button>

  <!-- === ê°œì„  ì‚¬í•­: ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì • ë©”ë‰´ === -->
  <div id="monthlyNavUrlSettings">
      <hr>
      <label>ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì •</label>
      <input type="text" id="monthlyNavUrlTemplate" placeholder="íšŒì˜ë¡ íŒŒì¼ ê²½ë¡œ í…œí”Œë¦¿">
      <span id="monthlyNavUrlHelpText">
          {YYYY}: 4ìë¦¬ ì—°ë„, {YY}: 2ìë¦¬ ì—°ë„<br>
          {MM}: 2ìë¦¬ ì›”, {M}: 1ìë¦¬ ì›”
      </span>
      <div id="monthlyNavUrlBtnContainer">
        <button id="applyMonthlyNavUrlBtn">URL ì ìš©</button>
        <button id="removeMonthlyNavUrlBtn" class="secondary">ë„¤ë¹„ê²Œì´ì…˜ ì œê±°</button>
      </div>
  </div>
  <!-- ======================================= -->

  <hr>
  <label>âœï¸ í…ìŠ¤íŠ¸ ì„œì‹</label>
  <div class="format-controls">
    <button id="applyBoldBtn" title="êµµê²Œ"><b>B</b></button>
    <button id="applyItalicBtn" title="ê¸°ìš¸ì„ê¼´"><i>I</i></button>
    <button id="applyUnderlineBtn" title="ë°‘ì¤„"><u>U</u></button>
    <button id="applyStrikethroughBtn" title="ì·¨ì†Œì„ " style="text-decoration: line-through;">S</button>
    <button id="applySuperscriptBtn" title="ìœ„ ì²¨ì">A<sup>+</sup></button>
    <button id="applySubscriptBtn" title="ì•„ë˜ ì²¨ì">A<sub>-</sub></button>
  </div>
  <div class="format-controls">
    <select id="fontSizeSelector" title="ê¸€ê¼´ í¬ê¸°">
      <option value="1">ì•„ì£¼ ì‘ê²Œ</option> <option value="2">ì‘ê²Œ</option> <option value="3" selected="">ë³´í†µ</option>
      <option value="4">ì¡°ê¸ˆ í¬ê²Œ</option> <option value="5">í¬ê²Œ</option> <option value="6">ì•„ì£¼ í¬ê²Œ</option> <option value="7">ìµœëŒ€ë¡œ í¬ê²Œ</option>
    </select>
    <input type="color" id="fontColorSelector" title="ê¸€ê¼´ ìƒ‰ìƒ" value="#000000">
    <input type="color" id="backColorSelector" title="í…ìŠ¤íŠ¸ ë°°ê²½ìƒ‰" value="#ffffff">
  </div>
  <hr>
  <label>ğŸ’¡ ì•„ì´ì½˜/íŠ¹ìˆ˜ë¬¸ì ì‚½ì…</label>
  <div class="char-insert-container">
    <input type="text" id="charInput" placeholder="ë¬¸ì ì…ë ¥ (ì˜ˆ: â­, âœ”, â–º)">
    <div class="emoji-dropdown">
        <button type="button" class="emoji-dropdown-btn" id="emojiDropdownBtn">â–¼</button>
        <div class="emoji-dropdown-content" id="emojiPalette">
            <button type="button" class="emoji-btn">ğŸ˜€</button> <button type="button" class="emoji-btn">ğŸ˜‚</button>
            <button type="button" class="emoji-btn">ğŸ˜Š</button> <button type="button" class="emoji-btn">ğŸ˜</button>
            <button type="button" class="emoji-btn">ğŸ¤”</button> <button type="button" class="emoji-btn">ğŸ‘</button>
            <button type="button" class="emoji-btn">ğŸ‘</button> <button type="button" class="emoji-btn">â­</button>
            <button type="button" class="emoji-btn">â¤ï¸</button> <button type="button" class="emoji-btn">âœ”</button>
            <button type="button" class="emoji-btn">âŒ</button> <button type="button" class="emoji-btn">âœ¨</button>
            <button type="button" class="emoji-btn">ğŸ‰</button> <button type="button" class="emoji-btn">ğŸ‘€</button>
            <button type="button" class="emoji-btn">ğŸ‘‰</button> <button type="button" class="emoji-btn">ğŸ’¡</button>
            <button type="button" class="emoji-btn">â“</button> <button type="button" class="emoji-btn">â—</button>
            <button type="button" class="emoji-btn">â¡ï¸</button> <button type="button" class="emoji-btn">â¬…ï¸</button>
            <button type="button" class="emoji-btn">â¬†ï¸</button> <button type="button" class="emoji-btn">â¬‡ï¸</button>
            <button type="button" class="emoji-btn">â•</button> <button type="button" class="emoji-btn">â–</button>
            <button type="button" class="emoji-btn">ğŸ“</button> <button type="button" class="emoji-btn">ğŸ“„</button>
        </div>
    </div>
  </div>
   <button id="insertCharFromInputBtn" title="ì„ íƒ ìœ„ì¹˜ì— ì‚½ì…" style="width:100%; margin-top: 5px;">ì…ë ¥ ë¬¸ì ì‚½ì…</button>
  <hr>
  <label>âœ’ï¸ ì£¼ì„ ë„êµ¬</label>
  <div>
      <input type="checkbox" id="menuAnnoKeepDrawingsVisible">
      <label for="menuAnnoKeepDrawingsVisible" class="checkbox-label">ê·¸ë¦¼ ìœ ì§€(ë¹„í™œì„±ì‹œ)</label>
  </div>
  <button id="menuAnnoDrawingToggle" style="width:100%; margin-top:5px;">ì£¼ì„ ì¼œê¸°/ë„ê¸°</button>
  <button id="menuAnnoSettingsPanelToggle" style="width:100%; margin-top:5px;">ì£¼ì„ ì„¤ì • ì—´ê¸°/ë‹«ê¸°</button>
  <button id="menuMemoAnnotationBtn" style="width:100%; margin-top:5px;">ë©”ëª¨ ì¶”ê°€ (ì „ì²´í™”ë©´)</button>
  <hr>
  <label>ğŸ“„ ë¬¸ì„œ ì €ì¥</label>
  <button id="saveHtmlBtn">ğŸ’¾ HTMLë¡œ ì €ì¥</button>
  <button id="printPdfBtn">ğŸ“„ PDFë¡œ ì¸ì‡„</button>
  <hr>
  <div id="elementStyleControls" style="display:none;">
      <h4>ì„ íƒ ìš”ì†Œ ìŠ¤íƒ€ì¼</h4>
      <div class="color-input-container">
        <label for="elementBgColor">ë°°ê²½ìƒ‰:</label>
        <input type="color" id="elementBgColor">
      </div>
      <div class="color-input-container">
        <label for="elementTextColor">ê¸€ììƒ‰:</label>
        <input type="color" id="elementTextColor">
      </div>
      <div>
        <label for="elementBorderRadius">í…Œë‘ë¦¬ êµ´ê³¡ (px):</label>
        <input type="number" id="elementBorderRadius" min="0" step="1" placeholder="ì˜ˆ: 5">
      </div>
      <div>
        <label for="elementShapeSelector">ëª¨ì–‘:</label>
        <select id="elementShapeSelector">
          <option value="default">ê¸°ë³¸ ëª¨ì–‘</option>
          <option value="rectangle">ì§ì‚¬ê°í˜•</option>
          <option value="rounded-rectangle">ë‘¥ê·¼ ì§ì‚¬ê°í˜•</option>
          <option value="oval">íƒ€ì›í˜•/ì›í˜•</option>
        </select>
      </div>
    </div>
</div>

<div id="areaSelectionRectangle" style="display: none;"></div>

<div id="selectionZoomOverlay">
    <button class="close-selection-zoom-btn" id="closeSelectionZoomBtn" title="ë‹«ê¸° (ë˜ëŠ” ë°”ê¹¥ í´ë¦­)">âœ•</button>
    <div id="selectionZoomContent"></div>
</div>

<div class="common-item-template">
  <div class="item" data-editable-type="item" contenteditable="true">ìƒˆë¡œìš´ ê¸°ë³¸ í•­ëª©...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="default-shape-item" data-editable-type="item" contenteditable="true">ìƒˆë¡œìš´ í•­ëª© ë‚´ìš©...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="insert-area templated-insert-area" contenteditable="true" data-editable-type="insert-area">### ì…ë ¥ ##...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="box" data-editable-type="box" style="margin-left: 0; background-color: #e9e9e9;">ìƒˆ ë°•ìŠ¤
      <div class="section-subtitle" data-editable-type="section-subtitle" style="margin-left:0;">ìƒˆ í•˜ìœ„ ì œëª©<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <span data-editable-type="flow-span" style="background-color: #cceeff;">ìƒˆ íë¦„ ë‹¨ê³„<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span>
</div>

<script id="mainAppScript">
  // --- ì›”ë³„ ë„¤ë¹„ê²Œì´í„° ì„¤ì • (ê°œì„ ë¨) ---
  let monthlyNavigatorConfig = {
    enabled: true, // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ì—¬ë¶€
    baseURL: 'https://jonggunelee.github.io/wyggkr/', // ê¸°ë³¸ ì›¹ì‚¬ì´íŠ¸ URL
    // íŒŒì¼ ì´ë¦„ ìƒì„± ê·œì¹™ í…œí”Œë¦¿. ì‚¬ìš©ìê°€ ë©”ë‰´ì—ì„œ ë³€ê²½ ê°€ëŠ¥.
    filenameStructureTemplate: '{YYYY}/{YYYY}_{MM}_íšŒì˜ë¡.html'
  };


  // --- Global Variables & Constants ---
  const appContainer = document.getElementById('appContainer');
  const contentArea = document.getElementById('content');
  const pageTitle = document.getElementById("page-title");
  const menuPanel = document.getElementById("menuPanel");
  const floatingMenuToggleBtn = document.getElementById("floatingMenuToggleBtn");
  const closeMenuPanelBtn = document.getElementById("closeMenuPanelBtn");
  const trueFullscreenBtn = document.getElementById('trueFullscreenBtn');
  const exitTrueFullscreenBtnActual = document.getElementById('exitTrueFullscreenBtnActual');
  const multiZoomTriggerBtn = document.getElementById('multiZoomTriggerBtn');

  const selectionZoomOverlay = document.getElementById('selectionZoomOverlay');
  const selectionZoomContent = document.getElementById('selectionZoomContent');

  // Annotation variables
  const annotationDisplayToggleBtn = document.getElementById('annotationDisplayToggleBtn');
  const annotationSettingsToggleBtn = document.getElementById('annotationSettingsToggleBtn');
  const annotationSettingsPanel = document.getElementById('annotationSettingsPanel');
  const closeAnnotationSettingsBtn = document.getElementById('closeAnnotationSettingsBtn');
  const annotationCanvas = document.getElementById('annotationCanvas');
  const annoToolPenBtn = document.getElementById('annoToolPen');
  const annoToolHighlighterBtn = document.getElementById('annoToolHighlighter');
  const annoToolCircleBtn = document.getElementById('annoToolCircle');
  const annoToolEllipseBtn = document.getElementById('annoToolEllipse');
  const annoToolOrthoLineBtn = document.getElementById('annoToolOrthoLine');
  const annoColorPicker = document.getElementById('annoColorPicker');
  const annoLineWidthSlider = document.getElementById('annoLineWidth');
  const annoToolEraserBtn = document.getElementById('annoToolEraser');
  const annoClearCanvasBtn = document.getElementById('annoClearCanvas');
  const annoHighlighterOpacityContainer = document.getElementById('annoHighlighterOpacityContainer');
  const annoHighlighterOpacitySlider = document.getElementById('annoHighlighterOpacity');
  const annoKeepDrawingsVisibleCheckbox = document.getElementById('annoKeepDrawingsVisible');

  // Menu Panel Annotation Controls
  const menuAnnoKeepDrawingsVisible = document.getElementById('menuAnnoKeepDrawingsVisible');
  const menuAnnoDrawingToggle = document.getElementById('menuAnnoDrawingToggle');
  const menuAnnoSettingsPanelToggle = document.getElementById('menuAnnoSettingsPanelToggle');
  const menuMemoAnnotationBtn = document.getElementById('menuMemoAnnotationBtn');


  // Memo annotation variables
  const memoAnnotationToggleBtn = document.getElementById('memoAnnotationToggleBtn');
  let isMemoModeActive = false;


  let annotationCtx = annotationCanvas.getContext('2d');
  let isDrawingFeatureActive = false;
  let isAnnotationPanelOpen = false;

  let isDrawingAnnotation = false;
  let lastAnnotationX, lastAnnotationY;
  let straightLineStartX, straightLineStartY;
  let shapeStartX, shapeStartY;
  let isShiftKeyDown = false;
  let previewImageData = null;

  let drawingSettings = {
    tool: 'pen',
    penColor: '#800080',
    penLineWidth: '5',
    highlighterColor: '#FFFFE0',
    highlighterLineWidth: '20',
    highlighterOpacity: '1.0',
  };
  let panelUISettings = { ...drawingSettings };
  let keepDrawingsVisibleOnDeactivate = true;
  let drawnStrokes = [];


  let isDraggingPanel = false, panelOffsetX, panelOffsetY;
  let currentlySelectedElementForStyling = null;
  let currentlyActiveItemControlsElement = null;
  let elementsForMultiZoom = [];

  // --- ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ ë³€ìˆ˜ ---
  let displayedYearInNav; // ë„¤ë¹„ê²Œì´ì…˜ì— í˜„ì¬ í‘œì‹œëœ ì—°ë„
  let documentYear, documentMonth; // ì´ ë¬¸ì„œì˜ ì›ë³¸ ì—°ë„ì™€ ì›”


  // --- Helper Functions ---
  function showMessage(message, type = 'warning', duration = 3000) {
    const messageBox = document.getElementById('customMessageBox');
    if (!messageBox) return;
    messageBox.textContent = message;
    messageBox.className = 'custom-message-box';
    if (type === 'error') messageBox.classList.add('error');
    else if (type === 'success') messageBox.classList.add('success');
    messageBox.style.display = 'block';
    setTimeout(() => { messageBox.style.display = 'none'; }, duration);
  }

  function adjustContainerPadding() {
      const titleEl = pageTitle;
      const navigatorEl = document.getElementById('monthlyNavigatorContainer');
      const contentEl = contentArea;

      if (titleEl && contentEl) {
          const titleHeight = titleEl.offsetHeight;
          const navigatorHeight = navigatorEl && getComputedStyle(navigatorEl).display !== 'none' ? navigatorEl.offsetHeight : 0;
          const totalFixedHeaderHeight = titleHeight + navigatorHeight;

          if (document.body.classList.contains('content-fullscreen-active')) {
              contentEl.style.paddingTop = '20px';
          } else if (totalFixedHeaderHeight > 0) {
              contentEl.style.paddingTop = `${totalFixedHeaderHeight + 20}px`;
          } else {
              contentEl.style.paddingTop = '20px';
          }

          if (navigatorEl && getComputedStyle(navigatorEl).display !== 'none') {
             navigatorEl.style.top = `${titleHeight}px`;
          }
      }
  }


  // --- Date and Filename Formatting ---
  function getFormattedDateForFilename() {
    const now = new Date();
    const year = now.getFullYear();
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    return {
        yearYY: year.toString().slice(-2),
        monthMM: month,
        yearYYYY: year,
        dayDD: day,
    };
  }
  
  // --- ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ (ê°œì„ ë¨) ---

  // ë„¤ë¹„ê²Œì´ì…˜ UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  function renderMonthlyNavigator() {
    const navContainer = document.getElementById('monthlyNavigatorContainer');
    if (!monthlyNavigatorConfig.enabled || !displayedYearInNav) {
        if(navContainer) navContainer.style.display = 'none';
        adjustContainerPadding();
        return;
    }

    navContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    // 1. ì—°ë„ ë„¤ë¹„ê²Œì´í„° ìƒì„±
    const yearNav = document.createElement('div');
    yearNav.id = 'yearNavigator';

    const prevYearBtn = document.createElement('button');
    prevYearBtn.id = 'prevYearBtn';
    prevYearBtn.textContent = '<';
    prevYearBtn.title = 'ì´ì „ ì—°ë„';
    prevYearBtn.onclick = () => {
        displayedYearInNav--;
        renderMonthlyNavigator();
    };

    const currentYearSpan = document.createElement('span');
    currentYearSpan.id = 'currentYearSpan';
    currentYearSpan.textContent = `${displayedYearInNav}ë…„`;

    const nextYearBtn = document.createElement('button');
    nextYearBtn.id = 'nextYearBtn';
    nextYearBtn.textContent = '>';
    nextYearBtn.title = 'ë‹¤ìŒ ì—°ë„';
    nextYearBtn.onclick = () => {
        displayedYearInNav++;
        renderMonthlyNavigator();
    };

    yearNav.appendChild(prevYearBtn);
    yearNav.appendChild(currentYearSpan);
    yearNav.appendChild(nextYearBtn);
    navContainer.appendChild(yearNav);

    // 2. ì›” ë§í¬ ì»¨í…Œì´ë„ˆ ìƒì„±
    const monthLinksContainer = document.createElement('div');
    monthLinksContainer.id = 'monthLinksContainer';

    // 3. ì›”ë³„ ë§í¬ ìƒì„±
    for (let i = 1; i <= 12; i++) {
        const monthLink = document.createElement('span');
        monthLink.className = 'month-link';
        monthLink.textContent = `${i}ì›”`;

        // 'current' í´ë˜ìŠ¤: í˜„ì¬ ë¬¸ì„œì˜ ì—°ë„ ë° ì›”ê³¼ ì¼ì¹˜í•  ë•Œ
        if (displayedYearInNav === documentYear && i === documentMonth) {
            monthLink.classList.add('current');
            monthLink.title = 'í˜„ì¬ íšŒì˜ë¡';
        } else {
            // baseURLê³¼ templateì„ í•©ì³ì„œ ìµœì¢… URL ìƒì„±
            const pathTemplate = monthlyNavigatorConfig.filenameStructureTemplate
                .replace(/{YYYY}/g, displayedYearInNav)
                .replace(/{YY}/g, String(displayedYearInNav).slice(-2))
                .replace(/{MM}/g, String(i).padStart(2, '0'))
                .replace(/{M}/g, i);
            
            let url = pathTemplate;
            // baseURLì´ ìˆê³ , pathTemplateì´ ì „ì²´ URLì´ ì•„ë‹ ê²½ìš°ì—ë§Œ baseURLì„ ì•ì— ë¶™ì„
            if (monthlyNavigatorConfig.baseURL && !pathTemplate.startsWith('http')) {
                 url = monthlyNavigatorConfig.baseURL + pathTemplate;
            }


            // 'active' vs 'disabled'ëŠ” ë¯¸ë˜ ì‹œì ì¸ì§€ ì—¬ë¶€ë¡œ íŒë‹¨ (í˜„ì¬ ì‹œê°„ ê¸°ì¤€)
            const now = new Date();
            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const linkDate = new Date(displayedYearInNav, i - 1, 1);
            
            if(linkDate < thisMonth) {
                 monthLink.classList.add('active');
                 monthLink.onclick = () => window.open(url, '_blank');
                 monthLink.title = `${i}ì›” íšŒì˜ë¡ ë³´ê¸°`;
            } else {
                 monthLink.classList.add('disabled');
                 monthLink.title = 'ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡';
            }
        }
        monthLinksContainer.appendChild(monthLink);
    }
    navContainer.appendChild(monthLinksContainer);

    navContainer.style.display = 'flex'; // ìƒì„± í›„ ë³´ì´ê²Œ ì²˜ë¦¬
    requestAnimationFrame(adjustContainerPadding);
  }

  // ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ ì´ˆê¸°í™” ë° ì„¤ì •
  function initializeMonthlyNavigator() {
    const navContainer = document.getElementById('monthlyNavigatorContainer');
    if (!navContainer) {
        console.error("ë„¤ë¹„ê²Œì´ì…˜ ì»¨í…Œì´ë„ˆ(#monthlyNavigatorContainer)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    // ë©”ë‰´ íŒ¨ë„ì˜ URL ì„¤ì • UI ì´ˆê¸°í™”
    const urlTemplateInput = document.getElementById('monthlyNavUrlTemplate');
    const applyUrlBtn = document.getElementById('applyMonthlyNavUrlBtn');
    const removeUrlBtn = document.getElementById('removeMonthlyNavUrlBtn');

    urlTemplateInput.value = monthlyNavigatorConfig.filenameStructureTemplate;

    applyUrlBtn.addEventListener('click', () => {
        const newTemplate = urlTemplateInput.value.trim();
        if (newTemplate) {
            monthlyNavigatorConfig.enabled = true;
            // ì‚¬ìš©ìê°€ ì „ì²´ URLì„ ì…ë ¥í–ˆëŠ”ì§€, ì•„ë‹ˆë©´ ê²½ë¡œë§Œ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸
            if (newTemplate.startsWith('http://') || newTemplate.startsWith('https://')) {
                // ì „ì²´ URL ì…ë ¥ ì‹œ, baseURLì„ ë¹„ìš°ê³  templateì— ì „ì²´ë¥¼ ì €ì¥
                monthlyNavigatorConfig.baseURL = '';
                monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;
                 showMessage('ì „ì²´ URL í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                // ê²½ë¡œë§Œ ì…ë ¥ ì‹œ, ê¸°ë³¸ baseURLì„ ìœ ì§€í•˜ê³  templateë§Œ ì—…ë°ì´íŠ¸
                 monthlyNavigatorConfig.baseURL = 'https://jonggunelee.github.io/wyggkr/'; // ê¸°ë³¸ê°’ ë³µì›/ì„¤ì •
                 monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;
                 showMessage('URL ê²½ë¡œ í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
            renderMonthlyNavigator();
        } else {
            showMessage('URL í…œí”Œë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        }
    });

    removeUrlBtn.addEventListener('click', () => {
        monthlyNavigatorConfig.enabled = false;
        showMessage('ì›”ë³„ ë„¤ë¹„ê²Œì´ì…˜ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        renderMonthlyNavigator();
    }
    );
    // í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„/ì›” ì •ë³´ ì¶”ì¶œ
    const titleText = pageTitle.textContent || '';
    const match = titleText.match(/(\d{2,4})ë…„\s*(\d{1,2})ì›”/);

    if (!match) {
        console.warn("í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„ì™€ ì›”ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ë„¤ë¹„ê²Œì´ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        monthlyNavigatorConfig.enabled = false;
        documentYear = null;
        documentMonth = null;
        displayedYearInNav = new Date().getFullYear();
    } else {
        let year = parseInt(match[1], 10);
        if (year < 100) {
            year += 2000; 
        }
        documentYear = year;
        documentMonth = parseInt(match[2], 10);
        displayedYearInNav = documentYear; // ì´ˆê¸° í‘œì‹œ ì—°ë„ëŠ” ë¬¸ì„œì˜ ì—°ë„ë¡œ ì„¤ì •
    }

    renderMonthlyNavigator(); // ì´ˆê¸° ë Œë”ë§
  }


  // --- Fullscreen Functionality ---
  function toggleTrueFullscreen() {
    try {
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
            let requestPromise;
            if (appContainer.requestFullscreen) {
                requestPromise = appContainer.requestFullscreen();
            } else if (appContainer.webkitRequestFullscreen) {
                requestPromise = appContainer.webkitRequestFullscreen();
            } else if (appContainer.mozRequestFullScreen) {
                requestPromise = appContainer.mozRequestFullScreen();
            } else if (appContainer.msRequestFullscreen) {
                requestPromise = appContainer.msRequestFullscreen();
            }

            if (requestPromise) {
                requestPromise.catch(err => {
                    console.error(`Fullscreen request error: ${err.message} (${err.name})`);
                    showMessage("ì „ì²´ í™”ë©´ ëª¨ë“œë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.", "error");
                });
            }
        } else {
            let exitPromise;
            if (document.exitFullscreen) {
                exitPromise = document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                exitPromise = document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                exitPromise = document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                exitPromise = document.msExitFullscreen();
            }
            
            if (exitPromise) {
                exitPromise.catch(err => {
                    console.error(`Exit fullscreen error: ${err.message} (${err.name})`);
                });
            }
        }
    } catch (e) {
        console.error("A synchronous error occurred when trying to toggle fullscreen:", e);
        showMessage("ì „ì²´ í™”ë©´ ê¸°ëŠ¥ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
    }
}

function exitTrueFullscreen() {
    try {
        let exitPromise;
        if (document.exitFullscreen) {
            exitPromise = document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            exitPromise = document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            exitPromise = document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            exitPromise = document.msExitFullscreen();
        }
        
        if (exitPromise) {
            exitPromise.catch(err => {
                console.error(`Exit fullscreen error: ${err.message} (${err.name})`);
            });
        }
    } catch (e) {
        console.error("A synchronous error occurred when trying to exit fullscreen:", e);
    }
}

  function fullscreenChangeHandler() {
    const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
    document.body.classList.toggle('true-fullscreen-active', isFs);

    if (floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = isFs ? 'none' : 'block';
    if (trueFullscreenBtn) {
        trueFullscreenBtn.style.display = isFs ? 'none' : 'block';
        trueFullscreenBtn.innerHTML = isFs ? 'ë‚˜ê°€ê¸°' : 'â›¶';
        trueFullscreenBtn.title = isFs ? "ì „ì²´ í™”ë©´ ë‚˜ê°€ê¸°" : "ì „ì²´ í™”ë©´ ë³´ê¸°";
    }
    if (multiZoomTriggerBtn) {
        multiZoomTriggerBtn.style.display = (isFs && elementsForMultiZoom.length > 0 && !document.body.classList.contains('selection-zoom-active')) ? 'block' : 'none';
    }
    if (exitTrueFullscreenBtnActual) exitTrueFullscreenBtnActual.style.display = isFs ? 'block' : 'none';


    if (isFs) {
        annotationDisplayToggleBtn.style.display = 'block';
        annotationSettingsToggleBtn.style.display = 'block';
        memoAnnotationToggleBtn.style.display = 'block';

        if (isDrawingFeatureActive) {
            annotationDisplayToggleBtn.classList.add('active');
            annotationCanvas.style.display = 'block';
            annotationCanvas.style.pointerEvents = 'auto';
            annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';
            annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);
            if (isAnnotationPanelOpen) loadPanelUIWithSettings(panelUISettings);
        } else {
            annotationDisplayToggleBtn.classList.remove('active');
            annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate ? 'block' : 'none';
            annotationCanvas.style.pointerEvents = 'none';
            annotationSettingsPanel.style.display = 'none';
            annotationSettingsToggleBtn.classList.remove('active');
            isAnnotationPanelOpen = false;
        }
    } else {
        annotationDisplayToggleBtn.style.display = 'none';
        annotationSettingsToggleBtn.style.display = 'none';
        memoAnnotationToggleBtn.style.display = 'none';
        annotationSettingsPanel.style.display = 'none';
        isAnnotationPanelOpen = false;

        if (annotationCanvas) {
            annotationCanvas.style.pointerEvents = 'none';
            annotationCanvas.style.display = (isDrawingFeatureActive && keepDrawingsVisibleOnDeactivate) ? 'block' : 'none';
        }
    }

    if (document.body.classList.contains('selection-zoom-active')) {
        if(floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = 'none';
        if(trueFullscreenBtn) trueFullscreenBtn.style.display = 'none';
        if(multiZoomTriggerBtn) multiZoomTriggerBtn.style.display = 'none';
        if(annotationDisplayToggleBtn) annotationDisplayToggleBtn.style.display = 'none';
        if(annotationSettingsToggleBtn) annotationSettingsToggleBtn.style.display = 'none';
        if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.style.display = 'none';
        if(annotationSettingsPanel) annotationSettingsPanel.style.display = 'none';
    }

    adjustContainerPadding();
    updateAnnotationDisplayToggleBtnStyle();
    setupAnnotationCanvas();
  }

  // --- Floating Panel (Menu) Functionality ---
  function togglePanel() {
    const isPanelCurrentlyOpen = menuPanel.style.display === "block";
    menuPanel.style.display = isPanelCurrentlyOpen ? "none" : "block";

    if (isPanelCurrentlyOpen) {
        floatingMenuToggleBtn.innerHTML = 'â˜°';
        floatingMenuToggleBtn.title = "ë©”ë‰´ ì—´ê¸°";
        hideElementStyleControls();
    } else {
        floatingMenuToggleBtn.innerHTML = 'âœ•';
        floatingMenuToggleBtn.title = "ë©”ë‰´ ë‹«ê¸°";
        if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;
        if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);
        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen && isDrawingFeatureActive);
        if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive && document.body.classList.contains('true-fullscreen-active'));
    }
  }

  function handleCloseMenuPanel() {
    menuPanel.style.display = "none";
    floatingMenuToggleBtn.innerHTML = 'â˜°';
    floatingMenuToggleBtn.title = "ë©”ë‰´ ì—´ê¸°";
    hideElementStyleControls();
  }
  
  function handlePanelDragStart(e) {
      if (e.target.closest('button, input, select, .floating-panel-close-btn, .checkbox-label, .emoji-dropdown-content, .emoji-btn')) return;
      isDraggingPanel = true;
      menuPanel.classList.add('dragging');
      panelOffsetX = e.clientX - menuPanel.getBoundingClientRect().left;
      panelOffsetY = e.clientY - menuPanel.getBoundingClientRect().top;
      if (!menuPanel.style.left || !menuPanel.style.top) {
        const rect = menuPanel.getBoundingClientRect();
        menuPanel.style.left = `${rect.left}px`; menuPanel.style.top = `${rect.top}px`;
        menuPanel.style.right = 'auto'; menuPanel.style.bottom = 'auto';
      }
  }

  function handlePanelDragMove(e) {
    if (!isDraggingPanel) return;
    e.preventDefault();
    let newX = e.clientX - panelOffsetX;
    let newY = e.clientY - panelOffsetY;
    const panelRect = menuPanel.getBoundingClientRect();
    newX = Math.max(0, Math.min(newX, window.innerWidth - panelRect.width));
    newY = Math.max(0, Math.min(newY, window.innerHeight - panelRect.height));
    menuPanel.style.left = `${newX}px`; menuPanel.style.top = `${newY}px`;
  }

  function handlePanelDragEnd() {
    if (isDraggingPanel) {
      isDraggingPanel = false;
      menuPanel.classList.remove('dragging');
    }
  }

  // --- Zoom Functionality (Single and Multi-Element) ---
  function triggerZoomOnElement(zoomTarget) {
    if (!zoomTarget || !appContainer.contains(zoomTarget) || selectionZoomOverlay.style.display === 'block') {
        return;
    }
    const activeEl = document.activeElement;
    if (activeEl && activeEl !== zoomTarget && appContainer.contains(activeEl) &&
        ['INPUT', 'TEXTAREA', 'SELECT'].includes(activeEl.tagName)) {
        return;
    }
    if (window.getSelection().toString().length > 0 && activeEl === zoomTarget && zoomTarget.isContentEditable) {
        return;
    }

    const clone = zoomTarget.cloneNode(true);
    clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
    clone.classList.remove('controls-active', 'multi-zoom-selected');
    Object.assign(clone.style, { transform: 'none', cursor: 'auto' });

    const originalStyle = getComputedStyle(zoomTarget);
    for (let i = 0; i < originalStyle.length; i++) {
        const propName = originalStyle[i];
        const styleBlacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'margin', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];
        if (!styleBlacklist.includes(propName)) {
            try {
                clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName));
            } catch(e) { /* Silently ignore */ }
        }
    }
    Object.assign(clone.style, {
        display: originalStyle.display, margin: '0 auto', marginBottom: '0',
        width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,
        boxSizing: 'border-box', outline: 'none', boxShadow: 'none',
        backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,
        background: originalStyle.background,
        whiteSpace: (zoomTarget.tagName === 'SPAN' && zoomTarget.parentElement && getComputedStyle(zoomTarget.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace
    });

    selectionZoomContent.innerHTML = '';
    selectionZoomContent.appendChild(clone);
    selectionZoomOverlay.style.display = 'block';
    document.body.classList.add('selection-zoom-active');
    document.body.style.overflow = 'hidden';
    fullscreenChangeHandler();
  }

  function displayMultiZoom(elementsToZoom) {
    if (!elementsToZoom || elementsToZoom.length === 0 || selectionZoomOverlay.style.display === 'block') return;
    selectionZoomContent.innerHTML = '';

    let isOriginalLayoutFlex = false;
    let originalParentFlexProperties = { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px' };

    if (elementsToZoom.length > 0 && elementsToZoom[0].parentElement) {
        const parentStyle = getComputedStyle(elementsToZoom[0].parentElement);
        if (parentStyle.display.includes('flex')) {
            isOriginalLayoutFlex = true;
            Object.assign(originalParentFlexProperties, {
                display: parentStyle.display, flexDirection: parentStyle.flexDirection, flexWrap: parentStyle.flexWrap,
                justifyContent: parentStyle.justifyContent, alignItems: parentStyle.alignItems,
                gap: parentStyle.gap === 'normal' ? '10px' : parentStyle.gap
            });
        }
    }
    Object.assign(selectionZoomContent.style, originalParentFlexProperties);

    elementsToZoom.forEach(originalEl => {
        const clone = originalEl.cloneNode(true);
        clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
        clone.classList.remove('controls-active', 'multi-zoom-selected');
        Object.assign(clone.style, { transform: 'none', cursor: 'auto' });

        const originalStyle = getComputedStyle(originalEl);
        const blacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];
        if (isOriginalLayoutFlex) blacklist.push('margin', 'margin-top', 'margin-right', 'margin-bottom', 'margin-left');

        for (let i = 0; i < originalStyle.length; i++) {
            const propName = originalStyle[i];
            if (!blacklist.includes(propName) && propName !== 'white-space') {
                try { clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName)); } catch(e) {}
            }
        }
        Object.assign(clone.style, {
            display: originalStyle.display, width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,
            boxSizing: 'border-box', outline: 'none', boxShadow: 'none',
            backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,
            background: originalStyle.background,
            whiteSpace: (originalEl.tagName === 'SPAN' && originalEl.parentElement && getComputedStyle(originalEl.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace
        });
        if (isOriginalLayoutFlex) clone.style.margin = '';
        else Object.assign(clone.style, { marginTop: '0', marginLeft: 'auto', marginRight: 'auto', marginBottom: '15px' });

        selectionZoomContent.appendChild(clone);
    });
    if (!isOriginalLayoutFlex && selectionZoomContent.lastChild) selectionZoomContent.lastChild.style.marginBottom = '0';

    selectionZoomOverlay.style.display = 'block';
    document.body.classList.add('selection-zoom-active');
    document.body.style.overflow = 'hidden';
    fullscreenChangeHandler();
  }

  function handleMultiZoomTrigger() {
    if (elementsForMultiZoom.length > 0) {
        elementsForMultiZoom.length === 1 ? triggerZoomOnElement(elementsForMultiZoom[0]) : displayMultiZoom([...elementsForMultiZoom]);
    }
  }

  function closeSelectionZoom() {
    selectionZoomOverlay.style.display = 'none';
    selectionZoomContent.innerHTML = '';
    document.body.classList.remove('selection-zoom-active');
    document.body.style.overflow = '';
    fullscreenChangeHandler();
  }
  
  function handleSelectionZoomOverlayClick(event) {
    if (event.target === selectionZoomOverlay || event.target.closest('.close-selection-zoom-btn')) closeSelectionZoom();
  }

  // --- Element Controls and Editing ---
  function activateControls(elementToActivate, focusAndSelect = false) {
      if (currentlyActiveItemControlsElement && currentlyActiveItemControlsElement !== elementToActivate) {
          currentlyActiveItemControlsElement.classList.remove('controls-active');
          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();
      }
      if (elementToActivate) {
          elementToActivate.classList.add('controls-active');
          currentlyActiveItemControlsElement = elementToActivate;
          if (focusAndSelect && elementToActivate.dataset.editableType !== 'page-title') {
              setTimeout(() => {
                  elementToActivate.focus();
                  if (typeof elementToActivate.select === 'function') {
                      elementToActivate.select();
                  } else if (elementToActivate.isContentEditable) {
                      const selection = window.getSelection(), range = document.createRange();
                      if (elementToActivate.firstChild) range.selectNodeContents(elementToActivate);
                      else { range.setStart(elementToActivate, 0); range.collapse(true); }
                      try { selection.removeAllRanges(); selection.addRange(range); } catch(e) { console.warn("Could not set selection:", e); }
                  }
              }, 0);
          }
      } else if (currentlyActiveItemControlsElement) {
          currentlyActiveItemControlsElement.classList.remove('controls-active');
          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();
          currentlyActiveItemControlsElement = null;
      }
  }

  function generateItemControls(element) {
    if (element.querySelector(':scope > .item-controls')) return;
    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'item-controls';

    // Event listeners for these buttons will be handled by event delegation
    if (element.dataset.editableType !== 'button-text-label' && element.dataset.editableType !== 'page-title') {
        const addBtn = document.createElement('button');
        addBtn.className = 'item-control-btn item-control-clone-btn';
        addBtn.innerHTML = 'â•'; addBtn.title = 'í•­ëª© ë³µì œ';
        controlsDiv.appendChild(addBtn);
    }

    const styleBtn = document.createElement('button');
    styleBtn.className = 'item-control-btn item-control-style-btn';
    styleBtn.innerHTML = 'ğŸ¨'; styleBtn.title = 'ìŠ¤íƒ€ì¼ ë³€ê²½';
    controlsDiv.appendChild(styleBtn);

    if (element.dataset.editableType !== 'page-title') {
        const delBtn = document.createElement('button');
        delBtn.className = 'item-control-btn item-control-delete-btn';
        delBtn.innerHTML = 'ğŸ—‘ï¸'; delBtn.title = 'ì‚­ì œ';
        controlsDiv.appendChild(delBtn);
    }

    if (controlsDiv.children.length > 0 && !element.querySelector(':scope > .item-controls')) {
        element.appendChild(controlsDiv);
    }
  }

  function cloneAndInsertElement(sourceElement) {
    let newItem = sourceElement.cloneNode(true);
    newItem.removeAttribute('id');
    newItem.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
    newItem.classList.remove('controls-active', 'multi-zoom-selected');

    const computedStyle = getComputedStyle(sourceElement);
    for (let i = 0; i < computedStyle.length; i++) {
        const propName = computedStyle[i];
        const styleBlacklist = ['position','top','right','left','bottom','z-index','display','visibility','opacity','transform','margin','margin-top','margin-right','margin-bottom','margin-left','outline','outline-color','outline-style','outline-width','outline-offset','box-shadow', 'transition', 'cursor'];
        if (!styleBlacklist.includes(propName)) {
            try { newItem.style.setProperty(computedStyle[i], computedStyle.getPropertyValue(computedStyle[i]), computedStyle.getPropertyPriority(computedStyle[i])); } catch (e) {}
        }
    }
    if (computedStyle.display.includes('block') || computedStyle.display.includes('flex') || computedStyle.display.includes('grid')) newItem.style.display = computedStyle.display;
    else if (sourceElement.tagName === 'SPAN' && (computedStyle.display === 'inline' || !computedStyle.display) ) newItem.style.display = 'inline-block';
    else newItem.style.display = computedStyle.display || 'block';

    if (computedStyle.width !== 'auto' && computedStyle.width !== '0px') newItem.style.width = computedStyle.width;
    if (computedStyle.height !== 'auto' && computedStyle.height !== '0px') newItem.style.height = computedStyle.height;


    sourceElement.parentNode.insertBefore(newItem, sourceElement.nextSibling);
    generateItemControls(newItem);
    newItem.querySelectorAll('[data-editable-type]').forEach(desc => generateItemControls(desc));
    activateControls(newItem, true);
    showMessage('í•­ëª©ì´ ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  }

  // --- Multi-Zoom Selection Logic ---
  function toggleMultiZoomSelection(element) {
    const index = elementsForMultiZoom.indexOf(element);
    if (index > -1) { elementsForMultiZoom.splice(index, 1); element.classList.remove('multi-zoom-selected'); }
    else { elementsForMultiZoom.push(element); element.classList.add('multi-zoom-selected'); }
    updateMultiZoomTriggerVisibility();
  }

  function updateMultiZoomTriggerVisibility() {
    if (multiZoomTriggerBtn) {
        const isSelectionZoomActive = document.body.classList.contains('selection-zoom-active');
        const shouldBeVisible = elementsForMultiZoom.length >= 1 && !isSelectionZoomActive && document.body.classList.contains('true-fullscreen-active');
        multiZoomTriggerBtn.style.display = shouldBeVisible ? 'block' : 'none';
    }
  }
  function clearMultiZoomSelectionVisuals() {
    elementsForMultiZoom.forEach(e => e.classList.remove('multi-zoom-selected'));
    updateMultiZoomTriggerVisibility();
  }

  // --- Event Handling for Element Interaction and Controls ---
  function handleAppContainerClick(event) {
    const target = event.target;

    // --- Event Delegation for Item Controls ---
    const controlButton = target.closest('.item-control-btn');
    if (controlButton) {
        event.stopPropagation();
        const element = controlButton.closest('[data-editable-type]');
        if (!element) return;

        if (controlButton.classList.contains('item-control-clone-btn')) {
            cloneAndInsertElement(element);
        } else if (controlButton.classList.contains('item-control-style-btn')) {
            activateElementStyling(element);
        } else if (controlButton.classList.contains('item-control-delete-btn')) {
            const itemText = (element.textContent.substring(0,20) || "ì´ í•­ëª©").trim();
            if (element.dataset.editableType === 'button-text-label' && element.parentElement?.classList.contains('add-sub-insert-area-btn')) {
                element.parentElement.remove();
            } else {
                element.remove();
            }
            showMessage(`'${itemText}...' í•­ëª© ì‚­ì œë¨.`, 'success');
            if (currentlySelectedElementForStyling === element) { hideElementStyleControls(); currentlySelectedElementForStyling = null; }
            if (currentlyActiveItemControlsElement === element) activateControls(null);
            const indexInMultiZoom = elementsForMultiZoom.indexOf(element);
            if (indexInMultiZoom > -1) { elementsForMultiZoom.splice(indexInMultiZoom, 1); updateMultiZoomTriggerVisibility(); }
        }
        return;
    }
    
    // --- Event Delegation for "Add Insert Area" button ---
    const addInsertAreaButton = target.closest('.add-sub-insert-area-btn');
    if (addInsertAreaButton && !target.closest('[data-editable-type="button-text-label"]')) {
        event.stopPropagation();
        const boxElement = addInsertAreaButton.closest('.box');
        if (boxElement) {
             addInsertAreaToBox(boxElement);
        }
        return;
    }

    // --- Main Click Logic for Selection ---
    const clickedItem = target.closest('[data-editable-type]');
    if (!clickedItem) {
        activateControls(null);
        if (elementsForMultiZoom.length > 0 && !target.closest('#multiZoomTriggerBtn')) {
            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];
        } return;
    }
    
    if (clickedItem.dataset.editableType === 'button-text-label' && target === clickedItem) {
        activateControls(clickedItem, true); event.stopPropagation(); return;
    }
    const interactiveChild = target.closest('a, button:not(.add-sub-insert-area-btn), input, select, textarea');
    if (interactiveChild && clickedItem.contains(interactiveChild) && interactiveChild !== clickedItem) {
        if (interactiveChild.tagName === 'A' && interactiveChild.href && !(event.ctrlKey || event.metaKey)) {
             event.preventDefault(); window.open(interactiveChild.href, '_blank', 'noopener,noreferrer');
        } return;
    }
    event.stopPropagation();

    if (event.ctrlKey || event.metaKey) {
        event.preventDefault();
        if (!(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) &&
            !(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length === 0 && elementsForMultiZoom.includes(clickedItem) && elementsForMultiZoom.length > 1) ) {
            toggleMultiZoomSelection(clickedItem);
        }
        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem) activateControls(clickedItem);
        else if (elementsForMultiZoom.length !== 1 && currentlyActiveItemControlsElement === clickedItem) activateControls(null);
        else if (elementsForMultiZoom.length > 1 && currentlyActiveItemControlsElement) activateControls(null);

    } else {
        if (elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) {
            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];
        }
        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem && clickedItem.dataset.editableType === 'page-title') {
            toggleMultiZoomSelection(clickedItem);
        }
        activateControls(clickedItem);
    }
  }

  function handleDocumentClick(event) {
    const isClickInsideAppOrGlobalControls = appContainer.contains(event.target) ||
                                       (menuPanel && menuPanel.contains(event.target)) ||
                                       (selectionZoomOverlay && selectionZoomOverlay.contains(event.target)) ||
                                       (multiZoomTriggerBtn && multiZoomTriggerBtn.contains(event.target)) ||
                                       (floatingMenuToggleBtn && floatingMenuToggleBtn.contains(event.target)) ||
                                       (trueFullscreenBtn && trueFullscreenBtn.contains(event.target)) ||
                                       (annotationSettingsPanel && annotationSettingsPanel.contains(event.target));

    if (!isClickInsideAppOrGlobalControls) {
        if (currentlyActiveItemControlsElement) activateControls(null);
        if (elementsForMultiZoom.length > 0) { clearMultiZoomSelectionVisuals(); elementsForMultiZoom = []; }
    }
  }


  function handleKeyDown(event) {
    if (event.key === 'Shift') {
        isShiftKeyDown = true;
    }
    if (event.ctrlKey || event.metaKey) {
        document.body.classList.add('ctrl-pressed');
        if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {
            event.preventDefault(); try { document.execCommand('undo', false, null); showMessage('ì‹¤í–‰ ì·¨ì†Œë¨', 'success', 1500); }
            catch (e) { showMessage('ì‹¤í–‰ ì·¨ì†Œ ì‹¤íŒ¨.', 'error'); console.error("Undo failed:", e); }
        } else if ((event.key === 'y' || event.key === 'Y') && !event.shiftKey) {
            event.preventDefault(); try { document.execCommand('redo', false, null); showMessage('ë‹¤ì‹œ ì‹¤í–‰ë¨', 'success', 1500); }
            catch (e) { showMessage('ë‹¤ì‹œ ì‹¤í–‰ ì‹¤íŒ¨.', 'error'); console.error("Redo failed:", e); }
        }
    }
  }
  function handleKeyUp(event) {
    if (event.key === 'Shift') {
        isShiftKeyDown = false;
    }
    if (!event.ctrlKey && !event.metaKey) document.body.classList.remove('ctrl-pressed');
  }

  // --- Dynamic Content Addition ---
  function addInsertAreaToBox(boxElement) {
    if (!boxElement || !boxElement.classList.contains('box')) return;
    const template = document.querySelector('.common-item-template .insert-area.templated-insert-area');
    if (!template) { console.error("Insert area template not found!"); showMessage('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }
    let newInsertArea = template.cloneNode(true);
    newInsertArea.textContent = "### ì…ë ¥ ##...";
    newInsertArea.classList.remove('templated-insert-area');
    
    // Find last button and insert before it
    const lastButton = boxElement.querySelector('.add-sub-insert-area-btn:last-of-type');
    if (lastButton) {
        boxElement.insertBefore(newInsertArea, lastButton);
    } else {
        boxElement.appendChild(newInsertArea);
    }

    generateItemControls(newInsertArea);
    activateControls(newInsertArea, true);
    showMessage('í•˜ìœ„ ì…ë ¥ì°½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  }

  // --- Element Styling Controls ---
  function activateElementStyling(element) {
    currentlySelectedElementForStyling = element;
    const styleControls = document.getElementById('elementStyleControls');
    if (!menuPanel || !styleControls) return;

    document.getElementById('elementBgColor').value = rgbToHex(getComputedStyle(element).backgroundColor);
    document.getElementById('elementTextColor').value = rgbToHex(getComputedStyle(element).color);
    const borderRadiusInput = document.getElementById('elementBorderRadius');
    const shapeSelector = document.getElementById('elementShapeSelector');
    const currentBorderRadiusStyle = getComputedStyle(element).borderRadius;

    borderRadiusInput.value = parseInt(currentBorderRadiusStyle) || 0;

    if (currentBorderRadiusStyle === '50%') shapeSelector.value = 'oval';
    else if (currentBorderRadiusStyle.split(' ').every(r => parseFloat(r) === 0 || r === '0px')) shapeSelector.value = 'rectangle';
    else if (parseFloat(currentBorderRadiusStyle) > 0) shapeSelector.value = 'rounded-rectangle';
    else shapeSelector.value = 'default';

    styleControls.style.display = 'block';
    if (menuPanel.style.display !== 'block') togglePanel();
    styleControls.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    showMessage(`'${(element.dataset.editableType || element.tagName).toLowerCase()}' ìŠ¤íƒ€ì¼ í¸ì§‘ ì¤‘`, 'success', 2000);
  }
  function hideElementStyleControls() {
      const styleControls = document.getElementById('elementStyleControls');
      if (styleControls) styleControls.style.display = 'none';
  }
  function applySelectedElementStyle(property, value) {
    if (currentlySelectedElementForStyling) {
      currentlySelectedElementForStyling.style[property] = value;
      if (currentlySelectedElementForStyling === pageTitle) requestAnimationFrame(adjustContainerPadding);
    }
  }
  function applySelectedElementShape(shapeValue) {
    if (!currentlySelectedElementForStyling) return;
    const element = currentlySelectedElementForStyling;
    const borderRadiusInput = document.getElementById('elementBorderRadius');
    let radiusToApply = borderRadiusInput ? parseInt(borderRadiusInput.value) : 5;
    if (isNaN(radiusToApply) || radiusToApply < 0) radiusToApply = 5;

    switch (shapeValue) {
        case 'rectangle': element.style.borderRadius = '0px'; if (borderRadiusInput) borderRadiusInput.value = 0; break;
        case 'rounded-rectangle':
            const currentRadius = parseInt(element.style.borderRadius);
            radiusToApply = (currentRadius === 0 || element.style.borderRadius === '50%') ? 4 : (currentRadius || 4);
            element.style.borderRadius = `${radiusToApply}px`; if (borderRadiusInput) borderRadiusInput.value = radiusToApply; break;
        case 'oval': element.style.borderRadius = '50%'; break;
        case 'default': element.style.borderRadius = '';
            if (borderRadiusInput) borderRadiusInput.value = parseInt(getComputedStyle(element).borderRadius) || 0; break;
    }
    if (element === pageTitle) requestAnimationFrame(adjustContainerPadding);
  }
  function rgbToHex(rgb) {
    if (!rgb || typeof rgb !== 'string' || rgb.indexOf('rgb') === -1) return '#000000';
    if (rgb === 'rgba(0, 0, 0, 0)' || rgb === 'transparent') return '#ffffff';
    let parts = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);
    if (!parts) return '#000000';
    delete parts[0];
    for (let i = 1; i <= 3; ++i) { parts[i] = parseInt(parts[i]).toString(16); if (parts[i].length == 1) parts[i] = '0' + parts[i]; }
    return `#${parts[1]}${parts[2]}${parts[3]}`;
  }

  // --- Text Formatting and Link/Character Insertion ---
  function applyLink() {
    const linkURLInput = document.getElementById("linkURL"); const linkURL = linkURLInput.value.trim();
    if (!linkURL) { showMessage("ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”.", "error"); return; }
    const selection = window.getSelection();
    if (!selection || selection.rangeCount === 0 || selection.isCollapsed) { showMessage("í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.", "error"); return; }

    let prefixedURL = linkURL;
    if (!linkURL.startsWith('http://')&&!linkURL.startsWith('https://')&&!linkURL.startsWith('mailto:')&&!linkURL.startsWith('#')&&!linkURL.includes('://')) {
        prefixedURL = 'http://' + linkURL;
    }
    try { if (!prefixedURL.includes(':') && !prefixedURL.startsWith('#') && !prefixedURL.startsWith('/')) new URL(prefixedURL); }
    catch (_) { showMessage("ìœ íš¨í•œ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.", "error"); return; }

    document.execCommand('createLink', false, prefixedURL);
    let createdLink = selection.anchorNode?.nodeType === Node.TEXT_NODE ? selection.anchorNode.parentElement : selection.anchorNode;
    if (createdLink && createdLink.tagName !== 'A') createdLink = createdLink.closest('a');
    if(createdLink?.tagName === 'A'){ createdLink.target = '_blank'; createdLink.rel = 'noopener noreferrer'; }

    showMessage("ë§í¬ê°€ ì‚½ì…ë˜ì—ˆìŠµë‹ˆë‹¤.", "success"); linkURLInput.value = '';
  }
  function removeLink() { document.execCommand('unlink', false, null); showMessage("ë§í¬ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");}
  function applyBold() { document.execCommand('bold', false, null); }
  function applyItalic() { document.execCommand('italic', false, null); }
  function applyUnderline() { document.execCommand('underline', false, null); }
  function applyStrikethrough() { document.execCommand('strikeThrough', false, null); }
  function applySuperscript() { document.execCommand('superscript', false, null); }
  function applySubscript() { document.execCommand('subscript', false, null); }
  function changeFontSize(size) { if (size) document.execCommand('fontSize', false, size); }
  function changeFontColor(color) { if (color) document.execCommand('foreColor', false, color); }
  function changeBackColor(color) { if (color) document.execCommand('backColor', false, color); }
  function insertCharacterFromInput() { const charToInsert=document.getElementById('charInput').value; if(!charToInsert){showMessage("ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.","warning");return;} insertCharacter(charToInsert); }
  function insertCharacter(char) { if (!char) {showMessage("ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.","warning");return;} document.execCommand('insertText', false, char); }
  function toggleEmojiPalette(event) { event.stopPropagation(); document.getElementById('emojiPalette').classList.toggle('show'); }
  
  function handleGlobalEmojiPaletteClick(event) {
    const palette = document.getElementById('emojiPalette'); const emojiDropdown = document.querySelector('.emoji-dropdown');
    if (palette && emojiDropdown && !emojiDropdown.contains(event.target) && palette.classList.contains('show')) palette.classList.remove('show');
  }

  function handleEmojiPaletteButtonClick(event) {
    const button = event.target.closest('.emoji-btn');
    if(button) {
        insertCharacter(button.textContent);
    }
  }


  // --- Save and Print Functionality ---
    /**
     * @param {string} extension - The desired file extension (e.g., 'html' or 'pdf').
     * @returns {string} The generated filename.
     */
    function getSaveFileName(extension) {
        // 1. ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ ì¶”ì¶œ ì‹œë„
        const titleText = pageTitle.textContent || '';
        const match = titleText.match(/(\d{2,4})ë…„\s*(\d{1,2})ì›”/);

        if (match) {
            let year = parseInt(match[1], 10);
            if (year < 100) year += 2000; // YY -> 20YY ë³€í™˜
            let month = parseInt(match[2], 10);

            // 2. URL í…œí”Œë¦¿ì—ì„œ íŒŒì¼ëª… ë¶€ë¶„ë§Œ ì¶”ì¶œ
            const template = monthlyNavigatorConfig.filenameStructureTemplate;
            const filenameTemplate = template.split('/').pop();

            // 3. í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ íŒŒì¼ëª… ìƒì„±
            const filename = filenameTemplate
                .replace(/{YYYY}/g, year)
                .replace(/{YY}/g, String(year).slice(-2))
                .replace(/{MM}/g, String(month).padStart(2, '0'))
                .replace(/{M}/g, month);

            // 4. ìš”ì²­ëœ í™•ì¥ìì™€ íŒŒì¼ëª…ì˜ í™•ì¥ìê°€ ë‹¤ë¥¸ ê²½ìš°, ìš”ì²­ëœ í™•ì¥ìë¡œ êµì²´
            // ì˜ˆ: í…œí”Œë¦¿ì´ 'file.txt' ì´ê³  extensionì´ 'html'ì´ë©´ 'file.html'ë¡œ ë³€ê²½
            if (filename.includes('.') && !filename.toLowerCase().endsWith(`.${extension.toLowerCase()}`)) {
                 const baseName = filename.substring(0, filename.lastIndexOf('.'));
                 return `${baseName}.${extension}`;
            }
            // í…œí”Œë¦¿ì— í™•ì¥ìê°€ ì—†ëŠ” ê²½ìš°, í™•ì¥ì ì¶”ê°€
            if (!filename.includes('.')) {
                return `${filename}.${extension}`;
            }
            
            return filename; // í…œí”Œë¦¿ì˜ í™•ì¥ìì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
        }

        // 5. í´ë°±: ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ì˜ ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±
        console.warn("ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ íŒŒì¼ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤.");
        const dateInfo = getFormattedDateForFilename();
        const defaultFilename = `${dateInfo.yearYYYY}_${dateInfo.monthMM}ì›”_íšŒì˜ì•ˆê±´.${extension}`;
        return defaultFilename;
    }


 function saveHTML() {
    if (menuPanel.style.display === "block") togglePanel();
    if (isAnnotationPanelOpen) {
        drawingSettings = { ...panelUISettings };
        applySettingsToContext(drawingSettings);
        isAnnotationPanelOpen = false;
        annotationSettingsPanel.style.display = 'none';
        annotationSettingsToggleBtn.classList.remove('active');
        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
    }
    if(document.getElementById('customMessageBox').style.display === 'block') document.getElementById('customMessageBox').style.display = 'none';
    if (selectionZoomOverlay.style.display === 'block') closeSelectionZoom();
    if(currentlyActiveItemControlsElement) activateControls(null);
    clearMultiZoomSelectionVisuals();

    const clonedAppContainer = appContainer.cloneNode(true);

    clonedAppContainer.querySelectorAll('.controls-active').forEach(el=>el.classList.remove('controls-active'));
    clonedAppContainer.querySelectorAll('.multi-zoom-selected').forEach(el=>el.classList.remove('multi-zoom-selected'));
    clonedAppContainer.querySelectorAll('.item-controls').forEach(el=>el.remove());

    const originalPageTitle = document.getElementById('page-title'), clonedPageTitle = clonedAppContainer.querySelector('#page-title');
    if(originalPageTitle && clonedPageTitle) clonedPageTitle.innerHTML = originalPageTitle.innerHTML;

    const originalContentArea = document.getElementById('content');
    const clonedContentArea = clonedAppContainer.querySelector('#content');
    if(originalContentArea && clonedContentArea) {
        const tempDivForContent = document.createElement('div');
        tempDivForContent.innerHTML = originalContentArea.innerHTML;
        const canvasInContent = tempDivForContent.querySelector('#annotationCanvas');
        if (canvasInContent) canvasInContent.innerHTML = '';
        clonedContentArea.innerHTML = tempDivForContent.innerHTML;
    }

    let clonedExternalElementsHTML = "";
    const elementsStructurallyOutsideIDs = ['customMessageBox','menuPanel','areaSelectionRectangle','selectionZoomOverlay'];
     elementsStructurallyOutsideIDs.forEach(id => {
        const originalElement = document.getElementById(id);
        if (originalElement) {
            const clonedElement = originalElement.cloneNode(true);
            clonedElement.style.display='none';
            if (id==='menuPanel' && originalElement.style.left && originalElement.style.top) {
                Object.assign(clonedElement.style, {
                    left:originalElement.style.left, top:originalElement.style.top,
                    right:'auto', bottom:'auto',
                    width: originalElement.style.width, height: originalElement.style.height
                });
            }
            clonedExternalElementsHTML += clonedElement.outerHTML + "\n";
        }
    });

    const appSaveState = {
        wasFullscreenActive: document.body.classList.contains('true-fullscreen-active'),
        isDrawingFeatureActive: isDrawingFeatureActive,
        isAnnotationPanelOpen: false,
        isMemoModeActive: isMemoModeActive,
        drawingSettings: drawingSettings,
        panelUISettings: panelUISettings,
        keepDrawingsVisibleOnDeactivate: keepDrawingsVisibleOnDeactivate,
        drawnStrokes: drawnStrokes,
        monthlyNavigatorConfig: monthlyNavigatorConfig, // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì €ì¥
        pageTitle_innerHTML: pageTitle.innerHTML,
        contentArea_innerHTML: (() => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contentArea.innerHTML;
            tempDiv.querySelector('#annotationCanvas')?.remove();
            return tempDiv.innerHTML;
        })(),
        menuPanel_style_display: 'none',
        menuPanel_style_left: menuPanel.style.left,
        menuPanel_style_top: menuPanel.style.top,
        menuPanel_style_width: menuPanel.style.width,
        menuPanel_style_height: menuPanel.style.height,
        editIconsMode: document.querySelector('input[name="editIconsMode"]:checked')?.value || 'off'
    };
    
    // ìƒíƒœë¥¼ data ì†ì„±ì— ì‚½ì…í•˜ëŠ” ëŒ€ì‹ , ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    const scriptToRestoreState = `<script>
        window.__SAVED_APP_STATE__ = ${JSON.stringify(appSaveState)};
    <\/script>`;


    const commonTemplate = document.querySelector('.common-item-template');
    let clonedCommonTemplateHTML = commonTemplate ? commonTemplate.cloneNode(true).outerHTML + "\n" : "";

    let htmlOutput = `<!DOCTYPE html>\n<html lang="ko">\n<head>\n  ${Array.from(document.querySelectorAll('head > meta')).map(m=>m.outerHTML).join('\n  ')}\n  <title>${document.title}</title>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>\n  <style>\n${Array.from(document.styleSheets).map(s=>Array.from(s.cssRules||[]).map(r=>r.cssText).join('\n')).join('\n')}\n  </style>\n  ${scriptToRestoreState}\n</head>\n<body>\n${clonedAppContainer.outerHTML}\n${clonedExternalElementsHTML}${clonedCommonTemplateHTML}`;
    const mainScriptElement = document.getElementById('mainAppScript');
    if (mainScriptElement) htmlOutput += `<script id="mainAppScript" defer>\n${mainScriptElement.innerHTML}\n<\/script>\n`;
    else showMessage("ì €ì¥ ì˜¤ë¥˜: í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸ ëˆ„ë½.", "error");
    htmlOutput += "</body>\n</html>";

    const blob = new Blob([htmlOutput],{type:"text/html;charset=utf-8"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download = getSaveFileName('html'); // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©
    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href);
    showMessage("HTML íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
  }

  function printPDF() {
    if(currentlyActiveItemControlsElement) activateControls(null);
    hideElementStyleControls();
    clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];

    const elementsToHide = [
        floatingMenuToggleBtn, trueFullscreenBtn, multiZoomTriggerBtn, menuPanel,
        selectionZoomOverlay, exitTrueFullscreenBtnActual, document.getElementById('customMessageBox'),
        annotationDisplayToggleBtn, annotationSettingsToggleBtn, annotationSettingsPanel, memoAnnotationToggleBtn,
        document.getElementById('monthlyNavigatorContainer') // ë„¤ë¹„ê²Œì´í„°ë„ ìˆ¨ê¹€
    ];
    const originalDisplays = elementsToHide.map(el => el ? el.style.display : null);
    elementsToHide.forEach(el => { if(el) el.style.display = 'none'; });
    document.querySelectorAll('.item-controls').forEach(ctrl => ctrl.style.display = 'none');


    let tempImgForPrint = null;
    if (annotationCanvas.width > 0 && annotationCanvas.height > 0 && (isDrawingFeatureActive || (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0))) {
        try {
            const dataUrl = annotationCanvas.toDataURL('image/png');
            if (dataUrl !== 'data:,') {
                tempImgForPrint = document.createElement('img');
                tempImgForPrint.src = dataUrl;
                Object.assign(tempImgForPrint.style, {
                    position: 'absolute', top: annotationCanvas.offsetTop + 'px', left: annotationCanvas.offsetLeft + 'px',
                    width: annotationCanvas.width + 'px', height: annotationCanvas.height + 'px',
                    zIndex: '4', pointerEvents: 'none', display: 'block'
                });
                contentArea.appendChild(tempImgForPrint);
            }
        } catch (e) { console.error("Error generating annotation image for PDF:", e); }
    }
    const originalCanvasDisplay = annotationCanvas.style.display;
    if(annotationCanvas) annotationCanvas.style.display = 'none';

    const originalBodyPaddingTop = document.body.style.paddingTop;
    const originalPageTitlePosition = pageTitle.style.position;
    const originalContainerPaddingTop = contentArea.style.paddingTop;


    document.body.style.paddingTop = '0px';
    contentArea.style.paddingTop = '0px'; // ì¸ì‡„ ì‹œì—ëŠ” íŒ¨ë”© ì œê±°
    if (getComputedStyle(pageTitle).position === 'fixed' || getComputedStyle(pageTitle).position === 'sticky') {
        pageTitle.style.position = 'relative';
    }
    window.scrollTo(0, 0);

    const pdfOptions = {
        margin: [5, 5, 5, 5],
        filename: getSaveFileName('pdf'), // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
            scale: 2,
            useCORS: true,
            logging: false,
            removeContainer: true,
            scrollY: 0,
            windowWidth: document.documentElement.scrollWidth,
            windowHeight: document.documentElement.scrollHeight,
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
        enableLinks: true
    };

    showMessage("PDF ìƒì„± ì¤€ë¹„ ì¤‘...", "success", 2000);

    setTimeout(() => {
        html2pdf().from(appContainer).set(pdfOptions).save()
        .then(() => {
            showMessage("PDF ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
        }).catch(err => {
            console.error("PDF ìƒì„± ì˜¤ë¥˜:", err);
            showMessage("PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }).finally(() => {
            if (tempImgForPrint && contentArea.contains(tempImgForPrint)) contentArea.removeChild(tempImgForPrint);
            if(annotationCanvas) annotationCanvas.style.display = originalCanvasDisplay;

            elementsToHide.forEach((el, i) => { if(el) el.style.display = originalDisplays[i] || ''; });
            const checkedMode = document.querySelector('input[name="editIconsMode"]:checked');
            if(checkedMode) toggleEditIconsVisibility(checkedMode.value);


            pageTitle.style.position = originalPageTitlePosition;
            // íŒ¨ë”© ì›ìƒë³µêµ¬
            adjustContainerPadding();
            fullscreenChangeHandler();
        });
    }, 300);
  }

  // body í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ì´ì½˜ í‘œì‹œ/ìˆ¨ê¹€ì„ ì „ì—­ì ìœ¼ë¡œ ì œì–´
  function toggleEditIconsVisibility(mode) {
      if(!mode) return;
      localStorage.setItem('editIconsMode', mode);
      
      document.body.classList.remove('show-icons-all', 'show-icons-selected');

      if (mode === 'all') {
          document.body.classList.add('show-icons-all');
      } else if (mode === 'selected') {
          document.body.classList.add('show-icons-selected');
      }
      // 'off' mode needs no class, as the default is to hide the controls.
  }


  // --- Annotation Functionality (Largely unchanged) ---
  function updateAnnotationDisplayToggleBtnStyle() {
    if(!annotationDisplayToggleBtn) return;
    if (isDrawingFeatureActive) {
        annotationDisplayToggleBtn.classList.add('active');
        annotationDisplayToggleBtn.title = "ì£¼ì„ ë„ê¸°";
    } else {
        annotationDisplayToggleBtn.classList.remove('active');
        annotationDisplayToggleBtn.title = "ì£¼ì„ ì¼œê¸°";
    }
  }

  function loadPanelUIWithSettings(settings) {
    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {
        if(btn) btn.classList.remove('tool-active');
    });
    const activeBtn = document.querySelector(`#annotationSettingsPanel button[data-tool="${settings.tool}"]`);
    if (activeBtn) activeBtn.classList.add('tool-active');


    if (settings.tool === 'highlighter') {
        annoColorPicker.value = settings.highlighterColor;
        annoLineWidthSlider.value = settings.highlighterLineWidth;
        annoHighlighterOpacitySlider.value = settings.highlighterOpacity;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'flex';
    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {
        annoColorPicker.value = settings.penColor;
        annoLineWidthSlider.value = settings.penLineWidth;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';
    } else {
        annoLineWidthSlider.value = settings.penLineWidth;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';
    }
  }

  function applySettingsToContext(settings) {
    if (!annotationCtx) return;
    annotationCtx.globalCompositeOperation = 'source-over';

    if (settings.tool === 'highlighter') {
        annotationCtx.strokeStyle = settings.highlighterColor;
        annotationCtx.lineWidth = settings.highlighterLineWidth;
        annotationCtx.globalAlpha = 1.0 - parseFloat(settings.highlighterOpacity);
    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {
        annotationCtx.strokeStyle = settings.penColor;
        annotationCtx.lineWidth = settings.penLineWidth;
        annotationCtx.globalAlpha = 1.0;
    } else if (settings.tool === 'eraser') {
        annotationCtx.lineWidth = settings.penLineWidth;
        annotationCtx.globalAlpha = 1.0;
    }
  }

  function setAnnotationDefaults() {
    drawingSettings = {
        tool: 'pen',
        penColor: '#800080', penLineWidth: '5',
        highlighterColor: '#FFFFE0', highlighterLineWidth: '20', highlighterOpacity: '0.3',
    };
    panelUISettings = { ...drawingSettings };
    if(annoKeepDrawingsVisibleCheckbox) keepDrawingsVisibleOnDeactivate = annoKeepDrawingsVisibleCheckbox.checked;
    if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;
    if(annoHighlighterOpacitySlider) annoHighlighterOpacitySlider.value = drawingSettings.highlighterOpacity;
  }

  function redrawAllStrokes() {
    if (!annotationCtx || !annotationCanvas) return;
    annotationCtx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);
    drawnStrokes.forEach(stroke => {
        annotationCtx.beginPath();
        annotationCtx.lineWidth = stroke.lineWidth;
        annotationCtx.strokeStyle = stroke.color;
        annotationCtx.globalAlpha = stroke.opacity;
        annotationCtx.globalCompositeOperation = 'source-over';

        if (stroke.type === 'path' || stroke.type === 'line') {
            annotationCtx.moveTo(stroke.points[0].x, stroke.points[0].y);
            for (let i = 1; i < stroke.points.length; i++) {
                annotationCtx.lineTo(stroke.points[i].x, stroke.points[i].y);
            }
            annotationCtx.stroke();
        } else if (stroke.type === 'circle') {
            annotationCtx.arc(stroke.x, stroke.y, stroke.radius, 0, Math.PI * 2);
            annotationCtx.stroke();
        } else if (stroke.type === 'ellipse') {
            annotationCtx.ellipse(stroke.x, stroke.y, stroke.radiusX, stroke.radiusY, 0, 0, Math.PI * 2);
            annotationCtx.stroke();
        }
    });
    applySettingsToContext(drawingSettings);
  }


  function setupAnnotationCanvas() {
    if (!contentArea || !annotationCanvas) return;

    const isFs = document.body.classList.contains('true-fullscreen-active');
    const newWidth = contentArea.scrollWidth;
    const newHeight = contentArea.scrollHeight;

    if (annotationCanvas.width !== newWidth || annotationCanvas.height !== newHeight) {
        annotationCanvas.width = newWidth;
        annotationCanvas.height = newHeight;
    }

    annotationCtx = annotationCanvas.getContext('2d');
    annotationCtx.lineCap = 'round';
    annotationCtx.lineJoin = 'round';

    redrawAllStrokes();

    annotationCanvas.style.top = `0px`;
    annotationCanvas.style.left = `0px`;


    if (isFs) {
        annotationCanvas.style.display = isDrawingFeatureActive ? 'block' : (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none');
        annotationCanvas.style.pointerEvents = isDrawingFeatureActive ? 'auto' : 'none';
        annotationCanvas.style.cursor = (isDrawingFeatureActive && drawingSettings.tool === 'eraser') ? 'crosshair' :
                                       (isDrawingFeatureActive) ? 'crosshair' : 'default';
    } else {
        annotationCanvas.style.display = (isDrawingFeatureActive || keepDrawingsVisibleOnDeactivate) && drawnStrokes.length > 0 ? 'block' : 'none';
        annotationCanvas.style.pointerEvents = 'none';
        annotationCanvas.style.cursor = 'default';
    }
    applySettingsToContext(drawingSettings);
  }


  function getAnnotationMousePos(event) {
    const rect = annotationCanvas.getBoundingClientRect();
    const scaleX = annotationCanvas.width / rect.width;
    const scaleY = annotationCanvas.height / rect.height;
    let clientX = event.clientX;
    let clientY = event.clientY;
    if (event.touches && event.touches.length > 0) {
        clientX = event.touches[0].clientX;
        clientY = event.touches[0].clientY;
    }
    return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
    };
  }

  let currentStroke = null;

  function startAnnotationDrawing(e) {
    if (!isDrawingFeatureActive || (e.button !== undefined && e.button !== 0) ) {
        return;
    }
    if(isDrawingFeatureActive) e.preventDefault();


    if (isMemoModeActive) return;

    const pos = getAnnotationMousePos(e);

    if (drawingSettings.tool === 'eraser') {
        eraseStrokeAtPoint(pos);
        isDrawingAnnotation = false;
        return;
    }

    applySettingsToContext(drawingSettings);
    isDrawingAnnotation = true;
    shapeStartX = pos.x;
    shapeStartY = pos.y;
    lastAnnotationX = pos.x;
    lastAnnotationY = pos.y;


    if (drawingSettings.tool === 'orthoLine' || drawingSettings.tool === 'circle' || drawingSettings.tool === 'ellipse' || (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter'))) {
        if (annotationCanvas.width > 0 && annotationCanvas.height > 0) {
            previewImageData = annotationCtx.getImageData(0, 0, annotationCanvas.width, annotationCanvas.height);
        } else { previewImageData = null;}
        currentStroke = null;
    } else if (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter') {
        annotationCtx.beginPath();
        annotationCtx.moveTo(pos.x, pos.y);
        currentStroke = {
            type: 'path',
            tool: drawingSettings.tool,
            color: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor,
            lineWidth: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth,
            opacity: drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0,
            points: [pos]
        };
    }
  }

  function drawAnnotation(e) {
    if (!isDrawingAnnotation || !isDrawingFeatureActive ) return;
    if (isMemoModeActive || drawingSettings.tool === 'eraser') return;
    if(isDrawingFeatureActive) e.preventDefault();
    const pos = getAnnotationMousePos(e);

    if (previewImageData) annotationCtx.putImageData(previewImageData, 0, 0);
    applySettingsToContext(drawingSettings);
    annotationCtx.beginPath();

    if ((isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) || drawingSettings.tool === 'orthoLine') {
        let endX = pos.x;
        let endY = pos.y;
        if (drawingSettings.tool === 'orthoLine') {
            if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }
            else { endX = shapeStartX; }
        }
        annotationCtx.moveTo(shapeStartX, shapeStartY);
        annotationCtx.lineTo(endX, endY);
    } else if (drawingSettings.tool === 'circle') {
        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));
        annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);
    } else if (drawingSettings.tool === 'ellipse') {
        const radiusX = Math.abs(pos.x - shapeStartX) / 2;
        const radiusY = Math.abs(pos.y - shapeStartY) / 2;
        const centerX = shapeStartX + (pos.x - shapeStartX) / 2;
        const centerY = shapeStartY + (pos.y - shapeStartY) / 2;
        annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);
    } else {
        if (!currentStroke) return;
        annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);
        for(let i = 1; i < currentStroke.points.length; i++) {
            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);
        }
        annotationCtx.lineTo(pos.x, pos.y);
    }
    annotationCtx.stroke();

    if (!isShiftKeyDown && drawingSettings.tool !== 'circle' && drawingSettings.tool !== 'ellipse' && drawingSettings.tool !== 'orthoLine' && currentStroke) {
        currentStroke.points.push(pos);
    }

    lastAnnotationX = pos.x;
    lastAnnotationY = pos.y;
  }

  function stopAnnotationDrawing(e) {
    if (!isDrawingAnnotation) {
        return;
    }
    if (isMemoModeActive || drawingSettings.tool === 'eraser') {
        isDrawingAnnotation = false;
        currentStroke = null;
        previewImageData = null;
        return;
    }
    if(isDrawingFeatureActive) e.preventDefault();

    const pos = getAnnotationMousePos(e);
    if (previewImageData) {
        annotationCtx.putImageData(previewImageData, 0, 0);
        previewImageData = null;
    }
    applySettingsToContext(drawingSettings);
    annotationCtx.beginPath();

    let newStroke = null;
    let endX = pos.x;
    let endY = pos.y;

    if (drawingSettings.tool === 'orthoLine') {
        if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }
        else { endX = shapeStartX; }
         annotationCtx.moveTo(shapeStartX, shapeStartY);
         annotationCtx.lineTo(endX, endY);
         newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: endX, y: endY}] };
    } else if (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) {
        annotationCtx.moveTo(shapeStartX, shapeStartY);
        annotationCtx.lineTo(pos.x, pos.y);
        newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: pos.x, y: pos.y}] };
    } else if (drawingSettings.tool === 'circle') {
        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));
        if (radius > 0.1) {
            annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);
            newStroke = { type: 'circle', tool: drawingSettings.tool, x: shapeStartX, y: shapeStartY, radius: radius };
        }
    } else if (drawingSettings.tool === 'ellipse') {
        const radiusX = Math.abs(pos.x - shapeStartX) / 2;
        const radiusY = Math.abs(pos.y - shapeStartY) / 2;
        if (radiusX > 0.1 && radiusY > 0.1) {
            const centerX = shapeStartX + (pos.x - shapeStartX) / 2;
            const centerY = shapeStartY + (pos.y - shapeStartY) / 2;
            annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);
            newStroke = { type: 'ellipse', tool: drawingSettings.tool, x: centerX, y: centerY, radiusX: radiusX, radiusY: radiusY };
        }
    } else if (currentStroke && currentStroke.points.length > 0) {
         currentStroke.points.push(pos);
         annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);
         for(let i=1; i < currentStroke.points.length; i++) {
            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);
         }
         newStroke = { ...currentStroke };
    }

    if (newStroke) {
        newStroke.color = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor;
        newStroke.lineWidth = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth;
        newStroke.opacity = drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0;
        drawnStrokes.push(newStroke);
        annotationCtx.stroke();
    }

    isDrawingAnnotation = false;
    currentStroke = null;
  }

  function distToSegmentSquared(p, v, w) {
    const l2 = (v.x - w.x)**2 + (v.y - w.y)**2;
    if (l2 === 0) return (p.x - v.x)**2 + (p.y - v.y)**2;
    let t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
    t = Math.max(0, Math.min(1, t));
    const closestX = v.x + t * (w.x - v.x);
    const closestY = v.y + t * (w.y - v.y);
    return (p.x - closestX)**2 + (p.y - closestY)**2;
  }


  function eraseStrokeAtPoint(clickPos) {
    if(drawingSettings.tool !== 'eraser') return;
    let erased = false;
    const clickTolerance = 10;

    for (let i = drawnStrokes.length - 1; i >= 0; i--) {
        const stroke = drawnStrokes[i];
        const strokeWidth = parseFloat(stroke.lineWidth || drawingSettings.penLineWidth);
        const tolerance = (strokeWidth / 2) + clickTolerance;
        let hit = false;

        if (stroke.type === 'path' || stroke.type === 'line') {
            for (let j = 0; j < stroke.points.length - 1; j++) {
                if (distToSegmentSquared(clickPos, stroke.points[j], stroke.points[j+1]) < tolerance**2) {
                    hit = true; break;
                }
            }
            if (!hit && stroke.points.length === 1) {
                 if (distToSegmentSquared(clickPos, stroke.points[0], stroke.points[0]) < tolerance**2) hit = true;
            }
        } else if (stroke.type === 'circle') {
            const dist = Math.sqrt(Math.pow(clickPos.x - stroke.x, 2) + Math.pow(clickPos.y - stroke.y, 2));
            if (Math.abs(dist - stroke.radius) < tolerance ) hit = true;
        } else if (stroke.type === 'ellipse') {
            const dx = clickPos.x - stroke.x;
            const dy = clickPos.y - stroke.y;
            const normalizedX = dx / (stroke.radiusX + tolerance);
            const normalizedY = dy / (stroke.radiusY + tolerance);
            if ((normalizedX * normalizedX) + (normalizedY * normalizedY) <= 1) {
                hit = true;
            }
        }

        if (hit) {
            drawnStrokes.splice(i, 1);
            erased = true;
            break;
        }
    }
    if (erased) {
        redrawAllStrokes();
        showMessage("ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success", 1000);
    }
  }


  // --- Annotation Feature Toggles and Panel Controls ---
  function toggleDrawingFeature() {
      if (isMemoModeActive) {
          isMemoModeActive = false;
          memoAnnotationToggleBtn.classList.remove('active');
          if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.remove('active');
          contentArea.style.cursor = 'auto';
          showMessage("ë©”ëª¨ ëª¨ë“œ ë¹„í™œì„±í™”ë¨.", "success", 1500);
      }

      isDrawingFeatureActive = !isDrawingFeatureActive;
      updateAnnotationDisplayToggleBtnStyle();
      if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);

      if (isDrawingFeatureActive) {
          annotationCanvas.style.display = 'block';
          if (document.body.classList.contains('true-fullscreen-active')) {
              annotationCanvas.style.pointerEvents = 'auto';
          } else {
              annotationCanvas.style.pointerEvents = 'none';
          }
          applySettingsToContext(drawingSettings);
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° í™œì„±í™”ë¨.", "success", 1500);
      } else {
          annotationCanvas.style.pointerEvents = 'none';
          annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
          if (isAnnotationPanelOpen) {
              isAnnotationPanelOpen = false;
              annotationSettingsPanel.style.display = 'none';
              annotationSettingsToggleBtn.classList.remove('active');
              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
          }
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° ë¹„í™œì„±í™”ë¨.", "success", 1500);
      }
      setupAnnotationCanvas();
  }

  function toggleAnnotationSettingsPanel() {
      if (!isDrawingFeatureActive && document.body.classList.contains('true-fullscreen-active')) {
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸°ë¥¼ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ğŸ‘ï¸ ì•„ì´ì½˜).", "warning");
          return;
      }
      if (!isDrawingFeatureActive && !document.body.classList.contains('true-fullscreen-active')) {
          showMessage("ì£¼ì„ ê¸°ëŠ¥ì„ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ë©”ë‰´ ì—´ê¸° > ì£¼ì„ ì¼œê¸°/ë„ê¸°).", "warning");
          return;
      }


      isAnnotationPanelOpen = !isAnnotationPanelOpen;
      annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';
      annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);
      if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen);

      if (isAnnotationPanelOpen) {
          panelUISettings = { ...drawingSettings };
          loadPanelUIWithSettings(panelUISettings);
      } else {
          drawingSettings = { ...panelUISettings };
          applySettingsToContext(drawingSettings);
      }
      setupAnnotationCanvas();
  }
  
  function handleAnnotationToolClick(e) {
    const newTool = e.target.closest('button').dataset.tool;

    if (newTool === 'eraser') {
        panelUISettings.tool = (panelUISettings.tool === 'eraser') ? 'pen' : 'eraser';
    } else {
        panelUISettings.tool = newTool;
    }

    if (panelUISettings.tool === 'highlighter') {
        panelUISettings.highlighterColor = panelUISettings.highlighterColor || drawingSettings.highlighterColor;
        panelUISettings.highlighterLineWidth = panelUISettings.highlighterLineWidth || drawingSettings.highlighterLineWidth;
        panelUISettings.highlighterOpacity = panelUISettings.highlighterOpacity || drawingSettings.highlighterOpacity;
    } else if (['pen', 'circle', 'ellipse', 'orthoLine'].includes(panelUISettings.tool)) {
         panelUISettings.penColor = panelUISettings.penColor || drawingSettings.penColor;
         panelUISettings.penLineWidth = panelUISettings.penLineWidth || drawingSettings.penLineWidth;
    }

    loadPanelUIWithSettings(panelUISettings);
    applySettingsToContext(panelUISettings);
    setupAnnotationCanvas();
  }
  
  function handleCloseAnnotationSettings() {
    drawingSettings = { ...panelUISettings };
    applySettingsToContext(drawingSettings);
    isAnnotationPanelOpen = false;
    annotationSettingsPanel.style.display = 'none';
    annotationSettingsToggleBtn.classList.remove('active');
    if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
    setupAnnotationCanvas();
    showMessage("ì£¼ì„ ì„¤ì • ì ìš©ë¨.", "success", 1500);
  }

  function handleMenuKeepDrawingsToggle(isChecked) {
    keepDrawingsVisibleOnDeactivate = isChecked;
    if(annoKeepDrawingsVisibleCheckbox) annoKeepDrawingsVisibleCheckbox.checked = keepDrawingsVisibleOnDeactivate;
    if (!isDrawingFeatureActive && annotationCanvas) {
        annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
    }
  }

  function handleClearCanvasClick() {
    if (!isDrawingFeatureActive) {
         showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.", "warning"); return;
    }
    drawnStrokes = [];
    redrawAllStrokes();
    showMessage("ëª¨ë“  ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success", 1500);
  }


  // --- Memo Annotation Functionality ---
  function handleMemoToggleClick() {
    const isFs = document.body.classList.contains('true-fullscreen-active');
    if (!isFs) {
        showMessage("ë©”ëª¨ ì¶”ê°€ëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "warning");
        return;
    }
    toggleMemoMode();
  }
  
  function handleMenuMemoToggleClick() {
    handleMemoToggleClick();
    if(menuPanel.style.display === "block") togglePanel();
  }

  function toggleMemoMode() {
      isMemoModeActive = !isMemoModeActive;
      memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);
      if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive);
      contentArea.style.cursor = isMemoModeActive ? 'copy' : 'auto';

      if (isMemoModeActive) {
          if (isDrawingFeatureActive) {
              isDrawingFeatureActive = false;
              isAnnotationPanelOpen = false;
              annotationSettingsPanel.style.display = 'none';
              annotationSettingsToggleBtn.classList.remove('active');
              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
              annotationCanvas.style.pointerEvents = 'none';
              annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
              updateAnnotationDisplayToggleBtnStyle();
              if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.remove('active');
          }
          showMessage("ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ í™œì„±í™”. ë‚´ìš©ì„ í´ë¦­í•˜ì—¬ ë©”ëª¨ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.", "success", 2500);
      } else {
          showMessage("ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™”.", "success", 1500);
      }
  }


  contentArea.addEventListener('click', function(event) {
    if (isMemoModeActive && document.body.classList.contains('true-fullscreen-active')) {
        if (event.target.closest('[data-editable-type], .text-annotation-memo, button, a, input, select, textarea, .item-controls')) {
            return;
        }
        if (event.detail === 0 && event.clientX === 0 && event.clientY === 0) {
            return;
        }

        const rect = contentArea.getBoundingClientRect();
        const x = event.clientX - rect.left + contentArea.scrollLeft;
        const y = event.clientY - rect.top + contentArea.scrollTop;

        createMemoAnnotation(x, y);
    }
  });

  function createMemoAnnotation(x, y) {
    const memoDiv = document.createElement('div');
    memoDiv.className = 'text-annotation-memo';
    memoDiv.setAttribute('contenteditable', 'true');
    memoDiv.style.left = Math.max(0, x - 10) + 'px';
    memoDiv.style.top = Math.max(0, y - 10) + 'px';
    memoDiv.textContent = 'ë©”ëª¨ ì…ë ¥...';

    const deleteBtn = document.createElement('span');
    deleteBtn.innerHTML = '&times;';
    deleteBtn.className = 'memo-delete-btn';
    deleteBtn.title = 'ë©”ëª¨ ì‚­ì œ';
    // Event listener for this will be handled by event delegation
    memoDiv.appendChild(deleteBtn);

    contentArea.appendChild(memoDiv);
    makeMemoDraggable(memoDiv);
    setTimeout(() => {
        memoDiv.focus();
        const selection = window.getSelection();
        const range = document.createRange();
        if (memoDiv.firstChild && memoDiv.firstChild.nodeType === Node.TEXT_NODE) {
            range.selectNodeContents(memoDiv.firstChild);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }, 0);
  }
  
  contentArea.addEventListener('click', function(event) {
      // Memo delete button delegation
      const deleteBtn = event.target.closest('.memo-delete-btn');
      if (deleteBtn) {
          event.stopPropagation();
          const memoDiv = deleteBtn.closest('.text-annotation-memo');
          if (memoDiv) {
              memoDiv.remove();
          }
      }
  });

  function makeMemoDraggable(memoElement) {
    let currentX, currentY, initialMouseX, initialMouseY, isDraggingMemo = false;

    memoElement.addEventListener('mousedown', (e) => {
        if (e.target.closest('.memo-delete-btn') || document.activeElement === memoElement) {
            const style = window.getComputedStyle(memoElement);
            const borderWidth = parseFloat(style.borderLeftWidth);
            const paddingLeft = parseFloat(style.paddingLeft);
            const paddingRight = parseFloat(style.paddingRight);
            const edgeThreshold = 10;

            if (e.offsetX < paddingLeft + borderWidth + edgeThreshold ||
                e.offsetX > memoElement.clientWidth - paddingRight - borderWidth - edgeThreshold ||
                e.offsetY < parseFloat(style.paddingTop) + parseFloat(style.borderTopWidth) + edgeThreshold ||
                e.offsetY > memoElement.clientHeight - parseFloat(style.paddingBottom) - parseFloat(style.borderBottomWidth) - edgeThreshold
            ) {
            } else if (memoElement.contains(document.activeElement) && document.activeElement.isContentEditable) {
                return;
            }
        }


        isDraggingMemo = true;
        memoElement.style.cursor = 'grabbing';
        currentX = memoElement.offsetLeft;
        currentY = memoElement.offsetTop;
        initialMouseX = e.clientX;
        initialMouseY = e.clientY;

        document.addEventListener('mousemove', onMemoDrag);
        document.addEventListener('mouseup', onMemoDragEnd);
        e.stopPropagation();
    });

    function onMemoDrag(e) {
        if (!isDraggingMemo) return;
        e.preventDefault();

        let deltaX = e.clientX - initialMouseX;
        let deltaY = e.clientY - initialMouseY;

        let newLeft = currentX + deltaX;
        let newTop = currentY + deltaY;

        newLeft = Math.max(0, Math.min(newLeft, contentArea.scrollWidth - memoElement.offsetWidth));
        newTop = Math.max(0, Math.min(newTop, contentArea.scrollHeight - memoElement.offsetHeight));


        memoElement.style.left = newLeft + 'px';
        memoElement.style.top = newTop + 'px';
    }

    function onMemoDragEnd() {
        if (!isDraggingMemo) return;
        isDraggingMemo = false;
        memoElement.style.cursor = 'move';
        document.removeEventListener('mousemove', onMemoDrag);
        document.removeEventListener('mouseup', onMemoDragEnd);
    }
}


  // --- Annotation Canvas Event Listeners ---
  function initializeAnnotationCanvasListeners() {
    annotationCanvas.addEventListener('mousedown', startAnnotationDrawing);
    annotationCanvas.addEventListener('mousemove', drawAnnotation);
    annotationCanvas.addEventListener('mouseup', stopAnnotationDrawing);
    annotationCanvas.addEventListener('mouseout', (e) => {
      if (isDrawingAnnotation) {
          stopAnnotationDrawing(e);
      }
    });
    annotationCanvas.addEventListener('touchstart', (e) => { if(e.touches.length===1){e.preventDefault(); startAnnotationDrawing(e.touches[0]);}}, {passive:false});
    annotationCanvas.addEventListener('touchmove', (e) => { if(e.touches.length===1){e.preventDefault(); drawAnnotation(e.touches[0]);}}, {passive:false});
    annotationCanvas.addEventListener('touchend', (e) => { if(e.changedTouches.length===1){e.preventDefault(); stopAnnotationDrawing(e.changedTouches[0]);}});
    annotationCanvas.addEventListener('touchcancel', () => {
        if (isDrawingAnnotation) {
            if (previewImageData) { annotationCtx.putImageData(previewImageData, 0, 0); previewImageData = null; }
            isDrawingAnnotation = false; currentStroke = null;
        }
    });
  }
  
  
  // --- CENTRAL EVENT LISTENER INITIALIZATION ---
  function initializeEventListeners() {
    // Global and Fullscreen
    exitTrueFullscreenBtnActual.addEventListener('click', exitTrueFullscreen);
    trueFullscreenBtn.addEventListener('click', toggleTrueFullscreen);
    
    // Main Menu Panel
    floatingMenuToggleBtn.addEventListener('click', togglePanel);
    closeMenuPanelBtn.addEventListener('click', handleCloseMenuPanel);
    
    // Zoom
    multiZoomTriggerBtn.addEventListener('click', handleMultiZoomTrigger);
    selectionZoomOverlay.addEventListener('click', handleSelectionZoomOverlayClick);
    
    // Main Content Interaction
    appContainer.addEventListener('click', handleAppContainerClick);
    document.addEventListener('click', handleDocumentClick);
    
    // Keyboard
    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);
    window.addEventListener('blur', () => {
        document.body.classList.remove('ctrl-pressed');
        isShiftKeyDown = false;
    });
    
    // --- Menu Panel Buttons ---
    // Icons Visibility
    document.querySelectorAll('input[name="editIconsMode"]').forEach(radio => {
        radio.addEventListener('change', (e) => toggleEditIconsVisibility(e.target.value));
    });
    
    // Link Editing
    document.getElementById('applyLinkBtn').addEventListener('click', applyLink);
    document.getElementById('removeLinkBtn').addEventListener('click', removeLink);
    
    // Text Formatting
    document.getElementById('applyBoldBtn').addEventListener('click', applyBold);
    document.getElementById('applyItalicBtn').addEventListener('click', applyItalic);
    document.getElementById('applyUnderlineBtn').addEventListener('click', applyUnderline);
    document.getElementById('applyStrikethroughBtn').addEventListener('click', applyStrikethrough);
    document.getElementById('applySuperscriptBtn').addEventListener('click', applySuperscript);
    document.getElementById('applySubscriptBtn').addEventListener('click', applySubscript);
    document.getElementById('fontSizeSelector').addEventListener('change', (e) => changeFontSize(e.target.value));
    document.getElementById('fontColorSelector').addEventListener('input', (e) => changeFontColor(e.target.value));
    document.getElementById('backColorSelector').addEventListener('input', (e) => changeBackColor(e.target.value));

    // Character / Emoji Insertion
    document.getElementById('emojiDropdownBtn').addEventListener('click', toggleEmojiPalette);
    document.getElementById('emojiPalette').addEventListener('click', handleEmojiPaletteButtonClick);
    document.getElementById('insertCharFromInputBtn').addEventListener('click', insertCharacterFromInput);

    // Save/Print
    document.getElementById('saveHtmlBtn').addEventListener('click', saveHTML);
    document.getElementById('printPdfBtn').addEventListener('click', printPDF);
    
    // Element Styling
    document.getElementById('elementBgColor').addEventListener('input', (e) => applySelectedElementStyle('backgroundColor', e.target.value));
    document.getElementById('elementTextColor').addEventListener('input', (e) => applySelectedElementStyle('color', e.target.value));
    document.getElementById('elementBorderRadius').addEventListener('input', (e) => applySelectedElementStyle('borderRadius', e.target.value + 'px'));
    document.getElementById('elementShapeSelector').addEventListener('change', (e) => applySelectedElementShape(e.target.value));
    
    // --- Annotation ---
    // Floating Buttons
    annotationDisplayToggleBtn.addEventListener('click', toggleDrawingFeature);
    annotationSettingsToggleBtn.addEventListener('click', toggleAnnotationSettingsPanel);
    memoAnnotationToggleBtn.addEventListener('click', handleMemoToggleClick);
    
    // Annotation Panel
    closeAnnotationSettingsBtn.addEventListener('click', handleCloseAnnotationSettings);
    annoColorPicker.addEventListener('input', (e) => {
      if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterColor = e.target.value; }
      else { panelUISettings.penColor = e.target.value; }
      applySettingsToContext(panelUISettings);
    });
    annoLineWidthSlider.addEventListener('input', (e) => {
        const newWidth = e.target.value;
        if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterLineWidth = newWidth; }
        else if (['pen', 'circle', 'ellipse', 'orthoLine', 'eraser'].includes(panelUISettings.tool)) { panelUISettings.penLineWidth = newWidth; }
        applySettingsToContext(panelUISettings);
    });
    annoHighlighterOpacitySlider.addEventListener('input', (e) => {
        panelUISettings.highlighterOpacity = e.target.value;
        applySettingsToContext(panelUISettings);
    });
    annoKeepDrawingsVisibleCheckbox.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));
    annoClearCanvasBtn.addEventListener('click', handleClearCanvasClick);
    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {
        if (btn) btn.addEventListener('click', handleAnnotationToolClick);
    });
    
    // Menu Panel Annotation Controls
    menuAnnoKeepDrawingsVisible.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));
    menuAnnoDrawingToggle.addEventListener('click', toggleDrawingFeature);
    menuAnnoSettingsPanelToggle.addEventListener('click', toggleAnnotationSettingsPanel);
    menuMemoAnnotationBtn.addEventListener('click', handleMenuMemoToggleClick);

    // Canvas Listeners
    initializeAnnotationCanvasListeners();
  }


  // --- Application Initialization on DOMContentLoaded ---
  window.addEventListener('DOMContentLoaded', () => {
    document.body.classList.add('meeting-cursor');
    window.addEventListener('beforeunload', () => {
        document.body.classList.remove('meeting-cursor');
    });

    if (pageTitle) {
        let titleText = pageTitle.innerHTML;
        // ì €ì¥ëœ ìƒíƒœê°€ ì—†ì„ ë•Œë§Œ YY, MMì„ í˜„ì¬ ë‚ ì§œë¡œ êµì²´ (ìˆ˜ì •ë¨: ì›ë³¸ íŒŒì¼ì˜ ì œëª©ì„ ìš°ì„ í•˜ë„ë¡)
        if (typeof window.__SAVED_APP_STATE__ === 'undefined' && titleText.includes('YYë…„')) {
             const dateInfo = getFormattedDateForFilename();
             titleText = titleText.replace(/YYë…„/g, `${dateInfo.yearYY}ë…„`).replace(/MMì›”/g, `${dateInfo.monthMM}ì›”`);
             pageTitle.innerHTML = titleText;
        }
        document.title = titleText.includes('(') ? titleText.substring(0, titleText.indexOf('(')).trim() : titleText;
        const editableTitleMeta = document.querySelector('meta[name="editable-title"]');
        if (editableTitleMeta) {
            editableTitleMeta.content = document.title;
        }
    }


    let parsedState = null;
    if (typeof window.__SAVED_APP_STATE__ !== 'undefined') {
        parsedState = window.__SAVED_APP_STATE__;
    }
    
    if (parsedState) {
        try {
            if (parsedState.wasFullscreenActive) {
                showMessage("ì´ ë¬¸ì„œëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. â›¶ ì•„ì´ì½˜ì„ í´ë¦­í•´ ë³µì›í•˜ì„¸ìš”.", 'success', 5000);
            }
            // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ë³µì›
            if (parsedState.monthlyNavigatorConfig) {
                monthlyNavigatorConfig = parsedState.monthlyNavigatorConfig;
            }

            isDrawingFeatureActive = parsedState.isDrawingFeatureActive || false;
            drawingSettings = parsedState.drawingSettings || drawingSettings;
            panelUISettings = parsedState.panelUISettings || { ...drawingSettings };
            keepDrawingsVisibleOnDeactivate = parsedState.keepDrawingsVisibleOnDeactivate !== undefined ? parsedState.keepDrawingsVisibleOnDeactivate : true;
            drawnStrokes = parsedState.drawnStrokes || [];
            isAnnotationPanelOpen = parsedState.isAnnotationPanelOpen || false;
            isMemoModeActive = parsedState.isMemoModeActive || false;

            if (pageTitle && parsedState.pageTitle_innerHTML) {
                if(pageTitle.innerHTML !== parsedState.pageTitle_innerHTML) {
                    pageTitle.innerHTML = parsedState.pageTitle_innerHTML;
                }
            }
            if (contentArea && parsedState.contentArea_innerHTML) {
                const canvasElement = contentArea.querySelector('#annotationCanvas');
                const currentMemos = Array.from(contentArea.querySelectorAll('.text-annotation-memo'));
                contentArea.innerHTML = parsedState.contentArea_innerHTML;

                if (canvasElement && !contentArea.querySelector('#annotationCanvas')) {
                    contentArea.insertBefore(canvasElement, contentArea.firstChild);
                }
                 currentMemos.forEach(memo => {
                    if (!contentArea.contains(memo)) contentArea.appendChild(memo);
                    makeMemoDraggable(memo);
                 });
            }

            if (menuPanel) {
                menuPanel.style.display = parsedState.menuPanel_style_display || 'none';
                if (menuPanel.style.display !== 'none') {
                    menuPanel.style.left = parsedState.menuPanel_style_left || '';
                    menuPanel.style.top = parsedState.menuPanel_style_top || '';
                    menuPanel.style.width = parsedState.menuPanel_style_width || '';
                    menuPanel.style.height = parsedState.menuPanel_style_height || '';
                    if (floatingMenuToggleBtn) {
                         floatingMenuToggleBtn.innerHTML = 'âœ•';
                         floatingMenuToggleBtn.title = 'ë©”ë‰´ ë‹«ê¸°';
                    }
                } else {
                     if (floatingMenuToggleBtn) {
                        floatingMenuToggleBtn.innerHTML = 'â˜°';
                        floatingMenuToggleBtn.title = 'ë©”ë‰´ ì—´ê¸°';
                     }
                }
            }
            // Restore edit icons mode
            const savedEditMode = parsedState.editIconsMode || 'off';
            const radioToCheck = document.querySelector(`input[name="editIconsMode"][value="${savedEditMode}"]`);
            if (radioToCheck) {
                radioToCheck.checked = true;
                toggleEditIconsVisibility(savedEditMode);
            }

        } catch (e) {
            console.error("Error applying saved app state:", e);
            setAnnotationDefaults();
        }
    } else {
        setAnnotationDefaults();
        const radioOff = document.getElementById('editIconsModeOff');
        if(radioOff) radioOff.checked = true;
        toggleEditIconsVisibility('off');
    }

    // Connect all event listeners
    initializeEventListeners();
    
    // ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´í„° ê¸°ëŠ¥ ì‹¤í–‰
    initializeMonthlyNavigator();

    elementsForMultiZoom = [];
    updateMultiZoomTriggerVisibility();
    adjustContainerPadding();

    if (pageTitle) { 
        generateItemControls(pageTitle); 
        pageTitle.addEventListener('input', () => { 
            requestAnimationFrame(adjustContainerPadding); 
            // ì œëª©ì´ ë³€ê²½ë˜ë©´ ë„¤ë¹„ê²Œì´ì…˜ë„ ë‹¤ì‹œ ì´ˆê¸°í™”
            initializeMonthlyNavigator();
        }); 
    }
    contentArea.querySelectorAll('[data-editable-type]:not(.text-annotation-memo)').forEach(el => generateItemControls(el));
    contentArea.querySelectorAll('.text-annotation-memo').forEach(makeMemoDraggable);

    updateAnnotationDisplayToggleBtnStyle();
    if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);

    if (document.fonts) {
        document.fonts.ready.then(() => {
            requestAnimationFrame(adjustContainerPadding);
            requestAnimationFrame(setupAnnotationCanvas);
        });
    } else {
        adjustContainerPadding();
        setupAnnotationCanvas();
    }
    fullscreenChangeHandler();

  });
  window.addEventListener('resize', () => {
    adjustContainerPadding();
    setupAnnotationCanvas();
  });
</script>

</div></div>
<div id="customMessageBox" class="custom-message-box success" style="display: none;">ì‹¤í–‰ ì·¨ì†Œë¨</div>
<div class="floating-panel" id="menuPanel" style="display: none;">
  <span class="floating-panel-close-btn" id="closeMenuPanelBtn" title="ë©”ë‰´ ë‹«ê¸°">âœ•</span>
  <label>âš™ï¸ ì„¤ì •</label>
  <div id="editIconsOptionsContainer">
      <label class="checkbox-label" for="editIconsModeOff">
        <input type="radio" id="editIconsModeOff" name="editIconsMode" value="off">
        ì•„ì´ì½˜ ìˆ¨ê¹€
      </label>
      <label class="checkbox-label" for="editIconsModeAll">
        <input type="radio" id="editIconsModeAll" name="editIconsMode" value="all">
        ì „ì²´ ì•„ì´ì½˜ í‘œì‹œ
      </label>
      <label class="checkbox-label" for="editIconsModeSelected">
        <input type="radio" id="editIconsModeSelected" name="editIconsMode" value="selected">
        ì„ íƒ ì•„ì´ì½˜ë§Œ í‘œì‹œ
      </label>
  </div>
  <hr>
  <label>ğŸ”— ë§í¬ í¸ì§‘</label>
  <input type="text" id="linkURL" placeholder="ë§í¬ URL (ì„ íƒëœ í…ìŠ¤íŠ¸ì— ì ìš©)">
  <button id="applyLinkBtn">ì„ íƒ ì˜ì—­ì— ë§í¬ ì‚½ì…</button>
  <button id="removeLinkBtn" class="secondary">ì„ íƒ ì˜ì—­ ë§í¬ ì œê±°</button>

  <!-- === ê°œì„  ì‚¬í•­: ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì • ë©”ë‰´ === -->
  <div id="monthlyNavUrlSettings">
      <hr>
      <label>ì›”ë³„ íšŒì˜ë¡ URL ì„¤ì •</label>
      <input type="text" id="monthlyNavUrlTemplate" placeholder="íšŒì˜ë¡ íŒŒì¼ ê²½ë¡œ í…œí”Œë¦¿">
      <span id="monthlyNavUrlHelpText">
          {YYYY}: 4ìë¦¬ ì—°ë„, {YY}: 2ìë¦¬ ì—°ë„<br>
          {MM}: 2ìë¦¬ ì›”, {M}: 1ìë¦¬ ì›”
      </span>
      <div id="monthlyNavUrlBtnContainer">
        <button id="applyMonthlyNavUrlBtn">URL ì ìš©</button>
        <button id="removeMonthlyNavUrlBtn" class="secondary">ë„¤ë¹„ê²Œì´ì…˜ ì œê±°</button>
      </div>
  </div>
  <!-- ======================================= -->

  <hr>
  <label>âœï¸ í…ìŠ¤íŠ¸ ì„œì‹</label>
  <div class="format-controls">
    <button id="applyBoldBtn" title="êµµê²Œ"><b>B</b></button>
    <button id="applyItalicBtn" title="ê¸°ìš¸ì„ê¼´"><i>I</i></button>
    <button id="applyUnderlineBtn" title="ë°‘ì¤„"><u>U</u></button>
    <button id="applyStrikethroughBtn" title="ì·¨ì†Œì„ " style="text-decoration: line-through;">S</button>
    <button id="applySuperscriptBtn" title="ìœ„ ì²¨ì">A<sup>+</sup></button>
    <button id="applySubscriptBtn" title="ì•„ë˜ ì²¨ì">A<sub>-</sub></button>
  </div>
  <div class="format-controls">
    <select id="fontSizeSelector" title="ê¸€ê¼´ í¬ê¸°">
      <option value="1">ì•„ì£¼ ì‘ê²Œ</option> <option value="2">ì‘ê²Œ</option> <option value="3" selected="">ë³´í†µ</option>
      <option value="4">ì¡°ê¸ˆ í¬ê²Œ</option> <option value="5">í¬ê²Œ</option> <option value="6">ì•„ì£¼ í¬ê²Œ</option> <option value="7">ìµœëŒ€ë¡œ í¬ê²Œ</option>
    </select>
    <input type="color" id="fontColorSelector" title="ê¸€ê¼´ ìƒ‰ìƒ" value="#000000">
    <input type="color" id="backColorSelector" title="í…ìŠ¤íŠ¸ ë°°ê²½ìƒ‰" value="#ffffff">
  </div>
  <hr>
  <label>ğŸ’¡ ì•„ì´ì½˜/íŠ¹ìˆ˜ë¬¸ì ì‚½ì…</label>
  <div class="char-insert-container">
    <input type="text" id="charInput" placeholder="ë¬¸ì ì…ë ¥ (ì˜ˆ: â­, âœ”, â–º)">
    <div class="emoji-dropdown">
        <button type="button" class="emoji-dropdown-btn" id="emojiDropdownBtn">â–¼</button>
        <div class="emoji-dropdown-content" id="emojiPalette">
            <button type="button" class="emoji-btn">ğŸ˜€</button> <button type="button" class="emoji-btn">ğŸ˜‚</button>
            <button type="button" class="emoji-btn">ğŸ˜Š</button> <button type="button" class="emoji-btn">ğŸ˜</button>
            <button type="button" class="emoji-btn">ğŸ¤”</button> <button type="button" class="emoji-btn">ğŸ‘</button>
            <button type="button" class="emoji-btn">ğŸ‘</button> <button type="button" class="emoji-btn">â­</button>
            <button type="button" class="emoji-btn">â¤ï¸</button> <button type="button" class="emoji-btn">âœ”</button>
            <button type="button" class="emoji-btn">âŒ</button> <button type="button" class="emoji-btn">âœ¨</button>
            <button type="button" class="emoji-btn">ğŸ‰</button> <button type="button" class="emoji-btn">ğŸ‘€</button>
            <button type="button" class="emoji-btn">ğŸ‘‰</button> <button type="button" class="emoji-btn">ğŸ’¡</button>
            <button type="button" class="emoji-btn">â“</button> <button type="button" class="emoji-btn">â—</button>
            <button type="button" class="emoji-btn">â¡ï¸</button> <button type="button" class="emoji-btn">â¬…ï¸</button>
            <button type="button" class="emoji-btn">â¬†ï¸</button> <button type="button" class="emoji-btn">â¬‡ï¸</button>
            <button type="button" class="emoji-btn">â•</button> <button type="button" class="emoji-btn">â–</button>
            <button type="button" class="emoji-btn">ğŸ“</button> <button type="button" class="emoji-btn">ğŸ“„</button>
        </div>
    </div>
  </div>
   <button id="insertCharFromInputBtn" title="ì„ íƒ ìœ„ì¹˜ì— ì‚½ì…" style="width:100%; margin-top: 5px;">ì…ë ¥ ë¬¸ì ì‚½ì…</button>
  <hr>
  <label>âœ’ï¸ ì£¼ì„ ë„êµ¬</label>
  <div>
      <input type="checkbox" id="menuAnnoKeepDrawingsVisible">
      <label for="menuAnnoKeepDrawingsVisible" class="checkbox-label">ê·¸ë¦¼ ìœ ì§€(ë¹„í™œì„±ì‹œ)</label>
  </div>
  <button id="menuAnnoDrawingToggle" style="width:100%; margin-top:5px;">ì£¼ì„ ì¼œê¸°/ë„ê¸°</button>
  <button id="menuAnnoSettingsPanelToggle" style="width:100%; margin-top:5px;">ì£¼ì„ ì„¤ì • ì—´ê¸°/ë‹«ê¸°</button>
  <button id="menuMemoAnnotationBtn" style="width:100%; margin-top:5px;">ë©”ëª¨ ì¶”ê°€ (ì „ì²´í™”ë©´)</button>
  <hr>
  <label>ğŸ“„ ë¬¸ì„œ ì €ì¥</label>
  <button id="saveHtmlBtn">ğŸ’¾ HTMLë¡œ ì €ì¥</button>
  <button id="printPdfBtn">ğŸ“„ PDFë¡œ ì¸ì‡„</button>
  <hr>
  <div id="elementStyleControls" style="display:none;">
      <h4>ì„ íƒ ìš”ì†Œ ìŠ¤íƒ€ì¼</h4>
      <div class="color-input-container">
        <label for="elementBgColor">ë°°ê²½ìƒ‰:</label>
        <input type="color" id="elementBgColor">
      </div>
      <div class="color-input-container">
        <label for="elementTextColor">ê¸€ììƒ‰:</label>
        <input type="color" id="elementTextColor">
      </div>
      <div>
        <label for="elementBorderRadius">í…Œë‘ë¦¬ êµ´ê³¡ (px):</label>
        <input type="number" id="elementBorderRadius" min="0" step="1" placeholder="ì˜ˆ: 5">
      </div>
      <div>
        <label for="elementShapeSelector">ëª¨ì–‘:</label>
        <select id="elementShapeSelector">
          <option value="default">ê¸°ë³¸ ëª¨ì–‘</option>
          <option value="rectangle">ì§ì‚¬ê°í˜•</option>
          <option value="rounded-rectangle">ë‘¥ê·¼ ì§ì‚¬ê°í˜•</option>
          <option value="oval">íƒ€ì›í˜•/ì›í˜•</option>
        </select>
      </div>
    </div>
</div>
<div id="areaSelectionRectangle" style="display: none;"></div>
<div id="selectionZoomOverlay" style="display: none;">
    <button class="close-selection-zoom-btn" id="closeSelectionZoomBtn" title="ë‹«ê¸° (ë˜ëŠ” ë°”ê¹¥ í´ë¦­)">âœ•</button>
    <div id="selectionZoomContent"></div>
</div>
<div class="common-item-template">
  <div class="item" data-editable-type="item" contenteditable="true">ìƒˆë¡œìš´ ê¸°ë³¸ í•­ëª©...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="default-shape-item" data-editable-type="item" contenteditable="true">ìƒˆë¡œìš´ í•­ëª© ë‚´ìš©...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="insert-area templated-insert-area" contenteditable="true" data-editable-type="insert-area">### ì…ë ¥ ##...<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="box" data-editable-type="box" style="margin-left: 0; background-color: #e9e9e9;">ìƒˆ ë°•ìŠ¤
      <div class="section-subtitle" data-editable-type="section-subtitle" style="margin-left:0;">ìƒˆ í•˜ìœ„ ì œëª©<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>
  <span data-editable-type="flow-span" style="background-color: #cceeff;">ìƒˆ íë¦„ ë‹¨ê³„<div class="item-controls"><button class="item-control-btn item-control-clone-btn" title="í•­ëª© ë³µì œ">â•</button><button class="item-control-btn item-control-style-btn" title="ìŠ¤íƒ€ì¼ ë³€ê²½">ğŸ¨</button><button class="item-control-btn item-control-delete-btn" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></span>
</div>
<script id="mainAppScript" defer>

  // --- ì›”ë³„ ë„¤ë¹„ê²Œì´í„° ì„¤ì • (ê°œì„ ë¨) ---
  let monthlyNavigatorConfig = {
    enabled: true, // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ì—¬ë¶€
    baseURL: 'https://jonggunelee.github.io/wyggkr/', // ê¸°ë³¸ ì›¹ì‚¬ì´íŠ¸ URL
    // íŒŒì¼ ì´ë¦„ ìƒì„± ê·œì¹™ í…œí”Œë¦¿. ì‚¬ìš©ìê°€ ë©”ë‰´ì—ì„œ ë³€ê²½ ê°€ëŠ¥.
    filenameStructureTemplate: '{YYYY}/{YYYY}_{MM}_íšŒì˜ë¡.html'
  };


  // --- Global Variables & Constants ---
  const appContainer = document.getElementById('appContainer');
  const contentArea = document.getElementById('content');
  const pageTitle = document.getElementById("page-title");
  const menuPanel = document.getElementById("menuPanel");
  const floatingMenuToggleBtn = document.getElementById("floatingMenuToggleBtn");
  const closeMenuPanelBtn = document.getElementById("closeMenuPanelBtn");
  const trueFullscreenBtn = document.getElementById('trueFullscreenBtn');
  const exitTrueFullscreenBtnActual = document.getElementById('exitTrueFullscreenBtnActual');
  const multiZoomTriggerBtn = document.getElementById('multiZoomTriggerBtn');

  const selectionZoomOverlay = document.getElementById('selectionZoomOverlay');
  const selectionZoomContent = document.getElementById('selectionZoomContent');

  // Annotation variables
  const annotationDisplayToggleBtn = document.getElementById('annotationDisplayToggleBtn');
  const annotationSettingsToggleBtn = document.getElementById('annotationSettingsToggleBtn');
  const annotationSettingsPanel = document.getElementById('annotationSettingsPanel');
  const closeAnnotationSettingsBtn = document.getElementById('closeAnnotationSettingsBtn');
  const annotationCanvas = document.getElementById('annotationCanvas');
  const annoToolPenBtn = document.getElementById('annoToolPen');
  const annoToolHighlighterBtn = document.getElementById('annoToolHighlighter');
  const annoToolCircleBtn = document.getElementById('annoToolCircle');
  const annoToolEllipseBtn = document.getElementById('annoToolEllipse');
  const annoToolOrthoLineBtn = document.getElementById('annoToolOrthoLine');
  const annoColorPicker = document.getElementById('annoColorPicker');
  const annoLineWidthSlider = document.getElementById('annoLineWidth');
  const annoToolEraserBtn = document.getElementById('annoToolEraser');
  const annoClearCanvasBtn = document.getElementById('annoClearCanvas');
  const annoHighlighterOpacityContainer = document.getElementById('annoHighlighterOpacityContainer');
  const annoHighlighterOpacitySlider = document.getElementById('annoHighlighterOpacity');
  const annoKeepDrawingsVisibleCheckbox = document.getElementById('annoKeepDrawingsVisible');

  // Menu Panel Annotation Controls
  const menuAnnoKeepDrawingsVisible = document.getElementById('menuAnnoKeepDrawingsVisible');
  const menuAnnoDrawingToggle = document.getElementById('menuAnnoDrawingToggle');
  const menuAnnoSettingsPanelToggle = document.getElementById('menuAnnoSettingsPanelToggle');
  const menuMemoAnnotationBtn = document.getElementById('menuMemoAnnotationBtn');


  // Memo annotation variables
  const memoAnnotationToggleBtn = document.getElementById('memoAnnotationToggleBtn');
  let isMemoModeActive = false;


  let annotationCtx = annotationCanvas.getContext('2d');
  let isDrawingFeatureActive = false;
  let isAnnotationPanelOpen = false;

  let isDrawingAnnotation = false;
  let lastAnnotationX, lastAnnotationY;
  let straightLineStartX, straightLineStartY;
  let shapeStartX, shapeStartY;
  let isShiftKeyDown = false;
  let previewImageData = null;

  let drawingSettings = {
    tool: 'pen',
    penColor: '#800080',
    penLineWidth: '5',
    highlighterColor: '#FFFFE0',
    highlighterLineWidth: '20',
    highlighterOpacity: '1.0',
  };
  let panelUISettings = { ...drawingSettings };
  let keepDrawingsVisibleOnDeactivate = true;
  let drawnStrokes = [];


  let isDraggingPanel = false, panelOffsetX, panelOffsetY;
  let currentlySelectedElementForStyling = null;
  let currentlyActiveItemControlsElement = null;
  let elementsForMultiZoom = [];

  // --- ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ ë³€ìˆ˜ ---
  let displayedYearInNav; // ë„¤ë¹„ê²Œì´ì…˜ì— í˜„ì¬ í‘œì‹œëœ ì—°ë„
  let documentYear, documentMonth; // ì´ ë¬¸ì„œì˜ ì›ë³¸ ì—°ë„ì™€ ì›”


  // --- Helper Functions ---
  function showMessage(message, type = 'warning', duration = 3000) {
    const messageBox = document.getElementById('customMessageBox');
    if (!messageBox) return;
    messageBox.textContent = message;
    messageBox.className = 'custom-message-box';
    if (type === 'error') messageBox.classList.add('error');
    else if (type === 'success') messageBox.classList.add('success');
    messageBox.style.display = 'block';
    setTimeout(() => { messageBox.style.display = 'none'; }, duration);
  }

  function adjustContainerPadding() {
      const titleEl = pageTitle;
      const navigatorEl = document.getElementById('monthlyNavigatorContainer');
      const contentEl = contentArea;

      if (titleEl && contentEl) {
          const titleHeight = titleEl.offsetHeight;
          const navigatorHeight = navigatorEl && getComputedStyle(navigatorEl).display !== 'none' ? navigatorEl.offsetHeight : 0;
          const totalFixedHeaderHeight = titleHeight + navigatorHeight;

          if (document.body.classList.contains('content-fullscreen-active')) {
              contentEl.style.paddingTop = '20px';
          } else if (totalFixedHeaderHeight > 0) {
              contentEl.style.paddingTop = `${totalFixedHeaderHeight + 20}px`;
          } else {
              contentEl.style.paddingTop = '20px';
          }

          if (navigatorEl && getComputedStyle(navigatorEl).display !== 'none') {
             navigatorEl.style.top = `${titleHeight}px`;
          }
      }
  }


  // --- Date and Filename Formatting ---
  function getFormattedDateForFilename() {
    const now = new Date();
    const year = now.getFullYear();
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    return {
        yearYY: year.toString().slice(-2),
        monthMM: month,
        yearYYYY: year,
        dayDD: day,
    };
  }
  
  // --- ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ (ê°œì„ ë¨) ---

  // ë„¤ë¹„ê²Œì´ì…˜ UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  function renderMonthlyNavigator() {
    const navContainer = document.getElementById('monthlyNavigatorContainer');
    if (!monthlyNavigatorConfig.enabled || !displayedYearInNav) {
        if(navContainer) navContainer.style.display = 'none';
        adjustContainerPadding();
        return;
    }

    navContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    // 1. ì—°ë„ ë„¤ë¹„ê²Œì´í„° ìƒì„±
    const yearNav = document.createElement('div');
    yearNav.id = 'yearNavigator';

    const prevYearBtn = document.createElement('button');
    prevYearBtn.id = 'prevYearBtn';
    prevYearBtn.textContent = '<';
    prevYearBtn.title = 'ì´ì „ ì—°ë„';
    prevYearBtn.onclick = () => {
        displayedYearInNav--;
        renderMonthlyNavigator();
    };

    const currentYearSpan = document.createElement('span');
    currentYearSpan.id = 'currentYearSpan';
    currentYearSpan.textContent = `${displayedYearInNav}ë…„`;

    const nextYearBtn = document.createElement('button');
    nextYearBtn.id = 'nextYearBtn';
    nextYearBtn.textContent = '>';
    nextYearBtn.title = 'ë‹¤ìŒ ì—°ë„';
    nextYearBtn.onclick = () => {
        displayedYearInNav++;
        renderMonthlyNavigator();
    };

    yearNav.appendChild(prevYearBtn);
    yearNav.appendChild(currentYearSpan);
    yearNav.appendChild(nextYearBtn);
    navContainer.appendChild(yearNav);

    // 2. ì›” ë§í¬ ì»¨í…Œì´ë„ˆ ìƒì„±
    const monthLinksContainer = document.createElement('div');
    monthLinksContainer.id = 'monthLinksContainer';

    // 3. ì›”ë³„ ë§í¬ ìƒì„±
    for (let i = 1; i <= 12; i++) {
        const monthLink = document.createElement('span');
        monthLink.className = 'month-link';
        monthLink.textContent = `${i}ì›”`;

        // 'current' í´ë˜ìŠ¤: í˜„ì¬ ë¬¸ì„œì˜ ì—°ë„ ë° ì›”ê³¼ ì¼ì¹˜í•  ë•Œ
        if (displayedYearInNav === documentYear && i === documentMonth) {
            monthLink.classList.add('current');
            monthLink.title = 'í˜„ì¬ íšŒì˜ë¡';
        } else {
            // baseURLê³¼ templateì„ í•©ì³ì„œ ìµœì¢… URL ìƒì„±
            const pathTemplate = monthlyNavigatorConfig.filenameStructureTemplate
                .replace(/{YYYY}/g, displayedYearInNav)
                .replace(/{YY}/g, String(displayedYearInNav).slice(-2))
                .replace(/{MM}/g, String(i).padStart(2, '0'))
                .replace(/{M}/g, i);
            
            let url = pathTemplate;
            // baseURLì´ ìˆê³ , pathTemplateì´ ì „ì²´ URLì´ ì•„ë‹ ê²½ìš°ì—ë§Œ baseURLì„ ì•ì— ë¶™ì„
            if (monthlyNavigatorConfig.baseURL && !pathTemplate.startsWith('http')) {
                 url = monthlyNavigatorConfig.baseURL + pathTemplate;
            }


            // 'active' vs 'disabled'ëŠ” ë¯¸ë˜ ì‹œì ì¸ì§€ ì—¬ë¶€ë¡œ íŒë‹¨ (í˜„ì¬ ì‹œê°„ ê¸°ì¤€)
            const now = new Date();
            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const linkDate = new Date(displayedYearInNav, i - 1, 1);
            
            if(linkDate < thisMonth) {
                 monthLink.classList.add('active');
                 monthLink.onclick = () => window.open(url, '_blank');
                 monthLink.title = `${i}ì›” íšŒì˜ë¡ ë³´ê¸°`;
            } else {
                 monthLink.classList.add('disabled');
                 monthLink.title = 'ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ íšŒì˜ë¡';
            }
        }
        monthLinksContainer.appendChild(monthLink);
    }
    navContainer.appendChild(monthLinksContainer);

    navContainer.style.display = 'flex'; // ìƒì„± í›„ ë³´ì´ê²Œ ì²˜ë¦¬
    requestAnimationFrame(adjustContainerPadding);
  }

  // ë„¤ë¹„ê²Œì´ì…˜ ê¸°ëŠ¥ ì´ˆê¸°í™” ë° ì„¤ì •
  function initializeMonthlyNavigator() {
    const navContainer = document.getElementById('monthlyNavigatorContainer');
    if (!navContainer) {
        console.error("ë„¤ë¹„ê²Œì´ì…˜ ì»¨í…Œì´ë„ˆ(#monthlyNavigatorContainer)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    // ë©”ë‰´ íŒ¨ë„ì˜ URL ì„¤ì • UI ì´ˆê¸°í™”
    const urlTemplateInput = document.getElementById('monthlyNavUrlTemplate');
    const applyUrlBtn = document.getElementById('applyMonthlyNavUrlBtn');
    const removeUrlBtn = document.getElementById('removeMonthlyNavUrlBtn');

    urlTemplateInput.value = monthlyNavigatorConfig.filenameStructureTemplate;

    applyUrlBtn.addEventListener('click', () => {
        const newTemplate = urlTemplateInput.value.trim();
        if (newTemplate) {
            monthlyNavigatorConfig.enabled = true;
            // ì‚¬ìš©ìê°€ ì „ì²´ URLì„ ì…ë ¥í–ˆëŠ”ì§€, ì•„ë‹ˆë©´ ê²½ë¡œë§Œ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸
            if (newTemplate.startsWith('http://') || newTemplate.startsWith('https://')) {
                // ì „ì²´ URL ì…ë ¥ ì‹œ, baseURLì„ ë¹„ìš°ê³  templateì— ì „ì²´ë¥¼ ì €ì¥
                monthlyNavigatorConfig.baseURL = '';
                monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;
                 showMessage('ì „ì²´ URL í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                // ê²½ë¡œë§Œ ì…ë ¥ ì‹œ, ê¸°ë³¸ baseURLì„ ìœ ì§€í•˜ê³  templateë§Œ ì—…ë°ì´íŠ¸
                 monthlyNavigatorConfig.baseURL = 'https://jonggunelee.github.io/wyggkr/'; // ê¸°ë³¸ê°’ ë³µì›/ì„¤ì •
                 monthlyNavigatorConfig.filenameStructureTemplate = newTemplate;
                 showMessage('URL ê²½ë¡œ í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
            renderMonthlyNavigator();
        } else {
            showMessage('URL í…œí”Œë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        }
    });

    removeUrlBtn.addEventListener('click', () => {
        monthlyNavigatorConfig.enabled = false;
        showMessage('ì›”ë³„ ë„¤ë¹„ê²Œì´ì…˜ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        renderMonthlyNavigator();
    }
    );
    // í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„/ì›” ì •ë³´ ì¶”ì¶œ
    const titleText = pageTitle.textContent || '';
    const match = titleText.match(/(\d{2,4})ë…„\s*(\d{1,2})ì›”/);

    if (!match) {
        console.warn("í˜ì´ì§€ ì œëª©ì—ì„œ ì—°ë„ì™€ ì›”ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ë„¤ë¹„ê²Œì´ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        monthlyNavigatorConfig.enabled = false;
        documentYear = null;
        documentMonth = null;
        displayedYearInNav = new Date().getFullYear();
    } else {
        let year = parseInt(match[1], 10);
        if (year < 100) {
            year += 2000; 
        }
        documentYear = year;
        documentMonth = parseInt(match[2], 10);
        displayedYearInNav = documentYear; // ì´ˆê¸° í‘œì‹œ ì—°ë„ëŠ” ë¬¸ì„œì˜ ì—°ë„ë¡œ ì„¤ì •
    }

    renderMonthlyNavigator(); // ì´ˆê¸° ë Œë”ë§
  }


  // --- Fullscreen Functionality ---
  function toggleTrueFullscreen() {
    try {
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
            let requestPromise;
            if (appContainer.requestFullscreen) {
                requestPromise = appContainer.requestFullscreen();
            } else if (appContainer.webkitRequestFullscreen) {
                requestPromise = appContainer.webkitRequestFullscreen();
            } else if (appContainer.mozRequestFullScreen) {
                requestPromise = appContainer.mozRequestFullScreen();
            } else if (appContainer.msRequestFullscreen) {
                requestPromise = appContainer.msRequestFullscreen();
            }

            if (requestPromise) {
                requestPromise.catch(err => {
                    console.error(`Fullscreen request error: ${err.message} (${err.name})`);
                    showMessage("ì „ì²´ í™”ë©´ ëª¨ë“œë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.", "error");
                });
            }
        } else {
            let exitPromise;
            if (document.exitFullscreen) {
                exitPromise = document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                exitPromise = document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                exitPromise = document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                exitPromise = document.msExitFullscreen();
            }
            
            if (exitPromise) {
                exitPromise.catch(err => {
                    console.error(`Exit fullscreen error: ${err.message} (${err.name})`);
                });
            }
        }
    } catch (e) {
        console.error("A synchronous error occurred when trying to toggle fullscreen:", e);
        showMessage("ì „ì²´ í™”ë©´ ê¸°ëŠ¥ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
    }
}

function exitTrueFullscreen() {
    try {
        let exitPromise;
        if (document.exitFullscreen) {
            exitPromise = document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            exitPromise = document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            exitPromise = document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            exitPromise = document.msExitFullscreen();
        }
        
        if (exitPromise) {
            exitPromise.catch(err => {
                console.error(`Exit fullscreen error: ${err.message} (${err.name})`);
            });
        }
    } catch (e) {
        console.error("A synchronous error occurred when trying to exit fullscreen:", e);
    }
}

  function fullscreenChangeHandler() {
    const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
    document.body.classList.toggle('true-fullscreen-active', isFs);

    if (floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = isFs ? 'none' : 'block';
    if (trueFullscreenBtn) {
        trueFullscreenBtn.style.display = isFs ? 'none' : 'block';
        trueFullscreenBtn.innerHTML = isFs ? 'ë‚˜ê°€ê¸°' : 'â›¶';
        trueFullscreenBtn.title = isFs ? "ì „ì²´ í™”ë©´ ë‚˜ê°€ê¸°" : "ì „ì²´ í™”ë©´ ë³´ê¸°";
    }
    if (multiZoomTriggerBtn) {
        multiZoomTriggerBtn.style.display = (isFs && elementsForMultiZoom.length > 0 && !document.body.classList.contains('selection-zoom-active')) ? 'block' : 'none';
    }
    if (exitTrueFullscreenBtnActual) exitTrueFullscreenBtnActual.style.display = isFs ? 'block' : 'none';


    if (isFs) {
        annotationDisplayToggleBtn.style.display = 'block';
        annotationSettingsToggleBtn.style.display = 'block';
        memoAnnotationToggleBtn.style.display = 'block';

        if (isDrawingFeatureActive) {
            annotationDisplayToggleBtn.classList.add('active');
            annotationCanvas.style.display = 'block';
            annotationCanvas.style.pointerEvents = 'auto';
            annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';
            annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);
            if (isAnnotationPanelOpen) loadPanelUIWithSettings(panelUISettings);
        } else {
            annotationDisplayToggleBtn.classList.remove('active');
            annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate ? 'block' : 'none';
            annotationCanvas.style.pointerEvents = 'none';
            annotationSettingsPanel.style.display = 'none';
            annotationSettingsToggleBtn.classList.remove('active');
            isAnnotationPanelOpen = false;
        }
    } else {
        annotationDisplayToggleBtn.style.display = 'none';
        annotationSettingsToggleBtn.style.display = 'none';
        memoAnnotationToggleBtn.style.display = 'none';
        annotationSettingsPanel.style.display = 'none';
        isAnnotationPanelOpen = false;

        if (annotationCanvas) {
            annotationCanvas.style.pointerEvents = 'none';
            annotationCanvas.style.display = (isDrawingFeatureActive && keepDrawingsVisibleOnDeactivate) ? 'block' : 'none';
        }
    }

    if (document.body.classList.contains('selection-zoom-active')) {
        if(floatingMenuToggleBtn) floatingMenuToggleBtn.style.display = 'none';
        if(trueFullscreenBtn) trueFullscreenBtn.style.display = 'none';
        if(multiZoomTriggerBtn) multiZoomTriggerBtn.style.display = 'none';
        if(annotationDisplayToggleBtn) annotationDisplayToggleBtn.style.display = 'none';
        if(annotationSettingsToggleBtn) annotationSettingsToggleBtn.style.display = 'none';
        if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.style.display = 'none';
        if(annotationSettingsPanel) annotationSettingsPanel.style.display = 'none';
    }

    adjustContainerPadding();
    updateAnnotationDisplayToggleBtnStyle();
    setupAnnotationCanvas();
  }

  // --- Floating Panel (Menu) Functionality ---
  function togglePanel() {
    const isPanelCurrentlyOpen = menuPanel.style.display === "block";
    menuPanel.style.display = isPanelCurrentlyOpen ? "none" : "block";

    if (isPanelCurrentlyOpen) {
        floatingMenuToggleBtn.innerHTML = 'â˜°';
        floatingMenuToggleBtn.title = "ë©”ë‰´ ì—´ê¸°";
        hideElementStyleControls();
    } else {
        floatingMenuToggleBtn.innerHTML = 'âœ•';
        floatingMenuToggleBtn.title = "ë©”ë‰´ ë‹«ê¸°";
        if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;
        if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);
        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen && isDrawingFeatureActive);
        if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive && document.body.classList.contains('true-fullscreen-active'));
    }
  }

  function handleCloseMenuPanel() {
    menuPanel.style.display = "none";
    floatingMenuToggleBtn.innerHTML = 'â˜°';
    floatingMenuToggleBtn.title = "ë©”ë‰´ ì—´ê¸°";
    hideElementStyleControls();
  }
  
  function handlePanelDragStart(e) {
      if (e.target.closest('button, input, select, .floating-panel-close-btn, .checkbox-label, .emoji-dropdown-content, .emoji-btn')) return;
      isDraggingPanel = true;
      menuPanel.classList.add('dragging');
      panelOffsetX = e.clientX - menuPanel.getBoundingClientRect().left;
      panelOffsetY = e.clientY - menuPanel.getBoundingClientRect().top;
      if (!menuPanel.style.left || !menuPanel.style.top) {
        const rect = menuPanel.getBoundingClientRect();
        menuPanel.style.left = `${rect.left}px`; menuPanel.style.top = `${rect.top}px`;
        menuPanel.style.right = 'auto'; menuPanel.style.bottom = 'auto';
      }
  }

  function handlePanelDragMove(e) {
    if (!isDraggingPanel) return;
    e.preventDefault();
    let newX = e.clientX - panelOffsetX;
    let newY = e.clientY - panelOffsetY;
    const panelRect = menuPanel.getBoundingClientRect();
    newX = Math.max(0, Math.min(newX, window.innerWidth - panelRect.width));
    newY = Math.max(0, Math.min(newY, window.innerHeight - panelRect.height));
    menuPanel.style.left = `${newX}px`; menuPanel.style.top = `${newY}px`;
  }

  function handlePanelDragEnd() {
    if (isDraggingPanel) {
      isDraggingPanel = false;
      menuPanel.classList.remove('dragging');
    }
  }

  // --- Zoom Functionality (Single and Multi-Element) ---
  function triggerZoomOnElement(zoomTarget) {
    if (!zoomTarget || !appContainer.contains(zoomTarget) || selectionZoomOverlay.style.display === 'block') {
        return;
    }
    const activeEl = document.activeElement;
    if (activeEl && activeEl !== zoomTarget && appContainer.contains(activeEl) &&
        ['INPUT', 'TEXTAREA', 'SELECT'].includes(activeEl.tagName)) {
        return;
    }
    if (window.getSelection().toString().length > 0 && activeEl === zoomTarget && zoomTarget.isContentEditable) {
        return;
    }

    const clone = zoomTarget.cloneNode(true);
    clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
    clone.classList.remove('controls-active', 'multi-zoom-selected');
    Object.assign(clone.style, { transform: 'none', cursor: 'auto' });

    const originalStyle = getComputedStyle(zoomTarget);
    for (let i = 0; i < originalStyle.length; i++) {
        const propName = originalStyle[i];
        const styleBlacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'margin', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];
        if (!styleBlacklist.includes(propName)) {
            try {
                clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName));
            } catch(e) { /* Silently ignore */ }
        }
    }
    Object.assign(clone.style, {
        display: originalStyle.display, margin: '0 auto', marginBottom: '0',
        width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,
        boxSizing: 'border-box', outline: 'none', boxShadow: 'none',
        backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,
        background: originalStyle.background,
        whiteSpace: (zoomTarget.tagName === 'SPAN' && zoomTarget.parentElement && getComputedStyle(zoomTarget.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace
    });

    selectionZoomContent.innerHTML = '';
    selectionZoomContent.appendChild(clone);
    selectionZoomOverlay.style.display = 'block';
    document.body.classList.add('selection-zoom-active');
    document.body.style.overflow = 'hidden';
    fullscreenChangeHandler();
  }

  function displayMultiZoom(elementsToZoom) {
    if (!elementsToZoom || elementsToZoom.length === 0 || selectionZoomOverlay.style.display === 'block') return;
    selectionZoomContent.innerHTML = '';

    let isOriginalLayoutFlex = false;
    let originalParentFlexProperties = { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px' };

    if (elementsToZoom.length > 0 && elementsToZoom[0].parentElement) {
        const parentStyle = getComputedStyle(elementsToZoom[0].parentElement);
        if (parentStyle.display.includes('flex')) {
            isOriginalLayoutFlex = true;
            Object.assign(originalParentFlexProperties, {
                display: parentStyle.display, flexDirection: parentStyle.flexDirection, flexWrap: parentStyle.flexWrap,
                justifyContent: parentStyle.justifyContent, alignItems: parentStyle.alignItems,
                gap: parentStyle.gap === 'normal' ? '10px' : parentStyle.gap
            });
        }
    }
    Object.assign(selectionZoomContent.style, originalParentFlexProperties);

    elementsToZoom.forEach(originalEl => {
        const clone = originalEl.cloneNode(true);
        clone.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
        clone.classList.remove('controls-active', 'multi-zoom-selected');
        Object.assign(clone.style, { transform: 'none', cursor: 'auto' });

        const originalStyle = getComputedStyle(originalEl);
        const blacklist = ['position', 'top', 'right', 'left', 'bottom', 'z-index', 'float', 'clear', 'outline', 'box-shadow', 'transform', 'transition'];
        if (isOriginalLayoutFlex) blacklist.push('margin', 'margin-top', 'margin-right', 'margin-bottom', 'margin-left');

        for (let i = 0; i < originalStyle.length; i++) {
            const propName = originalStyle[i];
            if (!blacklist.includes(propName) && propName !== 'white-space') {
                try { clone.style.setProperty(propName, originalStyle.getPropertyValue(propName), originalStyle.getPropertyPriority(propName)); } catch(e) {}
            }
        }
        Object.assign(clone.style, {
            display: originalStyle.display, width: originalStyle.width, height: 'auto', minHeight: originalStyle.minHeight,
            boxSizing: 'border-box', outline: 'none', boxShadow: 'none',
            backgroundColor: (originalStyle.backgroundColor === 'rgba(0, 0, 0, 0)' || originalStyle.backgroundColor === 'transparent') ? 'white' : originalStyle.backgroundColor,
            background: originalStyle.background,
            whiteSpace: (originalEl.tagName === 'SPAN' && originalEl.parentElement && getComputedStyle(originalEl.parentElement).display.includes('flex')) ? 'nowrap' : originalStyle.whiteSpace
        });
        if (isOriginalLayoutFlex) clone.style.margin = '';
        else Object.assign(clone.style, { marginTop: '0', marginLeft: 'auto', marginRight: 'auto', marginBottom: '15px' });

        selectionZoomContent.appendChild(clone);
    });
    if (!isOriginalLayoutFlex && selectionZoomContent.lastChild) selectionZoomContent.lastChild.style.marginBottom = '0';

    selectionZoomOverlay.style.display = 'block';
    document.body.classList.add('selection-zoom-active');
    document.body.style.overflow = 'hidden';
    fullscreenChangeHandler();
  }

  function handleMultiZoomTrigger() {
    if (elementsForMultiZoom.length > 0) {
        elementsForMultiZoom.length === 1 ? triggerZoomOnElement(elementsForMultiZoom[0]) : displayMultiZoom([...elementsForMultiZoom]);
    }
  }

  function closeSelectionZoom() {
    selectionZoomOverlay.style.display = 'none';
    selectionZoomContent.innerHTML = '';
    document.body.classList.remove('selection-zoom-active');
    document.body.style.overflow = '';
    fullscreenChangeHandler();
  }
  
  function handleSelectionZoomOverlayClick(event) {
    if (event.target === selectionZoomOverlay || event.target.closest('.close-selection-zoom-btn')) closeSelectionZoom();
  }

  // --- Element Controls and Editing ---
  function activateControls(elementToActivate, focusAndSelect = false) {
      if (currentlyActiveItemControlsElement && currentlyActiveItemControlsElement !== elementToActivate) {
          currentlyActiveItemControlsElement.classList.remove('controls-active');
          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();
      }
      if (elementToActivate) {
          elementToActivate.classList.add('controls-active');
          currentlyActiveItemControlsElement = elementToActivate;
          if (focusAndSelect && elementToActivate.dataset.editableType !== 'page-title') {
              setTimeout(() => {
                  elementToActivate.focus();
                  if (typeof elementToActivate.select === 'function') {
                      elementToActivate.select();
                  } else if (elementToActivate.isContentEditable) {
                      const selection = window.getSelection(), range = document.createRange();
                      if (elementToActivate.firstChild) range.selectNodeContents(elementToActivate);
                      else { range.setStart(elementToActivate, 0); range.collapse(true); }
                      try { selection.removeAllRanges(); selection.addRange(range); } catch(e) { console.warn("Could not set selection:", e); }
                  }
              }, 0);
          }
      } else if (currentlyActiveItemControlsElement) {
          currentlyActiveItemControlsElement.classList.remove('controls-active');
          if (currentlySelectedElementForStyling === currentlyActiveItemControlsElement) hideElementStyleControls();
          currentlyActiveItemControlsElement = null;
      }
  }

  function generateItemControls(element) {
    if (element.querySelector(':scope > .item-controls')) return;
    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'item-controls';

    // Event listeners for these buttons will be handled by event delegation
    if (element.dataset.editableType !== 'button-text-label' && element.dataset.editableType !== 'page-title') {
        const addBtn = document.createElement('button');
        addBtn.className = 'item-control-btn item-control-clone-btn';
        addBtn.innerHTML = 'â•'; addBtn.title = 'í•­ëª© ë³µì œ';
        controlsDiv.appendChild(addBtn);
    }

    const styleBtn = document.createElement('button');
    styleBtn.className = 'item-control-btn item-control-style-btn';
    styleBtn.innerHTML = 'ğŸ¨'; styleBtn.title = 'ìŠ¤íƒ€ì¼ ë³€ê²½';
    controlsDiv.appendChild(styleBtn);

    if (element.dataset.editableType !== 'page-title') {
        const delBtn = document.createElement('button');
        delBtn.className = 'item-control-btn item-control-delete-btn';
        delBtn.innerHTML = 'ğŸ—‘ï¸'; delBtn.title = 'ì‚­ì œ';
        controlsDiv.appendChild(delBtn);
    }

    if (controlsDiv.children.length > 0 && !element.querySelector(':scope > .item-controls')) {
        element.appendChild(controlsDiv);
    }
  }

  function cloneAndInsertElement(sourceElement) {
    let newItem = sourceElement.cloneNode(true);
    newItem.removeAttribute('id');
    newItem.querySelectorAll('.item-controls').forEach(ctrl => ctrl.remove());
    newItem.classList.remove('controls-active', 'multi-zoom-selected');

    const computedStyle = getComputedStyle(sourceElement);
    for (let i = 0; i < computedStyle.length; i++) {
        const propName = computedStyle[i];
        const styleBlacklist = ['position','top','right','left','bottom','z-index','display','visibility','opacity','transform','margin','margin-top','margin-right','margin-bottom','margin-left','outline','outline-color','outline-style','outline-width','outline-offset','box-shadow', 'transition', 'cursor'];
        if (!styleBlacklist.includes(propName)) {
            try { newItem.style.setProperty(computedStyle[i], computedStyle.getPropertyValue(computedStyle[i]), computedStyle.getPropertyPriority(computedStyle[i])); } catch (e) {}
        }
    }
    if (computedStyle.display.includes('block') || computedStyle.display.includes('flex') || computedStyle.display.includes('grid')) newItem.style.display = computedStyle.display;
    else if (sourceElement.tagName === 'SPAN' && (computedStyle.display === 'inline' || !computedStyle.display) ) newItem.style.display = 'inline-block';
    else newItem.style.display = computedStyle.display || 'block';

    if (computedStyle.width !== 'auto' && computedStyle.width !== '0px') newItem.style.width = computedStyle.width;
    if (computedStyle.height !== 'auto' && computedStyle.height !== '0px') newItem.style.height = computedStyle.height;


    sourceElement.parentNode.insertBefore(newItem, sourceElement.nextSibling);
    generateItemControls(newItem);
    newItem.querySelectorAll('[data-editable-type]').forEach(desc => generateItemControls(desc));
    activateControls(newItem, true);
    showMessage('í•­ëª©ì´ ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  }

  // --- Multi-Zoom Selection Logic ---
  function toggleMultiZoomSelection(element) {
    const index = elementsForMultiZoom.indexOf(element);
    if (index > -1) { elementsForMultiZoom.splice(index, 1); element.classList.remove('multi-zoom-selected'); }
    else { elementsForMultiZoom.push(element); element.classList.add('multi-zoom-selected'); }
    updateMultiZoomTriggerVisibility();
  }

  function updateMultiZoomTriggerVisibility() {
    if (multiZoomTriggerBtn) {
        const isSelectionZoomActive = document.body.classList.contains('selection-zoom-active');
        const shouldBeVisible = elementsForMultiZoom.length >= 1 && !isSelectionZoomActive && document.body.classList.contains('true-fullscreen-active');
        multiZoomTriggerBtn.style.display = shouldBeVisible ? 'block' : 'none';
    }
  }
  function clearMultiZoomSelectionVisuals() {
    elementsForMultiZoom.forEach(e => e.classList.remove('multi-zoom-selected'));
    updateMultiZoomTriggerVisibility();
  }

  // --- Event Handling for Element Interaction and Controls ---
  function handleAppContainerClick(event) {
    const target = event.target;

    // --- Event Delegation for Item Controls ---
    const controlButton = target.closest('.item-control-btn');
    if (controlButton) {
        event.stopPropagation();
        const element = controlButton.closest('[data-editable-type]');
        if (!element) return;

        if (controlButton.classList.contains('item-control-clone-btn')) {
            cloneAndInsertElement(element);
        } else if (controlButton.classList.contains('item-control-style-btn')) {
            activateElementStyling(element);
        } else if (controlButton.classList.contains('item-control-delete-btn')) {
            const itemText = (element.textContent.substring(0,20) || "ì´ í•­ëª©").trim();
            if (element.dataset.editableType === 'button-text-label' && element.parentElement?.classList.contains('add-sub-insert-area-btn')) {
                element.parentElement.remove();
            } else {
                element.remove();
            }
            showMessage(`'${itemText}...' í•­ëª© ì‚­ì œë¨.`, 'success');
            if (currentlySelectedElementForStyling === element) { hideElementStyleControls(); currentlySelectedElementForStyling = null; }
            if (currentlyActiveItemControlsElement === element) activateControls(null);
            const indexInMultiZoom = elementsForMultiZoom.indexOf(element);
            if (indexInMultiZoom > -1) { elementsForMultiZoom.splice(indexInMultiZoom, 1); updateMultiZoomTriggerVisibility(); }
        }
        return;
    }
    
    // --- Event Delegation for "Add Insert Area" button ---
    const addInsertAreaButton = target.closest('.add-sub-insert-area-btn');
    if (addInsertAreaButton && !target.closest('[data-editable-type="button-text-label"]')) {
        event.stopPropagation();
        const boxElement = addInsertAreaButton.closest('.box');
        if (boxElement) {
             addInsertAreaToBox(boxElement);
        }
        return;
    }

    // --- Main Click Logic for Selection ---
    const clickedItem = target.closest('[data-editable-type]');
    if (!clickedItem) {
        activateControls(null);
        if (elementsForMultiZoom.length > 0 && !target.closest('#multiZoomTriggerBtn')) {
            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];
        } return;
    }
    
    if (clickedItem.dataset.editableType === 'button-text-label' && target === clickedItem) {
        activateControls(clickedItem, true); event.stopPropagation(); return;
    }
    const interactiveChild = target.closest('a, button:not(.add-sub-insert-area-btn), input, select, textarea');
    if (interactiveChild && clickedItem.contains(interactiveChild) && interactiveChild !== clickedItem) {
        if (interactiveChild.tagName === 'A' && interactiveChild.href && !(event.ctrlKey || event.metaKey)) {
             event.preventDefault(); window.open(interactiveChild.href, '_blank', 'noopener,noreferrer');
        } return;
    }
    event.stopPropagation();

    if (event.ctrlKey || event.metaKey) {
        event.preventDefault();
        if (!(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) &&
            !(clickedItem.dataset.editableType === 'page-title' && elementsForMultiZoom.length === 0 && elementsForMultiZoom.includes(clickedItem) && elementsForMultiZoom.length > 1) ) {
            toggleMultiZoomSelection(clickedItem);
        }
        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem) activateControls(clickedItem);
        else if (elementsForMultiZoom.length !== 1 && currentlyActiveItemControlsElement === clickedItem) activateControls(null);
        else if (elementsForMultiZoom.length > 1 && currentlyActiveItemControlsElement) activateControls(null);

    } else {
        if (elementsForMultiZoom.length > 0 && !elementsForMultiZoom.includes(clickedItem)) {
            clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];
        }
        if (elementsForMultiZoom.length === 1 && elementsForMultiZoom[0] === clickedItem && clickedItem.dataset.editableType === 'page-title') {
            toggleMultiZoomSelection(clickedItem);
        }
        activateControls(clickedItem);
    }
  }

  function handleDocumentClick(event) {
    const isClickInsideAppOrGlobalControls = appContainer.contains(event.target) ||
                                       (menuPanel && menuPanel.contains(event.target)) ||
                                       (selectionZoomOverlay && selectionZoomOverlay.contains(event.target)) ||
                                       (multiZoomTriggerBtn && multiZoomTriggerBtn.contains(event.target)) ||
                                       (floatingMenuToggleBtn && floatingMenuToggleBtn.contains(event.target)) ||
                                       (trueFullscreenBtn && trueFullscreenBtn.contains(event.target)) ||
                                       (annotationSettingsPanel && annotationSettingsPanel.contains(event.target));

    if (!isClickInsideAppOrGlobalControls) {
        if (currentlyActiveItemControlsElement) activateControls(null);
        if (elementsForMultiZoom.length > 0) { clearMultiZoomSelectionVisuals(); elementsForMultiZoom = []; }
    }
  }


  function handleKeyDown(event) {
    if (event.key === 'Shift') {
        isShiftKeyDown = true;
    }
    if (event.ctrlKey || event.metaKey) {
        document.body.classList.add('ctrl-pressed');
        if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {
            event.preventDefault(); try { document.execCommand('undo', false, null); showMessage('ì‹¤í–‰ ì·¨ì†Œë¨', 'success', 1500); }
            catch (e) { showMessage('ì‹¤í–‰ ì·¨ì†Œ ì‹¤íŒ¨.', 'error'); console.error("Undo failed:", e); }
        } else if ((event.key === 'y' || event.key === 'Y') && !event.shiftKey) {
            event.preventDefault(); try { document.execCommand('redo', false, null); showMessage('ë‹¤ì‹œ ì‹¤í–‰ë¨', 'success', 1500); }
            catch (e) { showMessage('ë‹¤ì‹œ ì‹¤í–‰ ì‹¤íŒ¨.', 'error'); console.error("Redo failed:", e); }
        }
    }
  }
  function handleKeyUp(event) {
    if (event.key === 'Shift') {
        isShiftKeyDown = false;
    }
    if (!event.ctrlKey && !event.metaKey) document.body.classList.remove('ctrl-pressed');
  }

  // --- Dynamic Content Addition ---
  function addInsertAreaToBox(boxElement) {
    if (!boxElement || !boxElement.classList.contains('box')) return;
    const template = document.querySelector('.common-item-template .insert-area.templated-insert-area');
    if (!template) { console.error("Insert area template not found!"); showMessage('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }
    let newInsertArea = template.cloneNode(true);
    newInsertArea.textContent = "### ì…ë ¥ ##...";
    newInsertArea.classList.remove('templated-insert-area');
    
    // Find last button and insert before it
    const lastButton = boxElement.querySelector('.add-sub-insert-area-btn:last-of-type');
    if (lastButton) {
        boxElement.insertBefore(newInsertArea, lastButton);
    } else {
        boxElement.appendChild(newInsertArea);
    }

    generateItemControls(newInsertArea);
    activateControls(newInsertArea, true);
    showMessage('í•˜ìœ„ ì…ë ¥ì°½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  }

  // --- Element Styling Controls ---
  function activateElementStyling(element) {
    currentlySelectedElementForStyling = element;
    const styleControls = document.getElementById('elementStyleControls');
    if (!menuPanel || !styleControls) return;

    document.getElementById('elementBgColor').value = rgbToHex(getComputedStyle(element).backgroundColor);
    document.getElementById('elementTextColor').value = rgbToHex(getComputedStyle(element).color);
    const borderRadiusInput = document.getElementById('elementBorderRadius');
    const shapeSelector = document.getElementById('elementShapeSelector');
    const currentBorderRadiusStyle = getComputedStyle(element).borderRadius;

    borderRadiusInput.value = parseInt(currentBorderRadiusStyle) || 0;

    if (currentBorderRadiusStyle === '50%') shapeSelector.value = 'oval';
    else if (currentBorderRadiusStyle.split(' ').every(r => parseFloat(r) === 0 || r === '0px')) shapeSelector.value = 'rectangle';
    else if (parseFloat(currentBorderRadiusStyle) > 0) shapeSelector.value = 'rounded-rectangle';
    else shapeSelector.value = 'default';

    styleControls.style.display = 'block';
    if (menuPanel.style.display !== 'block') togglePanel();
    styleControls.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    showMessage(`'${(element.dataset.editableType || element.tagName).toLowerCase()}' ìŠ¤íƒ€ì¼ í¸ì§‘ ì¤‘`, 'success', 2000);
  }
  function hideElementStyleControls() {
      const styleControls = document.getElementById('elementStyleControls');
      if (styleControls) styleControls.style.display = 'none';
  }
  function applySelectedElementStyle(property, value) {
    if (currentlySelectedElementForStyling) {
      currentlySelectedElementForStyling.style[property] = value;
      if (currentlySelectedElementForStyling === pageTitle) requestAnimationFrame(adjustContainerPadding);
    }
  }
  function applySelectedElementShape(shapeValue) {
    if (!currentlySelectedElementForStyling) return;
    const element = currentlySelectedElementForStyling;
    const borderRadiusInput = document.getElementById('elementBorderRadius');
    let radiusToApply = borderRadiusInput ? parseInt(borderRadiusInput.value) : 5;
    if (isNaN(radiusToApply) || radiusToApply < 0) radiusToApply = 5;

    switch (shapeValue) {
        case 'rectangle': element.style.borderRadius = '0px'; if (borderRadiusInput) borderRadiusInput.value = 0; break;
        case 'rounded-rectangle':
            const currentRadius = parseInt(element.style.borderRadius);
            radiusToApply = (currentRadius === 0 || element.style.borderRadius === '50%') ? 4 : (currentRadius || 4);
            element.style.borderRadius = `${radiusToApply}px`; if (borderRadiusInput) borderRadiusInput.value = radiusToApply; break;
        case 'oval': element.style.borderRadius = '50%'; break;
        case 'default': element.style.borderRadius = '';
            if (borderRadiusInput) borderRadiusInput.value = parseInt(getComputedStyle(element).borderRadius) || 0; break;
    }
    if (element === pageTitle) requestAnimationFrame(adjustContainerPadding);
  }
  function rgbToHex(rgb) {
    if (!rgb || typeof rgb !== 'string' || rgb.indexOf('rgb') === -1) return '#000000';
    if (rgb === 'rgba(0, 0, 0, 0)' || rgb === 'transparent') return '#ffffff';
    let parts = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);
    if (!parts) return '#000000';
    delete parts[0];
    for (let i = 1; i <= 3; ++i) { parts[i] = parseInt(parts[i]).toString(16); if (parts[i].length == 1) parts[i] = '0' + parts[i]; }
    return `#${parts[1]}${parts[2]}${parts[3]}`;
  }

  // --- Text Formatting and Link/Character Insertion ---
  function applyLink() {
    const linkURLInput = document.getElementById("linkURL"); const linkURL = linkURLInput.value.trim();
    if (!linkURL) { showMessage("ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”.", "error"); return; }
    const selection = window.getSelection();
    if (!selection || selection.rangeCount === 0 || selection.isCollapsed) { showMessage("í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.", "error"); return; }

    let prefixedURL = linkURL;
    if (!linkURL.startsWith('http://')&&!linkURL.startsWith('https://')&&!linkURL.startsWith('mailto:')&&!linkURL.startsWith('#')&&!linkURL.includes('://')) {
        prefixedURL = 'http://' + linkURL;
    }
    try { if (!prefixedURL.includes(':') && !prefixedURL.startsWith('#') && !prefixedURL.startsWith('/')) new URL(prefixedURL); }
    catch (_) { showMessage("ìœ íš¨í•œ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.", "error"); return; }

    document.execCommand('createLink', false, prefixedURL);
    let createdLink = selection.anchorNode?.nodeType === Node.TEXT_NODE ? selection.anchorNode.parentElement : selection.anchorNode;
    if (createdLink && createdLink.tagName !== 'A') createdLink = createdLink.closest('a');
    if(createdLink?.tagName === 'A'){ createdLink.target = '_blank'; createdLink.rel = 'noopener noreferrer'; }

    showMessage("ë§í¬ê°€ ì‚½ì…ë˜ì—ˆìŠµë‹ˆë‹¤.", "success"); linkURLInput.value = '';
  }
  function removeLink() { document.execCommand('unlink', false, null); showMessage("ë§í¬ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");}
  function applyBold() { document.execCommand('bold', false, null); }
  function applyItalic() { document.execCommand('italic', false, null); }
  function applyUnderline() { document.execCommand('underline', false, null); }
  function applyStrikethrough() { document.execCommand('strikeThrough', false, null); }
  function applySuperscript() { document.execCommand('superscript', false, null); }
  function applySubscript() { document.execCommand('subscript', false, null); }
  function changeFontSize(size) { if (size) document.execCommand('fontSize', false, size); }
  function changeFontColor(color) { if (color) document.execCommand('foreColor', false, color); }
  function changeBackColor(color) { if (color) document.execCommand('backColor', false, color); }
  function insertCharacterFromInput() { const charToInsert=document.getElementById('charInput').value; if(!charToInsert){showMessage("ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.","warning");return;} insertCharacter(charToInsert); }
  function insertCharacter(char) { if (!char) {showMessage("ì‚½ì…í•  ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.","warning");return;} document.execCommand('insertText', false, char); }
  function toggleEmojiPalette(event) { event.stopPropagation(); document.getElementById('emojiPalette').classList.toggle('show'); }
  
  function handleGlobalEmojiPaletteClick(event) {
    const palette = document.getElementById('emojiPalette'); const emojiDropdown = document.querySelector('.emoji-dropdown');
    if (palette && emojiDropdown && !emojiDropdown.contains(event.target) && palette.classList.contains('show')) palette.classList.remove('show');
  }

  function handleEmojiPaletteButtonClick(event) {
    const button = event.target.closest('.emoji-btn');
    if(button) {
        insertCharacter(button.textContent);
    }
  }


  // --- Save and Print Functionality ---
    /**
     * @param {string} extension - The desired file extension (e.g., 'html' or 'pdf').
     * @returns {string} The generated filename.
     */
    function getSaveFileName(extension) {
        // 1. ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ ì¶”ì¶œ ì‹œë„
        const titleText = pageTitle.textContent || '';
        const match = titleText.match(/(\d{2,4})ë…„\s*(\d{1,2})ì›”/);

        if (match) {
            let year = parseInt(match[1], 10);
            if (year < 100) year += 2000; // YY -> 20YY ë³€í™˜
            let month = parseInt(match[2], 10);

            // 2. URL í…œí”Œë¦¿ì—ì„œ íŒŒì¼ëª… ë¶€ë¶„ë§Œ ì¶”ì¶œ
            const template = monthlyNavigatorConfig.filenameStructureTemplate;
            const filenameTemplate = template.split('/').pop();

            // 3. í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ íŒŒì¼ëª… ìƒì„±
            const filename = filenameTemplate
                .replace(/{YYYY}/g, year)
                .replace(/{YY}/g, String(year).slice(-2))
                .replace(/{MM}/g, String(month).padStart(2, '0'))
                .replace(/{M}/g, month);

            // 4. ìš”ì²­ëœ í™•ì¥ìì™€ íŒŒì¼ëª…ì˜ í™•ì¥ìê°€ ë‹¤ë¥¸ ê²½ìš°, ìš”ì²­ëœ í™•ì¥ìë¡œ êµì²´
            // ì˜ˆ: í…œí”Œë¦¿ì´ 'file.txt' ì´ê³  extensionì´ 'html'ì´ë©´ 'file.html'ë¡œ ë³€ê²½
            if (filename.includes('.') && !filename.toLowerCase().endsWith(`.${extension.toLowerCase()}`)) {
                 const baseName = filename.substring(0, filename.lastIndexOf('.'));
                 return `${baseName}.${extension}`;
            }
            // í…œí”Œë¦¿ì— í™•ì¥ìê°€ ì—†ëŠ” ê²½ìš°, í™•ì¥ì ì¶”ê°€
            if (!filename.includes('.')) {
                return `${filename}.${extension}`;
            }
            
            return filename; // í…œí”Œë¦¿ì˜ í™•ì¥ìì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
        }

        // 5. í´ë°±: ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ì˜ ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±
        console.warn("ë¬¸ì„œ ì œëª©ì—ì„œ ì—°/ì›” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´, í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ íŒŒì¼ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤.");
        const dateInfo = getFormattedDateForFilename();
        const defaultFilename = `${dateInfo.yearYYYY}_${dateInfo.monthMM}ì›”_íšŒì˜ì•ˆê±´.${extension}`;
        return defaultFilename;
    }


 function saveHTML() {
    if (menuPanel.style.display === "block") togglePanel();
    if (isAnnotationPanelOpen) {
        drawingSettings = { ...panelUISettings };
        applySettingsToContext(drawingSettings);
        isAnnotationPanelOpen = false;
        annotationSettingsPanel.style.display = 'none';
        annotationSettingsToggleBtn.classList.remove('active');
        if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
    }
    if(document.getElementById('customMessageBox').style.display === 'block') document.getElementById('customMessageBox').style.display = 'none';
    if (selectionZoomOverlay.style.display === 'block') closeSelectionZoom();
    if(currentlyActiveItemControlsElement) activateControls(null);
    clearMultiZoomSelectionVisuals();

    const clonedAppContainer = appContainer.cloneNode(true);

    clonedAppContainer.querySelectorAll('.controls-active').forEach(el=>el.classList.remove('controls-active'));
    clonedAppContainer.querySelectorAll('.multi-zoom-selected').forEach(el=>el.classList.remove('multi-zoom-selected'));
    clonedAppContainer.querySelectorAll('.item-controls').forEach(el=>el.remove());

    const originalPageTitle = document.getElementById('page-title'), clonedPageTitle = clonedAppContainer.querySelector('#page-title');
    if(originalPageTitle && clonedPageTitle) clonedPageTitle.innerHTML = originalPageTitle.innerHTML;

    const originalContentArea = document.getElementById('content');
    const clonedContentArea = clonedAppContainer.querySelector('#content');
    if(originalContentArea && clonedContentArea) {
        const tempDivForContent = document.createElement('div');
        tempDivForContent.innerHTML = originalContentArea.innerHTML;
        const canvasInContent = tempDivForContent.querySelector('#annotationCanvas');
        if (canvasInContent) canvasInContent.innerHTML = '';
        clonedContentArea.innerHTML = tempDivForContent.innerHTML;
    }

    let clonedExternalElementsHTML = "";
    const elementsStructurallyOutsideIDs = ['customMessageBox','menuPanel','areaSelectionRectangle','selectionZoomOverlay'];
     elementsStructurallyOutsideIDs.forEach(id => {
        const originalElement = document.getElementById(id);
        if (originalElement) {
            const clonedElement = originalElement.cloneNode(true);
            clonedElement.style.display='none';
            if (id==='menuPanel' && originalElement.style.left && originalElement.style.top) {
                Object.assign(clonedElement.style, {
                    left:originalElement.style.left, top:originalElement.style.top,
                    right:'auto', bottom:'auto',
                    width: originalElement.style.width, height: originalElement.style.height
                });
            }
            clonedExternalElementsHTML += clonedElement.outerHTML + "\n";
        }
    });

    const appSaveState = {
        wasFullscreenActive: document.body.classList.contains('true-fullscreen-active'),
        isDrawingFeatureActive: isDrawingFeatureActive,
        isAnnotationPanelOpen: false,
        isMemoModeActive: isMemoModeActive,
        drawingSettings: drawingSettings,
        panelUISettings: panelUISettings,
        keepDrawingsVisibleOnDeactivate: keepDrawingsVisibleOnDeactivate,
        drawnStrokes: drawnStrokes,
        monthlyNavigatorConfig: monthlyNavigatorConfig, // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì €ì¥
        pageTitle_innerHTML: pageTitle.innerHTML,
        contentArea_innerHTML: (() => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contentArea.innerHTML;
            tempDiv.querySelector('#annotationCanvas')?.remove();
            return tempDiv.innerHTML;
        })(),
        menuPanel_style_display: 'none',
        menuPanel_style_left: menuPanel.style.left,
        menuPanel_style_top: menuPanel.style.top,
        menuPanel_style_width: menuPanel.style.width,
        menuPanel_style_height: menuPanel.style.height,
        editIconsMode: document.querySelector('input[name="editIconsMode"]:checked')?.value || 'off'
    };
    
    // ìƒíƒœë¥¼ data ì†ì„±ì— ì‚½ì…í•˜ëŠ” ëŒ€ì‹ , ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    const scriptToRestoreState = `<script>
        window.__SAVED_APP_STATE__ = ${JSON.stringify(appSaveState)};
    <\/script>`;


    const commonTemplate = document.querySelector('.common-item-template');
    let clonedCommonTemplateHTML = commonTemplate ? commonTemplate.cloneNode(true).outerHTML + "\n" : "";

    let htmlOutput = `<!DOCTYPE html>\n<html lang="ko">\n<head>\n  ${Array.from(document.querySelectorAll('head > meta')).map(m=>m.outerHTML).join('\n  ')}\n  <title>${document.title}</title>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>\n  <style>\n${Array.from(document.styleSheets).map(s=>Array.from(s.cssRules||[]).map(r=>r.cssText).join('\n')).join('\n')}\n  </style>\n  ${scriptToRestoreState}\n</head>\n<body>\n${clonedAppContainer.outerHTML}\n${clonedExternalElementsHTML}${clonedCommonTemplateHTML}`;
    const mainScriptElement = document.getElementById('mainAppScript');
    if (mainScriptElement) htmlOutput += `<script id="mainAppScript" defer>\n${mainScriptElement.innerHTML}\n<\/script>\n`;
    else showMessage("ì €ì¥ ì˜¤ë¥˜: í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸ ëˆ„ë½.", "error");
    htmlOutput += "</body>\n</html>";

    const blob = new Blob([htmlOutput],{type:"text/html;charset=utf-8"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download = getSaveFileName('html'); // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©
    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href);
    showMessage("HTML íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
  }

  function printPDF() {
    if(currentlyActiveItemControlsElement) activateControls(null);
    hideElementStyleControls();
    clearMultiZoomSelectionVisuals(); elementsForMultiZoom = [];

    const elementsToHide = [
        floatingMenuToggleBtn, trueFullscreenBtn, multiZoomTriggerBtn, menuPanel,
        selectionZoomOverlay, exitTrueFullscreenBtnActual, document.getElementById('customMessageBox'),
        annotationDisplayToggleBtn, annotationSettingsToggleBtn, annotationSettingsPanel, memoAnnotationToggleBtn,
        document.getElementById('monthlyNavigatorContainer') // ë„¤ë¹„ê²Œì´í„°ë„ ìˆ¨ê¹€
    ];
    const originalDisplays = elementsToHide.map(el => el ? el.style.display : null);
    elementsToHide.forEach(el => { if(el) el.style.display = 'none'; });
    document.querySelectorAll('.item-controls').forEach(ctrl => ctrl.style.display = 'none');


    let tempImgForPrint = null;
    if (annotationCanvas.width > 0 && annotationCanvas.height > 0 && (isDrawingFeatureActive || (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0))) {
        try {
            const dataUrl = annotationCanvas.toDataURL('image/png');
            if (dataUrl !== 'data:,') {
                tempImgForPrint = document.createElement('img');
                tempImgForPrint.src = dataUrl;
                Object.assign(tempImgForPrint.style, {
                    position: 'absolute', top: annotationCanvas.offsetTop + 'px', left: annotationCanvas.offsetLeft + 'px',
                    width: annotationCanvas.width + 'px', height: annotationCanvas.height + 'px',
                    zIndex: '4', pointerEvents: 'none', display: 'block'
                });
                contentArea.appendChild(tempImgForPrint);
            }
        } catch (e) { console.error("Error generating annotation image for PDF:", e); }
    }
    const originalCanvasDisplay = annotationCanvas.style.display;
    if(annotationCanvas) annotationCanvas.style.display = 'none';

    const originalBodyPaddingTop = document.body.style.paddingTop;
    const originalPageTitlePosition = pageTitle.style.position;
    const originalContainerPaddingTop = contentArea.style.paddingTop;


    document.body.style.paddingTop = '0px';
    contentArea.style.paddingTop = '0px'; // ì¸ì‡„ ì‹œì—ëŠ” íŒ¨ë”© ì œê±°
    if (getComputedStyle(pageTitle).position === 'fixed' || getComputedStyle(pageTitle).position === 'sticky') {
        pageTitle.style.position = 'relative';
    }
    window.scrollTo(0, 0);

    const pdfOptions = {
        margin: [5, 5, 5, 5],
        filename: getSaveFileName('pdf'), // ê°œì„ ëœ í•¨ìˆ˜ ì‚¬ìš©
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
            scale: 2,
            useCORS: true,
            logging: false,
            removeContainer: true,
            scrollY: 0,
            windowWidth: document.documentElement.scrollWidth,
            windowHeight: document.documentElement.scrollHeight,
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
        enableLinks: true
    };

    showMessage("PDF ìƒì„± ì¤€ë¹„ ì¤‘...", "success", 2000);

    setTimeout(() => {
        html2pdf().from(appContainer).set(pdfOptions).save()
        .then(() => {
            showMessage("PDF ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
        }).catch(err => {
            console.error("PDF ìƒì„± ì˜¤ë¥˜:", err);
            showMessage("PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }).finally(() => {
            if (tempImgForPrint && contentArea.contains(tempImgForPrint)) contentArea.removeChild(tempImgForPrint);
            if(annotationCanvas) annotationCanvas.style.display = originalCanvasDisplay;

            elementsToHide.forEach((el, i) => { if(el) el.style.display = originalDisplays[i] || ''; });
            const checkedMode = document.querySelector('input[name="editIconsMode"]:checked');
            if(checkedMode) toggleEditIconsVisibility(checkedMode.value);


            pageTitle.style.position = originalPageTitlePosition;
            // íŒ¨ë”© ì›ìƒë³µêµ¬
            adjustContainerPadding();
            fullscreenChangeHandler();
        });
    }, 300);
  }

  // body í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ì´ì½˜ í‘œì‹œ/ìˆ¨ê¹€ì„ ì „ì—­ì ìœ¼ë¡œ ì œì–´
  function toggleEditIconsVisibility(mode) {
      if(!mode) return;
      localStorage.setItem('editIconsMode', mode);
      
      document.body.classList.remove('show-icons-all', 'show-icons-selected');

      if (mode === 'all') {
          document.body.classList.add('show-icons-all');
      } else if (mode === 'selected') {
          document.body.classList.add('show-icons-selected');
      }
      // 'off' mode needs no class, as the default is to hide the controls.
  }


  // --- Annotation Functionality (Largely unchanged) ---
  function updateAnnotationDisplayToggleBtnStyle() {
    if(!annotationDisplayToggleBtn) return;
    if (isDrawingFeatureActive) {
        annotationDisplayToggleBtn.classList.add('active');
        annotationDisplayToggleBtn.title = "ì£¼ì„ ë„ê¸°";
    } else {
        annotationDisplayToggleBtn.classList.remove('active');
        annotationDisplayToggleBtn.title = "ì£¼ì„ ì¼œê¸°";
    }
  }

  function loadPanelUIWithSettings(settings) {
    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {
        if(btn) btn.classList.remove('tool-active');
    });
    const activeBtn = document.querySelector(`#annotationSettingsPanel button[data-tool="${settings.tool}"]`);
    if (activeBtn) activeBtn.classList.add('tool-active');


    if (settings.tool === 'highlighter') {
        annoColorPicker.value = settings.highlighterColor;
        annoLineWidthSlider.value = settings.highlighterLineWidth;
        annoHighlighterOpacitySlider.value = settings.highlighterOpacity;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'flex';
    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {
        annoColorPicker.value = settings.penColor;
        annoLineWidthSlider.value = settings.penLineWidth;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';
    } else {
        annoLineWidthSlider.value = settings.penLineWidth;
        if(annoHighlighterOpacityContainer) annoHighlighterOpacityContainer.style.display = 'none';
    }
  }

  function applySettingsToContext(settings) {
    if (!annotationCtx) return;
    annotationCtx.globalCompositeOperation = 'source-over';

    if (settings.tool === 'highlighter') {
        annotationCtx.strokeStyle = settings.highlighterColor;
        annotationCtx.lineWidth = settings.highlighterLineWidth;
        annotationCtx.globalAlpha = 1.0 - parseFloat(settings.highlighterOpacity);
    } else if (settings.tool === 'pen' || settings.tool === 'circle' || settings.tool === 'ellipse' || settings.tool === 'orthoLine') {
        annotationCtx.strokeStyle = settings.penColor;
        annotationCtx.lineWidth = settings.penLineWidth;
        annotationCtx.globalAlpha = 1.0;
    } else if (settings.tool === 'eraser') {
        annotationCtx.lineWidth = settings.penLineWidth;
        annotationCtx.globalAlpha = 1.0;
    }
  }

  function setAnnotationDefaults() {
    drawingSettings = {
        tool: 'pen',
        penColor: '#800080', penLineWidth: '5',
        highlighterColor: '#FFFFE0', highlighterLineWidth: '20', highlighterOpacity: '0.3',
    };
    panelUISettings = { ...drawingSettings };
    if(annoKeepDrawingsVisibleCheckbox) keepDrawingsVisibleOnDeactivate = annoKeepDrawingsVisibleCheckbox.checked;
    if(menuAnnoKeepDrawingsVisible) menuAnnoKeepDrawingsVisible.checked = keepDrawingsVisibleOnDeactivate;
    if(annoHighlighterOpacitySlider) annoHighlighterOpacitySlider.value = drawingSettings.highlighterOpacity;
  }

  function redrawAllStrokes() {
    if (!annotationCtx || !annotationCanvas) return;
    annotationCtx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);
    drawnStrokes.forEach(stroke => {
        annotationCtx.beginPath();
        annotationCtx.lineWidth = stroke.lineWidth;
        annotationCtx.strokeStyle = stroke.color;
        annotationCtx.globalAlpha = stroke.opacity;
        annotationCtx.globalCompositeOperation = 'source-over';

        if (stroke.type === 'path' || stroke.type === 'line') {
            annotationCtx.moveTo(stroke.points[0].x, stroke.points[0].y);
            for (let i = 1; i < stroke.points.length; i++) {
                annotationCtx.lineTo(stroke.points[i].x, stroke.points[i].y);
            }
            annotationCtx.stroke();
        } else if (stroke.type === 'circle') {
            annotationCtx.arc(stroke.x, stroke.y, stroke.radius, 0, Math.PI * 2);
            annotationCtx.stroke();
        } else if (stroke.type === 'ellipse') {
            annotationCtx.ellipse(stroke.x, stroke.y, stroke.radiusX, stroke.radiusY, 0, 0, Math.PI * 2);
            annotationCtx.stroke();
        }
    });
    applySettingsToContext(drawingSettings);
  }


  function setupAnnotationCanvas() {
    if (!contentArea || !annotationCanvas) return;

    const isFs = document.body.classList.contains('true-fullscreen-active');
    const newWidth = contentArea.scrollWidth;
    const newHeight = contentArea.scrollHeight;

    if (annotationCanvas.width !== newWidth || annotationCanvas.height !== newHeight) {
        annotationCanvas.width = newWidth;
        annotationCanvas.height = newHeight;
    }

    annotationCtx = annotationCanvas.getContext('2d');
    annotationCtx.lineCap = 'round';
    annotationCtx.lineJoin = 'round';

    redrawAllStrokes();

    annotationCanvas.style.top = `0px`;
    annotationCanvas.style.left = `0px`;


    if (isFs) {
        annotationCanvas.style.display = isDrawingFeatureActive ? 'block' : (keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none');
        annotationCanvas.style.pointerEvents = isDrawingFeatureActive ? 'auto' : 'none';
        annotationCanvas.style.cursor = (isDrawingFeatureActive && drawingSettings.tool === 'eraser') ? 'crosshair' :
                                       (isDrawingFeatureActive) ? 'crosshair' : 'default';
    } else {
        annotationCanvas.style.display = (isDrawingFeatureActive || keepDrawingsVisibleOnDeactivate) && drawnStrokes.length > 0 ? 'block' : 'none';
        annotationCanvas.style.pointerEvents = 'none';
        annotationCanvas.style.cursor = 'default';
    }
    applySettingsToContext(drawingSettings);
  }


  function getAnnotationMousePos(event) {
    const rect = annotationCanvas.getBoundingClientRect();
    const scaleX = annotationCanvas.width / rect.width;
    const scaleY = annotationCanvas.height / rect.height;
    let clientX = event.clientX;
    let clientY = event.clientY;
    if (event.touches && event.touches.length > 0) {
        clientX = event.touches[0].clientX;
        clientY = event.touches[0].clientY;
    }
    return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
    };
  }

  let currentStroke = null;

  function startAnnotationDrawing(e) {
    if (!isDrawingFeatureActive || (e.button !== undefined && e.button !== 0) ) {
        return;
    }
    if(isDrawingFeatureActive) e.preventDefault();


    if (isMemoModeActive) return;

    const pos = getAnnotationMousePos(e);

    if (drawingSettings.tool === 'eraser') {
        eraseStrokeAtPoint(pos);
        isDrawingAnnotation = false;
        return;
    }

    applySettingsToContext(drawingSettings);
    isDrawingAnnotation = true;
    shapeStartX = pos.x;
    shapeStartY = pos.y;
    lastAnnotationX = pos.x;
    lastAnnotationY = pos.y;


    if (drawingSettings.tool === 'orthoLine' || drawingSettings.tool === 'circle' || drawingSettings.tool === 'ellipse' || (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter'))) {
        if (annotationCanvas.width > 0 && annotationCanvas.height > 0) {
            previewImageData = annotationCtx.getImageData(0, 0, annotationCanvas.width, annotationCanvas.height);
        } else { previewImageData = null;}
        currentStroke = null;
    } else if (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter') {
        annotationCtx.beginPath();
        annotationCtx.moveTo(pos.x, pos.y);
        currentStroke = {
            type: 'path',
            tool: drawingSettings.tool,
            color: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor,
            lineWidth: drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth,
            opacity: drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0,
            points: [pos]
        };
    }
  }

  function drawAnnotation(e) {
    if (!isDrawingAnnotation || !isDrawingFeatureActive ) return;
    if (isMemoModeActive || drawingSettings.tool === 'eraser') return;
    if(isDrawingFeatureActive) e.preventDefault();
    const pos = getAnnotationMousePos(e);

    if (previewImageData) annotationCtx.putImageData(previewImageData, 0, 0);
    applySettingsToContext(drawingSettings);
    annotationCtx.beginPath();

    if ((isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) || drawingSettings.tool === 'orthoLine') {
        let endX = pos.x;
        let endY = pos.y;
        if (drawingSettings.tool === 'orthoLine') {
            if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }
            else { endX = shapeStartX; }
        }
        annotationCtx.moveTo(shapeStartX, shapeStartY);
        annotationCtx.lineTo(endX, endY);
    } else if (drawingSettings.tool === 'circle') {
        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));
        annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);
    } else if (drawingSettings.tool === 'ellipse') {
        const radiusX = Math.abs(pos.x - shapeStartX) / 2;
        const radiusY = Math.abs(pos.y - shapeStartY) / 2;
        const centerX = shapeStartX + (pos.x - shapeStartX) / 2;
        const centerY = shapeStartY + (pos.y - shapeStartY) / 2;
        annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);
    } else {
        if (!currentStroke) return;
        annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);
        for(let i = 1; i < currentStroke.points.length; i++) {
            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);
        }
        annotationCtx.lineTo(pos.x, pos.y);
    }
    annotationCtx.stroke();

    if (!isShiftKeyDown && drawingSettings.tool !== 'circle' && drawingSettings.tool !== 'ellipse' && drawingSettings.tool !== 'orthoLine' && currentStroke) {
        currentStroke.points.push(pos);
    }

    lastAnnotationX = pos.x;
    lastAnnotationY = pos.y;
  }

  function stopAnnotationDrawing(e) {
    if (!isDrawingAnnotation) {
        return;
    }
    if (isMemoModeActive || drawingSettings.tool === 'eraser') {
        isDrawingAnnotation = false;
        currentStroke = null;
        previewImageData = null;
        return;
    }
    if(isDrawingFeatureActive) e.preventDefault();

    const pos = getAnnotationMousePos(e);
    if (previewImageData) {
        annotationCtx.putImageData(previewImageData, 0, 0);
        previewImageData = null;
    }
    applySettingsToContext(drawingSettings);
    annotationCtx.beginPath();

    let newStroke = null;
    let endX = pos.x;
    let endY = pos.y;

    if (drawingSettings.tool === 'orthoLine') {
        if (Math.abs(pos.x - shapeStartX) > Math.abs(pos.y - shapeStartY)) { endY = shapeStartY; }
        else { endX = shapeStartX; }
         annotationCtx.moveTo(shapeStartX, shapeStartY);
         annotationCtx.lineTo(endX, endY);
         newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: endX, y: endY}] };
    } else if (isShiftKeyDown && (drawingSettings.tool === 'pen' || drawingSettings.tool === 'highlighter')) {
        annotationCtx.moveTo(shapeStartX, shapeStartY);
        annotationCtx.lineTo(pos.x, pos.y);
        newStroke = { type: 'line', tool: drawingSettings.tool, points: [{x: shapeStartX, y: shapeStartY}, {x: pos.x, y: pos.y}] };
    } else if (drawingSettings.tool === 'circle') {
        const radius = Math.sqrt(Math.pow(pos.x - shapeStartX, 2) + Math.pow(pos.y - shapeStartY, 2));
        if (radius > 0.1) {
            annotationCtx.arc(shapeStartX, shapeStartY, radius, 0, Math.PI * 2);
            newStroke = { type: 'circle', tool: drawingSettings.tool, x: shapeStartX, y: shapeStartY, radius: radius };
        }
    } else if (drawingSettings.tool === 'ellipse') {
        const radiusX = Math.abs(pos.x - shapeStartX) / 2;
        const radiusY = Math.abs(pos.y - shapeStartY) / 2;
        if (radiusX > 0.1 && radiusY > 0.1) {
            const centerX = shapeStartX + (pos.x - shapeStartX) / 2;
            const centerY = shapeStartY + (pos.y - shapeStartY) / 2;
            annotationCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);
            newStroke = { type: 'ellipse', tool: drawingSettings.tool, x: centerX, y: centerY, radiusX: radiusX, radiusY: radiusY };
        }
    } else if (currentStroke && currentStroke.points.length > 0) {
         currentStroke.points.push(pos);
         annotationCtx.moveTo(currentStroke.points[0].x, currentStroke.points[0].y);
         for(let i=1; i < currentStroke.points.length; i++) {
            annotationCtx.lineTo(currentStroke.points[i].x, currentStroke.points[i].y);
         }
         newStroke = { ...currentStroke };
    }

    if (newStroke) {
        newStroke.color = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterColor : drawingSettings.penColor;
        newStroke.lineWidth = drawingSettings.tool === 'highlighter' ? drawingSettings.highlighterLineWidth : drawingSettings.penLineWidth;
        newStroke.opacity = drawingSettings.tool === 'highlighter' ? (1.0 - parseFloat(drawingSettings.highlighterOpacity)) : 1.0;
        drawnStrokes.push(newStroke);
        annotationCtx.stroke();
    }

    isDrawingAnnotation = false;
    currentStroke = null;
  }

  function distToSegmentSquared(p, v, w) {
    const l2 = (v.x - w.x)**2 + (v.y - w.y)**2;
    if (l2 === 0) return (p.x - v.x)**2 + (p.y - v.y)**2;
    let t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
    t = Math.max(0, Math.min(1, t));
    const closestX = v.x + t * (w.x - v.x);
    const closestY = v.y + t * (w.y - v.y);
    return (p.x - closestX)**2 + (p.y - closestY)**2;
  }


  function eraseStrokeAtPoint(clickPos) {
    if(drawingSettings.tool !== 'eraser') return;
    let erased = false;
    const clickTolerance = 10;

    for (let i = drawnStrokes.length - 1; i >= 0; i--) {
        const stroke = drawnStrokes[i];
        const strokeWidth = parseFloat(stroke.lineWidth || drawingSettings.penLineWidth);
        const tolerance = (strokeWidth / 2) + clickTolerance;
        let hit = false;

        if (stroke.type === 'path' || stroke.type === 'line') {
            for (let j = 0; j < stroke.points.length - 1; j++) {
                if (distToSegmentSquared(clickPos, stroke.points[j], stroke.points[j+1]) < tolerance**2) {
                    hit = true; break;
                }
            }
            if (!hit && stroke.points.length === 1) {
                 if (distToSegmentSquared(clickPos, stroke.points[0], stroke.points[0]) < tolerance**2) hit = true;
            }
        } else if (stroke.type === 'circle') {
            const dist = Math.sqrt(Math.pow(clickPos.x - stroke.x, 2) + Math.pow(clickPos.y - stroke.y, 2));
            if (Math.abs(dist - stroke.radius) < tolerance ) hit = true;
        } else if (stroke.type === 'ellipse') {
            const dx = clickPos.x - stroke.x;
            const dy = clickPos.y - stroke.y;
            const normalizedX = dx / (stroke.radiusX + tolerance);
            const normalizedY = dy / (stroke.radiusY + tolerance);
            if ((normalizedX * normalizedX) + (normalizedY * normalizedY) <= 1) {
                hit = true;
            }
        }

        if (hit) {
            drawnStrokes.splice(i, 1);
            erased = true;
            break;
        }
    }
    if (erased) {
        redrawAllStrokes();
        showMessage("ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success", 1000);
    }
  }


  // --- Annotation Feature Toggles and Panel Controls ---
  function toggleDrawingFeature() {
      if (isMemoModeActive) {
          isMemoModeActive = false;
          memoAnnotationToggleBtn.classList.remove('active');
          if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.remove('active');
          contentArea.style.cursor = 'auto';
          showMessage("ë©”ëª¨ ëª¨ë“œ ë¹„í™œì„±í™”ë¨.", "success", 1500);
      }

      isDrawingFeatureActive = !isDrawingFeatureActive;
      updateAnnotationDisplayToggleBtnStyle();
      if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.toggle('active', isDrawingFeatureActive);

      if (isDrawingFeatureActive) {
          annotationCanvas.style.display = 'block';
          if (document.body.classList.contains('true-fullscreen-active')) {
              annotationCanvas.style.pointerEvents = 'auto';
          } else {
              annotationCanvas.style.pointerEvents = 'none';
          }
          applySettingsToContext(drawingSettings);
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° í™œì„±í™”ë¨.", "success", 1500);
      } else {
          annotationCanvas.style.pointerEvents = 'none';
          annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
          if (isAnnotationPanelOpen) {
              isAnnotationPanelOpen = false;
              annotationSettingsPanel.style.display = 'none';
              annotationSettingsToggleBtn.classList.remove('active');
              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
          }
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° ë¹„í™œì„±í™”ë¨.", "success", 1500);
      }
      setupAnnotationCanvas();
  }

  function toggleAnnotationSettingsPanel() {
      if (!isDrawingFeatureActive && document.body.classList.contains('true-fullscreen-active')) {
          showMessage("ì£¼ì„ ê·¸ë¦¬ê¸°ë¥¼ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ğŸ‘ï¸ ì•„ì´ì½˜).", "warning");
          return;
      }
      if (!isDrawingFeatureActive && !document.body.classList.contains('true-fullscreen-active')) {
          showMessage("ì£¼ì„ ê¸°ëŠ¥ì„ ë¨¼ì € ì¼œì£¼ì„¸ìš” (ë©”ë‰´ ì—´ê¸° > ì£¼ì„ ì¼œê¸°/ë„ê¸°).", "warning");
          return;
      }


      isAnnotationPanelOpen = !isAnnotationPanelOpen;
      annotationSettingsPanel.style.display = isAnnotationPanelOpen ? 'flex' : 'none';
      annotationSettingsToggleBtn.classList.toggle('active', isAnnotationPanelOpen);
      if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.toggle('active', isAnnotationPanelOpen);

      if (isAnnotationPanelOpen) {
          panelUISettings = { ...drawingSettings };
          loadPanelUIWithSettings(panelUISettings);
      } else {
          drawingSettings = { ...panelUISettings };
          applySettingsToContext(drawingSettings);
      }
      setupAnnotationCanvas();
  }
  
  function handleAnnotationToolClick(e) {
    const newTool = e.target.closest('button').dataset.tool;

    if (newTool === 'eraser') {
        panelUISettings.tool = (panelUISettings.tool === 'eraser') ? 'pen' : 'eraser';
    } else {
        panelUISettings.tool = newTool;
    }

    if (panelUISettings.tool === 'highlighter') {
        panelUISettings.highlighterColor = panelUISettings.highlighterColor || drawingSettings.highlighterColor;
        panelUISettings.highlighterLineWidth = panelUISettings.highlighterLineWidth || drawingSettings.highlighterLineWidth;
        panelUISettings.highlighterOpacity = panelUISettings.highlighterOpacity || drawingSettings.highlighterOpacity;
    } else if (['pen', 'circle', 'ellipse', 'orthoLine'].includes(panelUISettings.tool)) {
         panelUISettings.penColor = panelUISettings.penColor || drawingSettings.penColor;
         panelUISettings.penLineWidth = panelUISettings.penLineWidth || drawingSettings.penLineWidth;
    }

    loadPanelUIWithSettings(panelUISettings);
    applySettingsToContext(panelUISettings);
    setupAnnotationCanvas();
  }
  
  function handleCloseAnnotationSettings() {
    drawingSettings = { ...panelUISettings };
    applySettingsToContext(drawingSettings);
    isAnnotationPanelOpen = false;
    annotationSettingsPanel.style.display = 'none';
    annotationSettingsToggleBtn.classList.remove('active');
    if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
    setupAnnotationCanvas();
    showMessage("ì£¼ì„ ì„¤ì • ì ìš©ë¨.", "success", 1500);
  }

  function handleMenuKeepDrawingsToggle(isChecked) {
    keepDrawingsVisibleOnDeactivate = isChecked;
    if(annoKeepDrawingsVisibleCheckbox) annoKeepDrawingsVisibleCheckbox.checked = keepDrawingsVisibleOnDeactivate;
    if (!isDrawingFeatureActive && annotationCanvas) {
        annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
    }
  }

  function handleClearCanvasClick() {
    if (!isDrawingFeatureActive) {
         showMessage("ì£¼ì„ ê·¸ë¦¬ê¸° ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.", "warning"); return;
    }
    drawnStrokes = [];
    redrawAllStrokes();
    showMessage("ëª¨ë“  ì£¼ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success", 1500);
  }


  // --- Memo Annotation Functionality ---
  function handleMemoToggleClick() {
    const isFs = document.body.classList.contains('true-fullscreen-active');
    if (!isFs) {
        showMessage("ë©”ëª¨ ì¶”ê°€ëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "warning");
        return;
    }
    toggleMemoMode();
  }
  
  function handleMenuMemoToggleClick() {
    handleMemoToggleClick();
    if(menuPanel.style.display === "block") togglePanel();
  }

  function toggleMemoMode() {
      isMemoModeActive = !isMemoModeActive;
      memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);
      if(menuMemoAnnotationBtn) menuMemoAnnotationBtn.classList.toggle('active', isMemoModeActive);
      contentArea.style.cursor = isMemoModeActive ? 'copy' : 'auto';

      if (isMemoModeActive) {
          if (isDrawingFeatureActive) {
              isDrawingFeatureActive = false;
              isAnnotationPanelOpen = false;
              annotationSettingsPanel.style.display = 'none';
              annotationSettingsToggleBtn.classList.remove('active');
              if(menuAnnoSettingsPanelToggle) menuAnnoSettingsPanelToggle.classList.remove('active');
              annotationCanvas.style.pointerEvents = 'none';
              annotationCanvas.style.display = keepDrawingsVisibleOnDeactivate && drawnStrokes.length > 0 ? 'block' : 'none';
              updateAnnotationDisplayToggleBtnStyle();
              if(menuAnnoDrawingToggle) menuAnnoDrawingToggle.classList.remove('active');
          }
          showMessage("ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ í™œì„±í™”. ë‚´ìš©ì„ í´ë¦­í•˜ì—¬ ë©”ëª¨ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.", "success", 2500);
      } else {
          showMessage("ë©”ëª¨ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™”.", "success", 1500);
      }
  }


  contentArea.addEventListener('click', function(event) {
    if (isMemoModeActive && document.body.classList.contains('true-fullscreen-active')) {
        if (event.target.closest('[data-editable-type], .text-annotation-memo, button, a, input, select, textarea, .item-controls')) {
            return;
        }
        if (event.detail === 0 && event.clientX === 0 && event.clientY === 0) {
            return;
        }

        const rect = contentArea.getBoundingClientRect();
        const x = event.clientX - rect.left + contentArea.scrollLeft;
        const y = event.clientY - rect.top + contentArea.scrollTop;

        createMemoAnnotation(x, y);
    }
  });

  function createMemoAnnotation(x, y) {
    const memoDiv = document.createElement('div');
    memoDiv.className = 'text-annotation-memo';
    memoDiv.setAttribute('contenteditable', 'true');
    memoDiv.style.left = Math.max(0, x - 10) + 'px';
    memoDiv.style.top = Math.max(0, y - 10) + 'px';
    memoDiv.textContent = 'ë©”ëª¨ ì…ë ¥...';

    const deleteBtn = document.createElement('span');
    deleteBtn.innerHTML = '&times;';
    deleteBtn.className = 'memo-delete-btn';
    deleteBtn.title = 'ë©”ëª¨ ì‚­ì œ';
    // Event listener for this will be handled by event delegation
    memoDiv.appendChild(deleteBtn);

    contentArea.appendChild(memoDiv);
    makeMemoDraggable(memoDiv);
    setTimeout(() => {
        memoDiv.focus();
        const selection = window.getSelection();
        const range = document.createRange();
        if (memoDiv.firstChild && memoDiv.firstChild.nodeType === Node.TEXT_NODE) {
            range.selectNodeContents(memoDiv.firstChild);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }, 0);
  }
  
  contentArea.addEventListener('click', function(event) {
      // Memo delete button delegation
      const deleteBtn = event.target.closest('.memo-delete-btn');
      if (deleteBtn) {
          event.stopPropagation();
          const memoDiv = deleteBtn.closest('.text-annotation-memo');
          if (memoDiv) {
              memoDiv.remove();
          }
      }
  });

  function makeMemoDraggable(memoElement) {
    let currentX, currentY, initialMouseX, initialMouseY, isDraggingMemo = false;

    memoElement.addEventListener('mousedown', (e) => {
        if (e.target.closest('.memo-delete-btn') || document.activeElement === memoElement) {
            const style = window.getComputedStyle(memoElement);
            const borderWidth = parseFloat(style.borderLeftWidth);
            const paddingLeft = parseFloat(style.paddingLeft);
            const paddingRight = parseFloat(style.paddingRight);
            const edgeThreshold = 10;

            if (e.offsetX < paddingLeft + borderWidth + edgeThreshold ||
                e.offsetX > memoElement.clientWidth - paddingRight - borderWidth - edgeThreshold ||
                e.offsetY < parseFloat(style.paddingTop) + parseFloat(style.borderTopWidth) + edgeThreshold ||
                e.offsetY > memoElement.clientHeight - parseFloat(style.paddingBottom) - parseFloat(style.borderBottomWidth) - edgeThreshold
            ) {
            } else if (memoElement.contains(document.activeElement) && document.activeElement.isContentEditable) {
                return;
            }
        }


        isDraggingMemo = true;
        memoElement.style.cursor = 'grabbing';
        currentX = memoElement.offsetLeft;
        currentY = memoElement.offsetTop;
        initialMouseX = e.clientX;
        initialMouseY = e.clientY;

        document.addEventListener('mousemove', onMemoDrag);
        document.addEventListener('mouseup', onMemoDragEnd);
        e.stopPropagation();
    });

    function onMemoDrag(e) {
        if (!isDraggingMemo) return;
        e.preventDefault();

        let deltaX = e.clientX - initialMouseX;
        let deltaY = e.clientY - initialMouseY;

        let newLeft = currentX + deltaX;
        let newTop = currentY + deltaY;

        newLeft = Math.max(0, Math.min(newLeft, contentArea.scrollWidth - memoElement.offsetWidth));
        newTop = Math.max(0, Math.min(newTop, contentArea.scrollHeight - memoElement.offsetHeight));


        memoElement.style.left = newLeft + 'px';
        memoElement.style.top = newTop + 'px';
    }

    function onMemoDragEnd() {
        if (!isDraggingMemo) return;
        isDraggingMemo = false;
        memoElement.style.cursor = 'move';
        document.removeEventListener('mousemove', onMemoDrag);
        document.removeEventListener('mouseup', onMemoDragEnd);
    }
}


  // --- Annotation Canvas Event Listeners ---
  function initializeAnnotationCanvasListeners() {
    annotationCanvas.addEventListener('mousedown', startAnnotationDrawing);
    annotationCanvas.addEventListener('mousemove', drawAnnotation);
    annotationCanvas.addEventListener('mouseup', stopAnnotationDrawing);
    annotationCanvas.addEventListener('mouseout', (e) => {
      if (isDrawingAnnotation) {
          stopAnnotationDrawing(e);
      }
    });
    annotationCanvas.addEventListener('touchstart', (e) => { if(e.touches.length===1){e.preventDefault(); startAnnotationDrawing(e.touches[0]);}}, {passive:false});
    annotationCanvas.addEventListener('touchmove', (e) => { if(e.touches.length===1){e.preventDefault(); drawAnnotation(e.touches[0]);}}, {passive:false});
    annotationCanvas.addEventListener('touchend', (e) => { if(e.changedTouches.length===1){e.preventDefault(); stopAnnotationDrawing(e.changedTouches[0]);}});
    annotationCanvas.addEventListener('touchcancel', () => {
        if (isDrawingAnnotation) {
            if (previewImageData) { annotationCtx.putImageData(previewImageData, 0, 0); previewImageData = null; }
            isDrawingAnnotation = false; currentStroke = null;
        }
    });
  }
  
  
  // --- CENTRAL EVENT LISTENER INITIALIZATION ---
  function initializeEventListeners() {
    // Global and Fullscreen
    exitTrueFullscreenBtnActual.addEventListener('click', exitTrueFullscreen);
    trueFullscreenBtn.addEventListener('click', toggleTrueFullscreen);
    
    // Main Menu Panel
    floatingMenuToggleBtn.addEventListener('click', togglePanel);
    closeMenuPanelBtn.addEventListener('click', handleCloseMenuPanel);
    
    // Zoom
    multiZoomTriggerBtn.addEventListener('click', handleMultiZoomTrigger);
    selectionZoomOverlay.addEventListener('click', handleSelectionZoomOverlayClick);
    
    // Main Content Interaction
    appContainer.addEventListener('click', handleAppContainerClick);
    document.addEventListener('click', handleDocumentClick);
    
    // Keyboard
    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);
    window.addEventListener('blur', () => {
        document.body.classList.remove('ctrl-pressed');
        isShiftKeyDown = false;
    });
    
    // --- Menu Panel Buttons ---
    // Icons Visibility
    document.querySelectorAll('input[name="editIconsMode"]').forEach(radio => {
        radio.addEventListener('change', (e) => toggleEditIconsVisibility(e.target.value));
    });
    
    // Link Editing
    document.getElementById('applyLinkBtn').addEventListener('click', applyLink);
    document.getElementById('removeLinkBtn').addEventListener('click', removeLink);
    
    // Text Formatting
    document.getElementById('applyBoldBtn').addEventListener('click', applyBold);
    document.getElementById('applyItalicBtn').addEventListener('click', applyItalic);
    document.getElementById('applyUnderlineBtn').addEventListener('click', applyUnderline);
    document.getElementById('applyStrikethroughBtn').addEventListener('click', applyStrikethrough);
    document.getElementById('applySuperscriptBtn').addEventListener('click', applySuperscript);
    document.getElementById('applySubscriptBtn').addEventListener('click', applySubscript);
    document.getElementById('fontSizeSelector').addEventListener('change', (e) => changeFontSize(e.target.value));
    document.getElementById('fontColorSelector').addEventListener('input', (e) => changeFontColor(e.target.value));
    document.getElementById('backColorSelector').addEventListener('input', (e) => changeBackColor(e.target.value));

    // Character / Emoji Insertion
    document.getElementById('emojiDropdownBtn').addEventListener('click', toggleEmojiPalette);
    document.getElementById('emojiPalette').addEventListener('click', handleEmojiPaletteButtonClick);
    document.getElementById('insertCharFromInputBtn').addEventListener('click', insertCharacterFromInput);

    // Save/Print
    document.getElementById('saveHtmlBtn').addEventListener('click', saveHTML);
    document.getElementById('printPdfBtn').addEventListener('click', printPDF);
    
    // Element Styling
    document.getElementById('elementBgColor').addEventListener('input', (e) => applySelectedElementStyle('backgroundColor', e.target.value));
    document.getElementById('elementTextColor').addEventListener('input', (e) => applySelectedElementStyle('color', e.target.value));
    document.getElementById('elementBorderRadius').addEventListener('input', (e) => applySelectedElementStyle('borderRadius', e.target.value + 'px'));
    document.getElementById('elementShapeSelector').addEventListener('change', (e) => applySelectedElementShape(e.target.value));
    
    // --- Annotation ---
    // Floating Buttons
    annotationDisplayToggleBtn.addEventListener('click', toggleDrawingFeature);
    annotationSettingsToggleBtn.addEventListener('click', toggleAnnotationSettingsPanel);
    memoAnnotationToggleBtn.addEventListener('click', handleMemoToggleClick);
    
    // Annotation Panel
    closeAnnotationSettingsBtn.addEventListener('click', handleCloseAnnotationSettings);
    annoColorPicker.addEventListener('input', (e) => {
      if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterColor = e.target.value; }
      else { panelUISettings.penColor = e.target.value; }
      applySettingsToContext(panelUISettings);
    });
    annoLineWidthSlider.addEventListener('input', (e) => {
        const newWidth = e.target.value;
        if (panelUISettings.tool === 'highlighter') { panelUISettings.highlighterLineWidth = newWidth; }
        else if (['pen', 'circle', 'ellipse', 'orthoLine', 'eraser'].includes(panelUISettings.tool)) { panelUISettings.penLineWidth = newWidth; }
        applySettingsToContext(panelUISettings);
    });
    annoHighlighterOpacitySlider.addEventListener('input', (e) => {
        panelUISettings.highlighterOpacity = e.target.value;
        applySettingsToContext(panelUISettings);
    });
    annoKeepDrawingsVisibleCheckbox.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));
    annoClearCanvasBtn.addEventListener('click', handleClearCanvasClick);
    [annoToolPenBtn, annoToolHighlighterBtn, annoToolCircleBtn, annoToolEllipseBtn, annoToolOrthoLineBtn, annoToolEraserBtn].forEach(btn => {
        if (btn) btn.addEventListener('click', handleAnnotationToolClick);
    });
    
    // Menu Panel Annotation Controls
    menuAnnoKeepDrawingsVisible.addEventListener('change', (e) => handleMenuKeepDrawingsToggle(e.target.checked));
    menuAnnoDrawingToggle.addEventListener('click', toggleDrawingFeature);
    menuAnnoSettingsPanelToggle.addEventListener('click', toggleAnnotationSettingsPanel);
    menuMemoAnnotationBtn.addEventListener('click', handleMenuMemoToggleClick);

    // Canvas Listeners
    initializeAnnotationCanvasListeners();
  }


  // --- Application Initialization on DOMContentLoaded ---
  window.addEventListener('DOMContentLoaded', () => {
    document.body.classList.add('meeting-cursor');
    window.addEventListener('beforeunload', () => {
        document.body.classList.remove('meeting-cursor');
    });

    if (pageTitle) {
        let titleText = pageTitle.innerHTML;
        // ì €ì¥ëœ ìƒíƒœê°€ ì—†ì„ ë•Œë§Œ YY, MMì„ í˜„ì¬ ë‚ ì§œë¡œ êµì²´ (ìˆ˜ì •ë¨: ì›ë³¸ íŒŒì¼ì˜ ì œëª©ì„ ìš°ì„ í•˜ë„ë¡)
        if (typeof window.__SAVED_APP_STATE__ === 'undefined' && titleText.includes('YYë…„')) {
             const dateInfo = getFormattedDateForFilename();
             titleText = titleText.replace(/YYë…„/g, `${dateInfo.yearYY}ë…„`).replace(/MMì›”/g, `${dateInfo.monthMM}ì›”`);
             pageTitle.innerHTML = titleText;
        }
        document.title = titleText.includes('(') ? titleText.substring(0, titleText.indexOf('(')).trim() : titleText;
        const editableTitleMeta = document.querySelector('meta[name="editable-title"]');
        if (editableTitleMeta) {
            editableTitleMeta.content = document.title;
        }
    }


    let parsedState = null;
    if (typeof window.__SAVED_APP_STATE__ !== 'undefined') {
        parsedState = window.__SAVED_APP_STATE__;
    }
    
    if (parsedState) {
        try {
            if (parsedState.wasFullscreenActive) {
                showMessage("ì´ ë¬¸ì„œëŠ” ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. â›¶ ì•„ì´ì½˜ì„ í´ë¦­í•´ ë³µì›í•˜ì„¸ìš”.", 'success', 5000);
            }
            // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ë³µì›
            if (parsedState.monthlyNavigatorConfig) {
                monthlyNavigatorConfig = parsedState.monthlyNavigatorConfig;
            }

            isDrawingFeatureActive = parsedState.isDrawingFeatureActive || false;
            drawingSettings = parsedState.drawingSettings || drawingSettings;
            panelUISettings = parsedState.panelUISettings || { ...drawingSettings };
            keepDrawingsVisibleOnDeactivate = parsedState.keepDrawingsVisibleOnDeactivate !== undefined ? parsedState.keepDrawingsVisibleOnDeactivate : true;
            drawnStrokes = parsedState.drawnStrokes || [];
            isAnnotationPanelOpen = parsedState.isAnnotationPanelOpen || false;
            isMemoModeActive = parsedState.isMemoModeActive || false;

            if (pageTitle && parsedState.pageTitle_innerHTML) {
                if(pageTitle.innerHTML !== parsedState.pageTitle_innerHTML) {
                    pageTitle.innerHTML = parsedState.pageTitle_innerHTML;
                }
            }
            if (contentArea && parsedState.contentArea_innerHTML) {
                const canvasElement = contentArea.querySelector('#annotationCanvas');
                const currentMemos = Array.from(contentArea.querySelectorAll('.text-annotation-memo'));
                contentArea.innerHTML = parsedState.contentArea_innerHTML;

                if (canvasElement && !contentArea.querySelector('#annotationCanvas')) {
                    contentArea.insertBefore(canvasElement, contentArea.firstChild);
                }
                 currentMemos.forEach(memo => {
                    if (!contentArea.contains(memo)) contentArea.appendChild(memo);
                    makeMemoDraggable(memo);
                 });
            }

            if (menuPanel) {
                menuPanel.style.display = parsedState.menuPanel_style_display || 'none';
                if (menuPanel.style.display !== 'none') {
                    menuPanel.style.left = parsedState.menuPanel_style_left || '';
                    menuPanel.style.top = parsedState.menuPanel_style_top || '';
                    menuPanel.style.width = parsedState.menuPanel_style_width || '';
                    menuPanel.style.height = parsedState.menuPanel_style_height || '';
                    if (floatingMenuToggleBtn) {
                         floatingMenuToggleBtn.innerHTML = 'âœ•';
                         floatingMenuToggleBtn.title = 'ë©”ë‰´ ë‹«ê¸°';
                    }
                } else {
                     if (floatingMenuToggleBtn) {
                        floatingMenuToggleBtn.innerHTML = 'â˜°';
                        floatingMenuToggleBtn.title = 'ë©”ë‰´ ì—´ê¸°';
                     }
                }
            }
            // Restore edit icons mode
            const savedEditMode = parsedState.editIconsMode || 'off';
            const radioToCheck = document.querySelector(`input[name="editIconsMode"][value="${savedEditMode}"]`);
            if (radioToCheck) {
                radioToCheck.checked = true;
                toggleEditIconsVisibility(savedEditMode);
            }

        } catch (e) {
            console.error("Error applying saved app state:", e);
            setAnnotationDefaults();
        }
    } else {
        setAnnotationDefaults();
        const radioOff = document.getElementById('editIconsModeOff');
        if(radioOff) radioOff.checked = true;
        toggleEditIconsVisibility('off');
    }

    // Connect all event listeners
    initializeEventListeners();
    
    // ì›”ë³„/ì—°ë„ë³„ ë„¤ë¹„ê²Œì´í„° ê¸°ëŠ¥ ì‹¤í–‰
    initializeMonthlyNavigator();

    elementsForMultiZoom = [];
    updateMultiZoomTriggerVisibility();
    adjustContainerPadding();

    if (pageTitle) { 
        generateItemControls(pageTitle); 
        pageTitle.addEventListener('input', () => { 
            requestAnimationFrame(adjustContainerPadding); 
            // ì œëª©ì´ ë³€ê²½ë˜ë©´ ë„¤ë¹„ê²Œì´ì…˜ë„ ë‹¤ì‹œ ì´ˆê¸°í™”
            initializeMonthlyNavigator();
        }); 
    }
    contentArea.querySelectorAll('[data-editable-type]:not(.text-annotation-memo)').forEach(el => generateItemControls(el));
    contentArea.querySelectorAll('.text-annotation-memo').forEach(makeMemoDraggable);

    updateAnnotationDisplayToggleBtnStyle();
    if(memoAnnotationToggleBtn) memoAnnotationToggleBtn.classList.toggle('active', isMemoModeActive);

    if (document.fonts) {
        document.fonts.ready.then(() => {
            requestAnimationFrame(adjustContainerPadding);
            requestAnimationFrame(setupAnnotationCanvas);
        });
    } else {
        adjustContainerPadding();
        setupAnnotationCanvas();
    }
    fullscreenChangeHandler();

  });
  window.addEventListener('resize', () => {
    adjustContainerPadding();
    setupAnnotationCanvas();
  });

</script>
</body>
</html>